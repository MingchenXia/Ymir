\input{preamble}
\title{Commutative algebra}
\begin{document}
\maketitle
\tableofcontents






\section{Introduction}\label{sec-introduction}

\section{Graded commutative algebra}
Let $G$ be an Abelian group. We write the group operation of $G$ multiplicatively and denote the identity of $G$ as $1$.

\begin{definition}
    Let $A$ be an Abelian group. A \emph{$G$-grading} on $A$ is a coproduct decomposition
    \[
        A=\bigoplus_{g\in G}A_g  
    \]
    of Abelian groups such that $A_g\subseteq A$. An Abelian group with a $G$-grading is called a \emph{$G$-graded Abelian group}. 

    An element $a\in A$ is said to be \emph{homogeneous} if there is $g\in G$ such that $a\in A_g$. If $a$ is furthermore non-zero, we write $g=\rho(a)$. We set $\rho(0)=0$. We will write $\rho(A)$ for the set of $\rho(a)$ when $a$ runs over all homogeneous elements in $A$.

    A \emph{$G$-graded homomorphism} between $G$-graded Abelian groups $A$ and $B$ is a homogeneous of the underlying Abelian groups $f:A\rightarrow B$ such that $f(A_g)\subseteq B_g$ for any $g\in G$.

    The category of $G$-graded Abelian groups is denoted by $\AbCat^G$.
\end{definition}
\begin{remark}
    A usual Abelian group $A$ can be given the \emph{trivial $G$-grading}: $A_0=A$ and $A_g=0$ for $g\in G$, $g\neq 0$. In this way, we find a fully faithful embedding 
    \[
        \AbCat\rightarrow \AbCat^G.  
    \]
    When we regard an Abelian group as a $G$-graded Abelian group and there are no natural gradings, we always understand that we are taking the trivial $G$-grading.
    
    More generally, let $G'$ be a subring of $G$. Then any $G'$-graded Abelian group can be canonically identified with a $G$-graded Abelian group: for the extra pieces in the grading, we simply put $0$.

    The same remark applies to all the other constructions in this section, which we will not repeat.
\end{remark}




\begin{definition}
    A \emph{$G$-graded ring} is a commutative ring $A$ endowed with a $G$-grading:
    \[
        A=\bigoplus_{g\in G} A_g  
    \]
    as Abelian groups and such that 
    \begin{enumerate}
        \item $A_{g}A_{h}\subseteq A_{gh}$ for any $g,h\in G$;
        \item $1\in A_1$.
    \end{enumerate}

    

    A \emph{$G$-graded homomorphism} of $G$-graded rings $A$ and $B$ is a ring homomorphism $f:A\rightarrow B$ such that $f(A_g)\subseteq B_g$ for each $g\in G$. A \emph{$G$-graded subring}  of a $G$-graded ring $B$ is a subring $A$ of $B$ such that the grading on $B$ restricts to a grading on $A$.

    The category of $G$-graded rings is denoted by $\RingCat^G$.
\end{definition}

\begin{example}
    Let $A$ be a $G$-graded ring, $n\in \mathbb{N}$ and $g=(g_1,\ldots,g_n)\in G^n$. Then there is a unique $G$-grading on $A[T_1,\ldots,T_n]$ extending the grading on $A$ and such that $\rho(T_i)=g_i$ for $i=1,\ldots,n$. We will denote $A[T_1,\ldots,T_n]$ with this grading as $A[g_{1}^{-1}T_1,\ldots,g_{n}^{-1}T_n]$ or simply $A[g^{-1}T]$.
\end{example}

\begin{example}\label{ex-localizationgradedring}
    Let $A$ be a $G$-graded ring and $S$ be a multiplicative subset of $A$ consisting of homogeneous elements, then $S^{-1}A$ has a natural $G$-grading. To see this, recall the construction of $S^{-1}A$ in \cite[\href{https://stacks.math.columbia.edu/tag/00CM}{Tag 00CM}]{stacks-project}. One defines an equivalence relation on $A\times S$: $(x,s)\sim (y,t)$ if there is $u\in S$ such that $(xt-ys)u=0$. For each $g\in G$, we define $(S^{-1}A)_g$ as the set of $(x,s)$ for all $s\in S$ and $x\in A_{g\rho(s)}$. It is easy to verify that this is a well-defined $G$-grading on $S^{-1}A$.  \textcolor{red}{Add details.}

    In particular, if $f\in A$ is a non-zero homogeneous element, then we define $A_f$ as $S^{-1}f$ with $S=\{f^n:n\in \mathbb{N}\}$.
\end{example}

\begin{definition}
    Let $A$ be a $G$-graded ring. A \emph{$G$-homogeneous ideal} in $A$ is an ideal $I$ in $G$ such that if $a\in A$ can be written as 
    \[
        a=\sum_{g\in G} a_g,\quad a_g\in A_g  
    \]
    with almost all $a_g=0$, then $a_g\in I$.
\end{definition}
\begin{example}\label{ex-homogeneousidealgeneratedbyelements}
    Let $A$ be a $G$-graded ring and $n\in \mathbb{N}$ and $a_1,\ldots,a_n$ be homogeneous elements in $A$. Then $a_1,\ldots,a_n$ generate a $G$-homogeneous ideal $(a_1,\ldots,a_n)$ as follows:
    \[
        (a_1,\ldots,a_n)_g=\sum_{i=1}^n A_{g \rho(a_i)^{-1}}a_i
    \]
    for any $g\in G$.
\end{example}





\begin{lemma}\label{lma-kernelghomogeneous}
    Let $f:A\rightarrow B$ be a $G$-homomorphism of $G$-graded rings. Then $\ker f$ is a $G$-homogeneous ideal in $A$.
\end{lemma}
\begin{proof}
    We need to show that
    \[
        \ker f=\sum_{g\in G} (\ker f)\cap A_g.  
    \]
    Take $x\in \ker f$, we can write $x$ as 
    \[
        \sum_{g\in G} a_g,\quad a_g\in A_g
    \]
    and almost all $a_g$'s are $0$. Then 
    \[
        f(x)=  \sum_{g\in G} f(a_g),\quad f(a_g)\in B_g.
    \]
    It follows that $f(a_g)=0$ for each $g\in G$ and hence $a_g\in (\ker f)\cap A_g$.
\end{proof}

\begin{definition}\label{def-gradquotient}
    Let $A$ be a $G$-graded ring and $I$ be a $G$-homogeneous ideal in $A$. Then we define a $G$-grading on $A/I$ as follows: for any $g\in G$
    \[
        (A/I)_g:= (A_g+I)/I.
    \]
\end{definition}
\begin{proposition}
    Let $A$ be a $G$-graded ring and $I$ be a $G$-homogeneous ideal in $A$. Then the construction in \cref{def-gradquotient} defines a grading on $A/I$. The natural map $\pi:A\rightarrow A/I$ is a $G$-homomorphism.

    For any $G$-graded ring $B$ and any $G$-homomorphism $f:A\rightarrow B$ such that $I\subseteq \ker A$, there is a unique $G$-homomorphism $f':A/I\rightarrow B$ such that $f'\circ \pi=f$.
\end{proposition} 
\begin{proof}
    We first argue that for different $g,h\in G$, $(A/I)_g\cap (A/I)_h=0$. Suppose $x\in (A/I)_g\cap (A/I)_h$, we can lift $x$ to both $y_g+i_g\in A$ and $y_h+i_h\in A$ with $y_g,y_h\in A$ and $i_g,i_h\in I$. It follows that $y_g-y_h\in I$. But $I$ is a $G$-homogeneous ideal, so it follows that $y_g,y_h\in I$ and hence $x=0$.

    Next we argue that
    \[
        A/I=\sum_{g\in G}  (A/I)_g.
    \]
    Lift an element $x\in A/I$ by $a\in A$, we represent $a$ as
    \[
        a=\sum_{g\in G} a_g,\quad a_g\in A_g 
    \]
    with almost all $a_g$'s equal to $0$. Then $x$ can be represented as
    \[
        x=\sum_{g\in G}\pi(a_g).  
    \]
    We have shown that the construction in \cref{def-gradquotient} gives a $G$-grading on $A$. It is clear from the definition that $\pi$ is a $G$-homomorphism.

    Next assume that $B$ and $f$ are given as in the proposition. Then there is a ring homomorphism $f':A/I\rightarrow B$ such that $f=f'\circ \pi$. We need to argue that $f'$ is a $G$-homomorphism. For this purpose, take $g\in G$, $x\in (A/I)_g$, we need to show that $f'(x)\in B_g$. Lift $x$ to $y+i$ with $y\in A_g$ and $i\in I$, then we know that $f'(x)=\pi(y+i)=\pi(y)\in B_g$.    
\end{proof}

\begin{definition}
    Let $A$ be a $G$-graded ring. 
    
    Let $M$ an $A$-module which is also a $G$-graded Abelian group. We say $M$ is a \emph{$G$-graded $A$-module} if for each $g,h\in G$, we have
    \[
        A_gM_h\subseteq M_{gh}.  
    \]
    A \emph{$G$-graded homomorphism} of $G$-graded $A$-modules $M$ and $N$ is an $A$-module homomorphism $f:M\rightarrow N$ which is at the same time a homomorphism of  the underlying $G$-graded Abelian groups.

    The category of $G$-graded $A$-modules is denoted by $\ModCat^G_A$.

    A \emph{$G$-graded $A$-algebra} is a $G$-graded ring $B$ together with a $G$-graded ring homomorphism $A\rightarrow B$ such that $B$ is also a $G$-graded $A$-module.

    A \emph{$G$-graded homomorphism} between $G$-graded $A$-algebras $B$ and $C$ is a $G$-graded homomorphism between the underlying $G$-graded rings that is at the same time a $G$-graded homomorphism of $G$-graded $A$-modules.
\end{definition}
Observe that $G$-homogeneous ideals of $A$ are $G$-graded submodules of $A$. Also observe that $\ModCat^G_{\mathbb{Z}}$ is isomorphic to $\AbCat^G$.

\begin{proposition}
    Let $A$ be a $G$-graded ring. Then $\ModCat^G_A$ is an Abelian category satisfying AB5.
\end{proposition}
\begin{proof}
    We first show that $\ModCat^G_A$ is preadditive. Given $M,N\in \ModCat^G_A$, we can regard $\Hom_{\ModCat^G_A}(M,N)$ as a subgroup of $\Hom_A(M,N)$. It is easy to see that this gives $\ModCat^G_A$ an enrichment over $\AbCat$.

    Next we show that $\ModCat^G_A$ is additive. The zero object is clearly given by $0$ with the trivial grading. Given $M,N\in \ModCat^G_A$, we define
    \[
        (M\oplus N)_g:=M_g\oplus N_g,\quad g\in G.
    \]
    This construction makes $M\oplus N$ a $G$-graded $A$-module. It is easy to verify that $M\oplus N$ is the biproduct of $M$ and $N$.

    Next we show that $\ModCat^G_A$ is pre-Abelian. Given an arrow $f:M\rightarrow N$ in  $\ModCat^G_A$, we need to define its kernel and cokernel. We define
    \[
        (\ker f)_g:=(\ker f)\cap M_g  
    \]
    and $(\coker f)_g$ as the image of $N_g$ for any $g\in G$. It is straightforward to verify that these are kernels and cokernels.

    Next, given a monomorphism $f:M\rightarrow N$, it is obvious that the map $f$ is injective and $f$ can be identified with the kenrel of the natural map $N/\Img f$. A dual argument shows that an epimorphism is the cokernel of some morphism as well.

    The AB5 condition is easily verified. \textcolor{red}{Expand the details of this argument!}
\end{proof}

Next we define the tensor product of $G$-graded modules.
\begin{definition}
    Let $A$ be a $G$-graded ring and $M,N$ be $G$-graded $A$-modules. We define a $G$-grading on $M\otimes_A N$ as follows: for any $g\in G$, $(M\otimes_A N)_g$ is defined as the image of $\sum_{h\in G}M_h\times N_{gh^{-1}}$ in $M\otimes_A N$. We always endow $M\otimes_A N$ with this $G$-grading.
\end{definition}
\textcolor{red}{verify the universal prperty; show that this is indeed a grading}

\begin{example}\label{ex-localizationgradedmodule}
    This is a continuition of \cref{ex-localizationgradedring}.
    Let $A$ be a $G$-graded ring and $S$ be a multiplicative subset of $A$ consisting of homogeneous elements. Consider a $G$-graded $A$-module $M$. We define a $G$-grading on $S^{-1}M$. Recall that $S^{-1}M$ can be realized as follows: one defines an equivalence relation on $M\times S$: $(x,s)\sim (y,t)$ if there is $u\in S$ such that $(xt-ys)u=0$. For each $g\in G$, we define $(S^{-1}M)_g$ as the set of $(x,s)$ for all $s\in S$ and $x\in M_{g\rho(s)}$. It is easy to verify that this is a well-defined $G$-grading on $S^{-1}M$ and $S^{-1}M$ is a $G$-graded $S^{-1}A$-module.  \textcolor{red}{Add details.}
\end{example}

\begin{example}\label{ex-twistmodule}
    Let $A$ be a $G$-graded ring and $g\in G$. We define $g^{-1}A$ as the $G$-graded $A$-module:
    \[
        (g^{-1}A)_h=A_{g^{-1}h}
    \]
    for any $h\in G$. Observe that $1\in (g^{-1}A)_g$.
\end{example}

\begin{definition}
    Let $A$ be a $G$-graded ring and $M$ be a $G$-graded $A$-module. We say $M$ is \emph{free} if there exists a family $\{g_i\}_{i\in I}$ in $G$ such that
    \[
        M=\coprod_{i\in I} g_i^{-1}A.  
    \]
\end{definition}

\begin{definition}
    Let $f:A\rightarrow B$ be a $G$-graded homomorphism of $G$-graded rings. We say $f$ is \emph{finite} (resp. \emph{finitely generated}, resp. \emph{integral}) if it is finite (resp. finitely generated, resp. integral) as a usual ring map.
\end{definition}

\begin{proposition}\label{prop-gradedfiniteintegral}
    Let $f:A\rightarrow B$ be a $G$-graded homomorphism of $G$-graded rings. Then 
    \begin{enumerate}
        \item $f$ is finite if and only if there are $n\in \mathbb{N}$, $g_1,\ldots,g_n\in G$ and a surjective $G$-graded homomorphism 
        \[
            \bigoplus_{i=1}^n(g_i^{-1}A)^n\rightarrow B
        \] 
        of graded $A$-modules.
        \item $f$ is finitely generated if and only if there are $n\in \mathbb{N}$,  $g_1,\ldots,g_n\in G$ and a surjective $G$-graded $A$-algebra homomorphism
        \[
            A[g_1^{-1}T_1,\ldots,g_{n}^{-1}T_n]\rightarrow B.  
        \] 
        \item $f$ is integral if and only if for any non-zero homogeneous element $b\in B$, there is $n\in \mathbb{N}$ and homogeneous elements $a_1,\ldots,a_n\in A$ such that
        \[
            b^n+f(a_1)b^{n-1}+\cdots+f(a_n)=0.  
        \]
        \item A non-zero homogeneous element $b\in B$ is integral over $A$ if there is $n\in \mathbb{N}$ and homogeneous elements $a_1,\ldots,a_n\in A$ such that
        \[
            b^n+f(a_1)b^{n-1}+\cdots+f(a_n)=0.  
        \]
    \end{enumerate}
\end{proposition}
\begin{proof}
    (1) The non-trivial direction is the direct implication. Assume that $f$ is finite. Take $b_1,\ldots,b_n\in B$ so that $\sum_{i=1}^nf(A)b_i=B$. Up to replacing the collection $\{b_i\}_i$ by the finite collection of non-zero homogeneous components of the $b_i$'s, we may assume that each $b_i$ is homogeneous. We define $g_i=\rho(b_i)$ and the map $\bigoplus_{i=1}^n(g_i^{-1}A)^n\rightarrow B$ sends $1$ at the $i$-th place to $b_i$. 

    (2) The non-trivial direction is the direct implication. Suppose $f$ is finitely generated, say by $b_1,\ldots,b_n$. Up to replacing the collection $\{b_i\}_i$ by the finite collection of non-zero homogeneous components of the $b_i$'s, we may assume that each $b_i$ is homogeneous. Then we define $g_i=\rho(b_i)$ for $i=1,\ldots,n$ and the $A$-algebra homomorphism $A[g_1^{-1}T_1,\ldots,g_{n}^{-1}T_n]\rightarrow B$ sends $T_i$ to $b_i$ for $i=1,\ldots,n$.

    (3) Assume that $f$ is integral, then for any non-zero homogeneous element $b\in B$, we can find $a_1,\ldots,a_n\in A$ such that 
    \[
        b^n+f(a_1)b^{n-1}+\cdots+f(a_n)=0.  
    \]
    Obviously, we can replace $a_i$ by its component in $\rho(b)^i$ for $i=1,\ldots,n$ and the equation remains true.

    The reverse direction follows from \cite[\href{https://stacks.math.columbia.edu/tag/00GO}{Tag 00GO}]{stacks-project}.

    (4) This is argued in the same way as (3).
\end{proof}

\begin{definition}
    A $G$-graded ring $A$ is a \emph{$G$-graded field} if
    \begin{enumerate}
        \item $A\neq 0$.
        \item $A$ does not admit any non-zero proper $G$-homogeneous ideals.
    \end{enumerate} 
\end{definition}
\begin{proposition}\label{prop-gradedfieldchar}
    Let $A$ be a non-zero $G$-graded ring. Then the following conditions are equivalent:
    \begin{enumerate}
        \item $A$ is a $G$-graded field.
        \item Any non-zero homogeneous element in $A$ is invertible.
    \end{enumerate}
\end{proposition}
\begin{proof}
    Assume that $A$ is a $G$-graded field. Let $a\in A$ be a non-zero homogeneous element. Consider the $G$-homogeneous ideal $(a)$ generated by $a$ as in \cref{ex-homogeneousidealgeneratedbyelements}. As $a\neq 0$, it follows that $(a)=1$. Hence, $a$ is invertible.

    Conversely, suppose that any non-zero homogeneous element in $A$ is invertible. If $I$ is a non-zero $G$-homogeneous ideal in $A$. There is a non-zero homogeneous element $a\in I$. But we know that $a$ is invertible and hence $I=A$.
\end{proof}

\begin{definition}
    A $G$-graded ring $A$ is an \emph{integral domain} if for any non-zero homogeneous elements $a,b\in A$, $ab\neq 0$.
\end{definition}
\begin{lemma}\label{lma-gradedfractionfield}
    Let $A$ be a $G$-graded integral domain. Let $S$ denote the set of non-zero homogeneous elemnts in $A$. Then $S^{-1}A$ is a graded field. The natural map $A\rightarrow S^{-1}A$ is injective.
\end{lemma}
Recall that $S^{-1}A$ is defined in \cref{ex-localizationgradedring}.
\begin{proof}
    By \cref{prop-gradedfieldchar}, it suffices to show that each non-zero homogeneous element in $S^{-1}A$ is invertible. Such an element has the form $a/s$ for some homogeneous element $a\in A$ and $s\in S$. As $A$ is a $G$-graded integral domain, $a$ is invertible and hence $s/a\in S^{-1}A$.

    In general, the kernel of the localzation map is given by $\{a\in A: \text{ there is }s\in S\text{ such that }sa=0\}$. As $A\rightarrow S^{-1}A$ is a $G$-graded homomorphism, the kernel is in addition a $G$-homogeneous ideal in $A$ by \cref{lma-kernelghomogeneous}. So it suffices to show that each homogeneous element in the kenrel vanishes: if $a\in A$ is a homogeneous element and there is $s\in S$ such that $sa=0$, then $a=0$. Otherwise, $a$ is invertible by \cref{prop-gradedfieldchar}, which is a contradiction.
\end{proof}
\begin{definition}
    Let $A$ be a $G$-graded integral domain. We call the graded field defined in \cref{lma-gradedfractionfield} the \emph{fraction $G$-graded field} of $A$ and denote it by $\Frac^G A$.
\end{definition}

\begin{definition}
    Let $A$ be a $G$-graded ring. A proper $G$-homogeneous ideal $I$ in $A$ is called \emph{prime} if the $G$-graded ring $A/I$ is a $G$-graded integral domain.
\end{definition}

\begin{proposition}
    Let $A$ be a $G$-graded ring and $I$ be a proper homogeneous ideal in $A$. Then the following are equivalent:
    \begin{enumerate}
        \item $I$ is a $G$-graded prime ideal in $A$.
        \item For any homogeneous elements $a,b\in A$ satisfying $ab\in I$, at least one of $a$ and $b$ lies in $I$.
    \end{enumerate}
\end{proposition}
\begin{proof}
    Assume that $I$ is a $G$-graded prime ideal in $A$. Let $a,b\in A$ be homogeneous elements satisfying $ab\in I$. Let $\bar{a},\bar{b}$ be the images of $a,b$ in $A/I$. Then $\bar{a},\bar{b}$ are homogeneous and $\bar{a}\bar{b}=0$. So at least one of $\bar{a}$ and $\bar{b}$ is zero. That is, $a$ or $b$ lies in $I$.

    Conversely, assume that the conditon in (2) is satisfied. Take $x,y\in A/I$ with $xy=0$. We need to show that at least one of $x$ and $y$ is $0$. Lift $x$ and $y$ to $a+i$ and $b+i'$ in $A$ with $a,b$ being homogeneous and $i,i'\in I$. Then $ab\in I$ and hence $a\in I$ or $b\in I$. It follows that $x=0$ or $y=0$. 
\end{proof}



\begin{definition}
    Let $A$ be a $G$-graded ring and $\mathfrak{p}$ be a $G$-homogeneous prime ideal in $A$. Then we define the \emph{$G$-graded localization} $A^G_{\mathfrak{p}}$ of $A$ at $\mathfrak{p}$  as $S^{-1}A$, where $S$ is the set of homogeneous elements in $A\setminus \mathfrak{p}$.

    Similarly, let $M$ be a $G$-graded $A$-module. We define the \emph{$G$-graded localization} $M^G_{\mathfrak{p}}$ as $S^{-1}M$.
\end{definition}
Recall that $S^{-1}A$ and $S^{-1}M$ are defined in \cref{ex-localizationgradedring} and \cref{ex-localizationgradedmodule}. 

\begin{definition}
    Let $A$ be a $G$-graded ring.

    A $G$-homogeneous ideal $I$ in $A$ is said to be \emph{maximal} if it is proper, and it is not contained in any other proper $G$-homogeneous ideals.

    We call $A$ a \emph{$G$-graded local ring} if it has a unique maximal homogeneous ideal. This ideal is called the \emph{maximal $G$-homogeneous ideal} of $A$.
\end{definition}



\begin{proposition}\label{prop-maximalidealandfield}
    Let $A$ be a $G$-graded ring and $I$ be a $G$-homogeneous ideal in $A$. Then the following are equivalent:
    \begin{enumerate}
        \item $I$ is a maximal $G$-homogeneous ideal in $A$;
        \item $A/I$ is a $G$-graded field.
    \end{enumerate}

    In particular, a maximal $G$-homogeneous ideal is a $G$-homogeneous prime ideal.
\end{proposition}
\begin{proof}
    Assume (1). Then $I$ is a proper ideal, so $A/I$ is non-zero. Suppose that $A/I$ has a proper $G$-homogeneous ideal $J$, it lifts to an ideal $J'$ of $A$. We claim that $J'$ is $G$-homogeneous. In fact, we set $J'_g:=\{x\in A_g: x+I\in J\}$ for $g\in G$, we need to show that
    \[
        J'=\sum_{g\in G}  J'_g.
    \]
    For any $j\in J'$, we can expand $j+I$ as $\sum_{g\in G} a_g+I$ with $a_g\in A_g$ and almost all $a_g$'s are $0$. We take $i\in I$ so that 
    \[
        j=i+\sum_{g\in G} a_g.  
    \]
    The desired equation follows.
    But then it follows that $J'=I$ and hence $J=0$.

    Assume (2). Then $I$ is a proper ideal in $A$. If $J$ is a $G$-homogeneous proper ideal of $A$ containing $I$, then $J/I$ is a $G$-homogeneous proper ideal of $A/I$. It follows that $J/I=0$ and hence $J=I$.
\end{proof}
\begin{corollary}\label{cor-specgradednonempty}
    Let $A$ be a non-zero $G$-graded ring, then $A$ admits a $G$-homogeneous prime ideal.
\end{corollary}
\begin{proof}
    By our assumption, $0$ is a proper ideal in $A$.
    By Zorn's lemma, $A$ admits a maximal $G$-homogeneous ideal, which is prime by \cref{prop-maximalidealandfield}.
\end{proof}

\begin{lemma}\label{lma-integralelementscontinfinitemodule}
    Let $f:A\rightarrow B$ be a $G$-graded homomorphism of $G$-graded rings. Let $b_1,\ldots,b_n\in B$ be a finite set of homogeneous elements integral over $A$, then there is a $G$-graded $A$-subalgebra $B'\subseteq B$ containing $b_1,\ldots,b_n$ such that $A\rightarrow B'$ is finite.
\end{lemma}
\begin{proof}
    We may assume that none of the $b_i$'s is zero.
    By \cref{prop-gradedfiniteintegral}, we can find $m_1,\ldots,m_n\in \mathbb{N}$ and homogeneous elements $a_{i,j}\in A$ for $i=1,\ldots,n$ and $j=1,\ldots,m_i$ such that
    \[
        b_i^{m_i}+f(a_{i,1})  b_i^{m_i-1}+\cdots+f(a_{i,m_i})=0
    \]
    for $i=1,\ldots,n$. It suffices to take $B'$ as the $A$-submodule generated by $a_{i,j}$ for $i=1,\ldots,n$ and $j=1,\ldots,m_i$.
\end{proof}

\begin{proposition}\label{prop-integralextprimelift}
    Let $f:A\rightarrow B$ be an injective integral $G$-graded homomorphism of $G$-graded rings. Then for any $G$-homogeneous prime ideal $\mathfrak{p}$ in $A$, there is a $G$-homogeneous prime ideal $\mathfrak{p}'$ in $B$ such that $\mathfrak{p}=f^{-1}\mathfrak{p}'$.
\end{proposition}
\begin{proof}
    We may assume that $A\neq 0 $, as otherwise there is nothing to prove.

    It suffices to show that $\mathfrak{p}B_{\mathfrak{p}}\neq B_{\mathfrak{p}}$. \textcolor{red}{Include a proof}
    We could localize that $\mathfrak{p}$ and assume that $\mathfrak{p}$ is a maximal $G$-homogeneous ideal. \textcolor{red}{Include details about localization} It suffices then to show that $\mathfrak{p}B\neq B$. Assume by contrary that we can write $1=\sum_{i=1}^n f_i b_i$ for some homogeneous elements $f_i\in \mathfrak{p}$ and some homogeneous elements $b_i\in B$. Let $B'$ be a $G$-graded subring of $B$ containg $A$ and $b_1,\ldots,b_n$ and such that $A\rightarrow B'$ is finite. The existence of $B'$ is guaranteed by \cref{lma-integralelementscontinfinitemodule}. Then we find immediately $B'=\mathfrak{m}_AB'$. Then $B'=0$ by the graded Nakayama's lemma. \textcolor{red}{Include details} So $A=0$, which is a contradiction.
\end{proof}

\begin{lemma}\label{lma-rhoconditionimplygraded}
    Let $A$ be a $G$-graded ring. Then the following are equivalent:
    \begin{enumerate}
        \item $A$ is a $G$-graded local ring;
        \item There is a proper homogeneous ideal $I$ in $A$ such that any non-invertible homogeneous element in $A$ is contained in $I$.
    \end{enumerate}
    In fact, $I$ in (2) is just the maximal $G$-homogeneous ideal in $A$.
\end{lemma}
\begin{proof}
    Assume that (1) holds, let $I$ be the maximal $G$-homogeneous ideal of $A$. Let $a$ be a non-invertible homogeneous element in $A$. Then the image of $a$ in $A/I$ is invertible by \cref{prop-maximalidealandfield} and \cref{prop-gradedfieldchar}.

    Assume (2). We show that $I$ is the maximal $G$-homogeneous ideal in $A$. By \cref{prop-maximalidealandfield}, it suffices to show that $A/I$ is a graded field. By \cref{prop-gradedfieldchar}, we need to show that any non-zero homogeneous element $b\in A/I$ is invertible. Lift $b$ to $a+i\in A$ with $a\in A$ homogeneous and $i\in I$. If $a$ is not invertible, then $a\in I$ by the assumption hence $b=0$. This is a contradiction.
\end{proof}


\begin{lemma}
    Let $k$ be a $G$-graded field and $A$ be a graded $k$-algebra. Suppose that $\rho(A)=\rho(k)$, then
    \begin{enumerate}
        \item For any $g\in G$, there is a natural isomorphism
            \[
                A_g\cong A_1 \otimes_{k_1} k_g.
            \]
        \item The map $I\mapsto I\cap A_1$ is a bijection between the set of $G$-homogeneous ideals (resp. $G$-homogeneous prime ideals) in $A$ and ideals (resp. prime ideals) in $A_1$.
    \end{enumerate}
\end{lemma}
\begin{proof}
    (1) Take $g\in \rho(A)$. As $\rho(A)=\rho(k)$, we can take a non-zero homogeneous element $b\in k_g$. Then $b$ and $b^{-1}$ induces inverse bijections between $A_1$ and $A_g$.

    (2) The part about ideals can be proved in the same way as (1). The part about prime ideals follows easily.
\end{proof}

\begin{proposition}\label{prop-gradedmoduleofgradedringfree}
    Let $k$ be a $G$-graded field and $M$ be a $G$-graded $A$-module. Then $M$ is free as $G$-graded $A$-module.
\end{proposition}
\begin{proof}
    We may assume that $M\neq 0$.
    Let $\{m_i\}_{i\in I}$ be a maximal set of non-zero homogeneous elements in $M$ such that the corresponding homomorphism 
    \[
        F:=\bigoplus_{i\in I} (\rho(f))^{-1}k\rightarrow M  
    \] 
    is injective. The existence of $\{m_i\}_{i\in I}$ follows from Zorn's lemma.

    If $f\in M/F$ is a non-zero homogeneous element, then we get a homomorphism $(\rho(f))^{-1}k\rightarrow M/F$. This map is necessarily injective as $(\rho(f))^{-1}k$ does not have non-zero proper graded submodules. This contradicts the definition of $F$.
\end{proof}

\begin{corollary}\label{cor-finitegradeddescent}
    Let $k$ be a $G$-graded field, $C$ be a $G$-graded $k$-algebra. Consider a $G$-graded homomorphism of $G$-graded $k$-algebras $f:A\rightarrow B$. Then the following are equivalent:
    \begin{enumerate}
        \item $f$ is finite (resp. finitely generated);
        \item $f\otimes_k C$ is finite (resp. finitely generated).
    \end{enumerate}
\end{corollary}

\begin{proof}
    (1) $\implies$ (2): This implication is trivial.
    
    (2) $\implies$ (1): By \cref{prop-gradedmoduleofgradedringfree}, this implication follows from fpqc descent \cite[\href{https://stacks.math.columbia.edu/tag/02YJ}{Tag 02YJ}]{stacks-project}.
\end{proof}

\begin{definition}
    Let $K$ be a $G$-graded field. A $G$-graded subring $A\subseteq K$ is a \emph{$G$-graded valuation ring} in $K$ if
    \begin{enumerate}
        \item $A$ is a local $G$-graded ring;
        \item the natural map $\Frac^G A\rightarrow K$ is an isomorphism;
        \item For any non-zero homogeneous element $f\in K$, either $f\in A$ or $f^{-1}\in A$.
    \end{enumerate}
\end{definition}

\begin{definition}
    Let $K$ be a $G$-graded field and $A,B$ be $G$-graded local subrings of $K$. We say $B$ \emph{dominates} $A$ if $A\subseteq B$ and $\mathfrak{m}_B\cap A=\mathfrak{m}_A$, where $\mathfrak{m}_A$ and $\mathfrak{m}_B$ are the maximal $G$-homogeneous ideals in $A$ and $B$. 
\end{definition}

\begin{proposition}\label{prop-valuationringchar}
    Let $K$ be a $G$-graded field and $A\subseteq K$ be a $G$-graded local subring. Then the following are equivalent:
    \begin{enumerate}
        \item $A$ is a $G$-graded valuation ring in $K$.
        \item $A$ is maximal among the $G$-graded local subrings of $K$ with respect to the order of domination.
    \end{enumerate}
\end{proposition}
\begin{proof}
    Assume (1). We may assume that $A\neq K$. Then $A$ is not a $G$-graded field as $\Frac^G=K$. Let $\mathfrak{m}$ be a maximal $G$-homogeneous ideal in $A$. Then $\mathfrak{m}\neq 0$. 
    
    We argue first that $A$ is a $G$-graded local ring. Assume the contrary.
    Let $\mathfrak{m}'\neq \mathfrak{m}$ be maximal $G$-homogeneous ideal in $A$. Choose non-zero homogeneous elements $x,y\in A$ with $x\in \mathfrak{m}'\setminus \mathfrak{m}$, $y\in \mathfrak{m}\setminus \mathfrak{m}'$. Then $x/y\not\in A$ as otherwise $x=(x/y)y\in \mathfrak{m}$. Similarly, $y/x\not\in A$. This is a contradiction.

    Next suppose that $A'$ is a $G$-graded local subring of $K$ dominating $A$. Let $x\in A'$ be a non-zero homogeneous element, we need to show that $x\in A$. If not, we have $x^{-1}\in A$ and as $x^{-1}$ is not a unit, $x^{-1}\in \mathfrak{m}_A$. But then $x^{-1}\in \mathfrak{m}_{A'}$, the maximal $G$-homogeneous ideal in $A'$. This contradicts the fact that $x\in A'$.

    Assume (2).  Take a homogeneous element $x\in K\setminus A$, we need to argue that $x^{-1}\in A$. Let $A'$ denote the minimal $G$-homogeneous subring of $K$ containing $A$ and $x$. It is easy to see that $A'$ is the usual subring generated by $A$ and $x$.
    
    By our assumption, there is no $G$-graded prime ideal of $A'$ lying over $\mathfrak{m}_A$, as otherwise, if $\mathfrak{p}$ is such an ideal, the $G$-graded local subring $A'^G_{\mathfrak{p}}$ of $K$ dominates $A$.

    In other words, the $G$-graded ring $A'/\mathfrak{m}_AA'$ does not  have any homogeneous prime ideals and hence $A'=\mathfrak{m}_AA'$ by \cref{cor-specgradednonempty}.

    We can therefore write
    \[
      1=\sum_{i=0}^d t_ix^i  
    \]
    with some homogeneous elements $t_i\in \mathfrak{m}_A$. In particular,
    \[
        (1-t_0)(x^{-1})^d-\sum_{i=1}^d t_i (x^{-1})^{d-i}=0.  
    \]\
    So $x^{-1}$ is integral over $A$. Let $A''$ be the subring of $K$ generated by $A$ and $x^{-1}$. Then $A\rightarrow A''$ is finite and there is a $G$-homgeneous prime ideal $\mathfrak{m}''$ of $A''$ lying over $\mathfrak{m}_A$ by \cref{prop-integralextprimelift}. By our assumption, $A=A''^G_{\mathfrak{m}''}$ and hence $x^{-1}\in A$.

    It remains to verify that $\Frac^G A=K$. Suppose that it is not the case, let $B\subseteq K$ be a $G$-graded local subring dominating $A$. Take a homogeneous element $t\in K$ that is not in $\Frac^G A$. Observe that $t$ can not be transcendental over $A$, as otherwise $A[t]\in K$ is a $G$-graded subring, and we can localize it at the $G$-homogeneous prime generated by $t$ and $\mathfrak{m}_A$. We get a $G$-graded local ring dominating $A$ that is different from $A$.

    So $t$ is algebraic over $A$. We can then take a non-zero homogeneous $a\in A$ such that $at$ is integral over $A$. The ring $A'\subseteq K$ generated by $A$ and $ta$ is a $G$-graded subring and $A\rightarrow A'$ is finite. By \cref{prop-integralextprimelift}, tehre is a $G$-homogeneous prime ideal $\mathfrak{m}'$ of $A'$ lifting $\mathfrak{m}_A$. But then $A'^G_{\mathfrak{m}'}$ dominates $A$ and so $A=A'^G_{\mathfrak{m}'}$. It follows that $t\in \Frac^G A$, which is a contradiction.
\end{proof}

\begin{corollary}
    Let $K$ be a $G$-graded field. Any $G$-graded local subring $B\subseteq K$ is dominated by a $G$-graded valuation subring of $K$.
\end{corollary}
\begin{proof}
    This follows from \cref{prop-valuationringchar} and Zorn's lemma.
\end{proof}

\section{Graded algebraic geometry}
Let $G$ be an Abelian group. We write the group operation of $G$ multiplicatively and denote the identity of $G$ as $1$.

\begin{definition}
    Let $A$ be a $G$-graded ring. We define the \emph{$G$-graded affine spectrum} $\Spec^G(A)$ as follows: as a set $\Spec^G (A)$ consists of all $G$-homogeneous prime ideals of $A$; we endow $\Spec^G(A)$ with the \emph{Zariski topology}, whose base consists of sets of the form 
    \[
        D(f):=\left\{\mathfrak{p}\in \Spec^G(A): f\not\in \mathfrak{p}\right\}
    \]
    for all homogeneous elements $f\in A$.
\end{definition}

\begin{lemma}
    Let $k$ be a $G$-graded field and $A$ be a finitely generated $G$-graded $k$-algebra. Then $\Spec^G(A)$ has only finitely many maximal points.
\end{lemma}
\begin{proof}
    
\end{proof}

\section{The birational category}
Let $G$ be an Abelian group.
Let $k$ be a $G$-graded field and $K/k$ be a $G$-graded field extension.
\begin{definition}
    We let $\mathbf{P}_{K/k}$ denote the set of $G$-graded valuation rings $\mathcal{O}$ of $K$ with $G$-graded fraction field $K$ such that $k\subseteq \mathcal{O}$.


    We endow $\mathbf{P}_{K/k}$ with the weakest topology with respect to which $\{\mathcal{O}\in \mathbf{P}_{K/k}:f\in \mathcal{O}\}$ is open for any homogeneous element $f\in K$.
\end{definition}
Given $X\subseteq \mathbf{P}_{K/k}$ and $A\subseteq K$ consisting of homogeneous elements, we write 
\[
    \begin{aligned}
        X\{A\}:=&\left\{\mathcal{O}\in X:f\in \mathcal{O} \text{ for all non-zero }f\in A \right\},\\
        X\{\{A\}\}:=&\left\{ \mathcal{O}\in X: f\in \mathfrak{m}_{\mathcal{O}} \text{ for all non-zero }f\in A \right\},
    \end{aligned}  
\]
where $\mathfrak{m}_{\mathcal{O}}$ is the maximal $G$-homogeneous ideal of $\mathcal{O}$. When $A$ consists of a single element, we will write $X\{f\}$ and $X\{\{f\}\}$ instead.

\begin{definition}
    An \emph{affine subset} of $\mathbf{P}_{K/k}$ is a subset of $\mathbf{P}_{K/k}$ of the form: $\mathbf{P}_{K/k}\{F\}$ for some finite set $F$ of homogeneous elements in $K$.
\end{definition}

\begin{lemma}\label{lma-Xfcomplem}
    Let $X\subseteq \mathbf{P}_{K/k}$ and $f\in K$ be a non-zero homogeneous element. Then
    \[
        X\setminus X\{f\}=  X\{\{f^{-1}\}\}.
    \]
\end{lemma}
\begin{proof}
    We first observe that $X\{f\}\cap X\{\{f^{-1}\}\}=\emptyset$. Otherwise, let $\mathcal{O}$ be a $G$-graded valuation ring in this intersection, then $f\in \mathcal{O}$ and $f^{-1}\in \mathfrak{m}_{\mathcal{O}}$. So $1\in \mathfrak{m}_{\mathcal{O}}$, which is a contradiction.

    To show that $X\{f\}\cup  X\{\{f^{-1}\}\}=X$, we may assume that $X=\mathbf{P}_{K/k}$. Let $\mathcal{O}\in \mathbf{P}_{K/k}$. We need to show that $f\in \mathcal{O}$ or $f^{-1}\in \mathfrak{m}_{\mathcal{O}}$.
    
    By definition, either $f\in \mathcal{O}$ or $f^{-1}\in \mathcal{O}$. We may assume that $f\not\in \mathcal{O}$ and $f^{-1}\in \mathcal{O}$. If $f^{-1}\not\in \mathfrak{m}_{\mathcal{O}}$, then $f^{-1}$ is invertible in $\mathcal{O}$ by \cref{lma-rhoconditionimplygraded}. In particular, $f\in \mathcal{O}$, which is a contradiction.
\end{proof}



\begin{lemma}
    Let $A\subseteq K$ be a subset of $K$ consisting of homogeneous elements, then $\mathbb{P}_{K/k}\{A\}$ is quasi-compact.
\end{lemma}
\begin{proof}
    We may replace $A$ by the $G$-graded subring generated of $K$ generated by $A$. So we may assume that $A$ is a $G$-graded subring of $K$. 
    
    Write $X=\mathbb{P}_{K/k}\{A\}$. By definition, a sub-base for the topology on $X$ is given by $X\{f\}$ for all non-zero homogeneous elements $f\in K$. 

    By Alexander sub-base theorem and \cref{lma-Xfcomplem}, in order to show that $X$ is quasi-compact, it suffices to show that if $F\subseteq K$ consists of homogeneous elements and if for any finite subset $F_0\subseteq F$, $X\{\{F_0\}\}\neq \emptyset$, then $X\{\{F\}\}$ is non-empty. We assume by contrary that $X\{\{F\}\}$ is empty.

    Let $B$ be the $G$-graded subring of $K$ generated by $A$ and $F$. Let $\mathfrak{m}$ be the $G$-homogeneous ideal of $B$ generated by elements in $F$. We claim that $\mathfrak{m}=B$. Otherwise, let $\mathfrak{p}$ be a maximal $G$-homogeneous ideal of $B$ containing $\mathfrak{m}$, then we can find a $G$-graded valuation subring $\mathcal{O}$ of $K$ dominating $B_{\mathfrak{p}}^G$. The existence of $\mathcal{O}$ is guaranteed by \cref{prop-valuationringchar}. It follows that $\mathcal{O}\in \{\{F\}\}$.

    We write $1=b_1 f_1+\cdots+b_nf_n$ for some $n\in \mathbb{Z}_{>0}$, $b_1,\ldots,b_n\in B$ and $f_1,\ldots,f_n\in F$. Then $X\{\{f_1,\ldots,f_n\}\}$ is empty.
\end{proof}

\begin{lemma}
    Let $A\subseteq B\subseteq K$ be $G$-graded subalgebras of $K$. Assume that both $A$ and $B$ are finitely generated over $k$. Then the following are equivalent:
    \begin{enumerate}
        \item $\mathbf{P}_{K/k}\{A\}=\mathbf{P}_{K/k}\{B\}$;
        \item $B$ is finite over $A$.
    \end{enumerate}
\end{lemma}
\begin{proof}
    
\end{proof}


\section{Miscellany}

\begin{proposition}\label{prop-noethjapfinite}
    Let $R$ be a noetherian N-2 integral domain. Let $\psi:R\rightarrow S$ be a ring homomorphism such that $S$ is reduced, torsion-free as $R$-module and has finite rank as $R$-module. Then $\psi$ is finite.
\end{proposition}
\cite[Page~122]{BGR}. Reproduce the argument later.
\begin{proof}
    As $\psi$ is injective by assumption, we may assume that $R$ is a subring of $S$ and $\psi$ is identity. The ring $S_{R\setminus\{0\}}=\Frac S$ is a finite-dimensional reduced $\Frac R$-algebra, hence as a ring, $\Frac S$ is the product of finitely many finite field extensions of $\Frac R$, say $K_1,\ldots,K_t$.  As $R$ is N-2, the integral closure $R_i$ of $R$ in $K_i$ is finite as $R$-module for $i=1,\ldots,t$. As $S$ is integral over $R$, we have
    \[
        S\subseteq R_1\times \cdots \times R_t.  
    \]
    As $R$ is noetherian, we conclude that $S$ is finite as $R$-module.
\end{proof}

\begin{lemma}
    Let $R$ be a commutative ring. A polynomial $a_0+a_1X+\cdots+a_nX^n\in R[X]$ is a unit if and only if $a_0$ is a unit in $R$ and $a_1,\ldots,a_n$ are nilpotents.
\end{lemma}

\printbibliography
\end{document}