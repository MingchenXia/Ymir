\input{preamble}


%\usepackage[color]{showkeys}
%\definecolor{refkey}{rgb}{0,0,1}

\title{Ymir}







\begin{document}


\maketitle


\tableofcontents

\chapter*{Morphisms between complex analytic spaces}\label{chap-morphismscomplex}


\section{Introduction}\label{sec-introduction-morphismscomplex}

\section{Open morphism}
\begin{definition}
    Let $f:X\rightarrow Y$ be a morphism of complex analytic spaces and $x\in X$. We say $f$ is \emph{open} at $x\in X$ if for any neighbourhood $U$ of $x$ in $X$, $f(U)$ is a neighbourhood of $f(x)$ in $Y$.
\end{definition}

\begin{proposition}\label{prop-openmapkernelnil}
    Let $f:X\rightarrow Y$ be a morphism of complex analytic spaces. Assume that $f$ is open at $x\in X$, then the kernel of $f_x^{\#}:\mathcal{O}_{Y,f(x)}\rightarrow \mathcal{O}_{X,x}$ is nilpotent.
\end{proposition}
The converse fails.
\begin{proof}
    Let $g_{f(x)}\in \mathcal{O}_{Y,f(x)}$ be an element in the kernel of $f_x^{\#}$. Up to shrinking $Y$, we may spread $g_{f(x)}$ to $g\in \mathcal{O}_Y(Y)$. Then $f^*g$ vanishes in a neighbourhood of $x$ in $X$. As $f$ is open at $x$, $g$ vanishes in the neighbourhood $f(U)$ of $f(x)$. By \cref{ConstructionComplex-cor-nullversionfunction} in \nameref{ConstructionComplex-chap-constructionComplex}, $g_{f(x)}$ is nilpotent.
\end{proof}



\section{Quasi-finite morphisms}

\begin{definition}
    Let $f:X\rightarrow Y$ be a morphism of complex analytic spaces. We say $f$ is \emph{quasi-finite} at $x\in X$ if $x$ is isolated in $f^{-1}(f(x))$.
    We say $f$ is \emph{quasi-finite} if $f$ is quasi-finite at all $x\in X$.
\end{definition}
This definition is purely topological. We will show that it is equivalent to an analytic definition.

\begin{proposition}\label{prop-quasifinitechar}
    Let $f:X\rightarrow Y$ be a morphism of complex analytic spaces and $x\in X$. Then the following are equivalent:
    \begin{enumerate}
        \item $f$ is quasi-finite at $x\in X$;
        \item $\mathcal{O}_{X,x}$ is quasi-finite over $\mathcal{O}_{Y,f(x)}$;
        \item $\mathcal{O}_{X,x}$ is finite over $\mathcal{O}_{Y,f(x)}$.
    \end{enumerate}
\end{proposition}
\begin{proof}
    (1) $\Leftrightarrow$ (2): By \cref{ConstructionComplex-cor-isolatedpointartin} in \nameref{ConstructionComplex-chap-constructionComplex}, $f$ is quasi-finite at $x\in X$ if and only if $\mathcal{O}_{X_{f(x)},x}=\mathcal{O}_{X,x}/\mathfrak{m}_{f(x)}\mathcal{O}_{X,x}$ is artinian. In other words, $\mathcal{O}_{X,x}/\mathfrak{m}_{f(x)}\mathcal{O}_{X,x}$ is finite-dimensional over $\mathbb{C}$. The latter is equivalent to that $\mathcal{O}_{X,x}$ is quasi-finite over $\mathcal{O}_{Y,f(x)}$. 

    (2) $\Leftrightarrow$ (3): This follows from \cref{Local-thm-analyticquasifiniteifffinite} in \nameref{Local-chap-local}.
\end{proof}


\section{Finite morphisms}


\begin{definition}
    A morphism of complex analytic spaces $f:X\rightarrow Y$ is \emph{finite} if its underlying map of topological spaces is topologically finite.

    We say a morphism of complex analytic spaces $f:X\rightarrow Y$ is \emph{finite at $x\in X$} if there is an open neighbourhood $U$ of $x$ in $X$ and $V$ of $f(x)$ in $Y$ such that $f(U)\subseteq V$ and the restriction $U\rightarrow V$ of $f$ is finite.

    Let $S$ be a complex analytic space. A \emph{finite analytic space over $S$} is a finite morphism $f:X\rightarrow S$ of complex analytic spaces. A morphism between finite analytic spaces over $S$ is a morphism of complex analytic spaces over $S$.
\end{definition}


\begin{proposition}\label{prop-projlemma}
    Let $n\in \mathbb{N}$ and $D$ be an open neighbourhood of $0$ in $\mathbb{C}^n$. 
    Let $X$ be a closed subspace of $D$ which intersections $\{(0,\ldots,0)\}\times \mathbb{C}$ at and only at $0$. Then there is a connected open product neighbourhood $B\times W\subseteq \mathbb{C}^{n-1}\times \mathbb{C}$ of $0$ in $D$ such that  the projection $B\times W\rightarrow B$ induces a finite morphism $h:X'\rightarrow B$ with $X'=X\cap (B\times W)$.
\end{proposition}
\begin{proof}
    We will denote the coordinates on $\mathbb{C}^{n-1}\times \mathbb{C}$ as $(z,w)$.

    Let $\mathcal{I}$ be the ideal of $X$ in $D$. By our assumption, we can choose $f_0\in \mathcal{I}_0$ such that $\deg_w f_0<\infty$ and $f_0(0)=0$. By \cref{Local-thm-Weierstrassprep} in \nameref{Local-chap-local}, we can find a Weierstrass polynomial $\omega_0=w^b+a_1w^{b-1}+\cdots+a_b\in \mathbb{C}\{ z_1,\ldots,z_{n-1} \}[w]$ such that $f_0=e\omega_0$ for some unit $e$ in $\mathbb{C}\{ z_1,\ldots,z_{n} \}$. We choose a product neighbourhood $B\times W\subseteq \mathbb{C}^{n-1}\times \mathbb{C}$ of $0$ in $D$ such that $\omega_0$ can be represented by $\omega\in \mathcal{O}_{\mathbb{C}^{n-1}}(B)[w]$ with $\omega|_{B\times W}\in \mathcal{I}(B\times W)$. Let $\pi:A\rightarrow B$ be the Weierstrass map defined by $\omega$. Then $\pi$ is finite by \cref{Complex-thm-Weiemapfiniteandopen} in \nameref{Complex-chap-complex}. 
    Up to shrinking $B$ and $W$, we may assume that $A\cap (B\times W)\rightarrow B$ is finite as well. Set $X':=X\cap (B\times W)$. The restriction $h:X'\rightarrow B$ of $\pi$ is then finite.
\end{proof}

\begin{corollary}\label{cor-projlemma}
    Let $n,k\in \mathbb{N}$ and $D$ be an open neighbourhood of $0$ in $\mathbb{C}^n$. 
    Let $X$ be a closed subspace of $D$ which intersections $\{(0,\ldots,0)\}\times \mathbb{C}^k$ at and only at $0$. Then there is a connected open product neighbourhood $B\times W\subseteq \mathbb{C}^{n-k}\times \mathbb{C}^k$ of $0$ in $D$ such that the projection $B\times W\rightarrow B$ induces a finite morphism $h:X'\rightarrow B$ with $X'=X\cap (B\times W)$.
\end{corollary}
\begin{proof}
    This follows from a repeted application of \cref{prop-projlemma}.
\end{proof}

\begin{proposition}\label{prop-finiteatpointcond}
    Let $f:X\rightarrow Y$ be a morphism of complex analytic spaces and $x\in X$. Then the following are equivalent:
    \begin{enumerate}
        \item $f$ is quasi-finite at $x$;
        \item $f$ is finite at $x$.
    \end{enumerate}
\end{proposition}
\begin{proof}
    (2) $\implies$ (1): This follows from This follows from \cref{Topology-prop-topfinitechar} in \nameref{Topology-chap-topology}.

    (1) $\implies$ (2): Write $y=f(x)$.  The assertion is local on both $X$ and $Y$. So we may assume that $U$ and $V$ are complex model spaces in domains $W\subseteq \mathbb{C}^k$ and $B\subseteq \mathbb{C}^d$ respectively with $x=0$ and $y=0$. Moreover, we may assume that $\{x\}=f'^{-1}(y)$. We have the following commutative diagram:
    \[
        \begin{tikzcd}
            &                                & U\times V \arrow[dd] \arrow[r, hook] & W\times B \arrow[dd] \\
U \arrow[r] \arrow[rrd,"f'"] & \Gamma_f \arrow[rd] \arrow[ru] &                                      &                      \\
            &                                & V \arrow[r, hook]                    & B                   
\end{tikzcd},
    \]
    where $\Gamma_{f'}$ denotes the graph of $f':U\rightarrow V$. As $\{x\}=f'^{-1}(y)$, we have $\mathbb{C}^k\times\{0\}$ intersects $\Gamma_f$ only at the origin. By \cref{cor-projlemma}, up to shrinking $W$ and $B$, we may guarantee that the projection $W\times B\rightarrow B$ induces a finite morphism $\Gamma_f\rightarrow B$ and the pushforward under this map preserves coherence. Observe that $U\rightarrow \Gamma_f$ is a biholomorphism, we conclude that $f'$ is finite. 
\end{proof}

\begin{corollary}
    Let $f:X\rightarrow Y$ be a morphism of complex analytic spaces. The following are equivalent:
    \begin{enumerate}
        \item $f$ is finite;
        \item $f$ is quasi-finite and proper.
    \end{enumerate}
\end{corollary}
\begin{proof}
    (1) $\implies$ (2): This follows from \cref{prop-finiteatpointcond}.

    (2) $\implies$ (1): This follows from \cref{Topology-prop-topfinitechar} in \nameref{Topology-chap-topology}.
\end{proof}

\begin{corollary}
    Let $f:X\rightarrow Y$ be a morphism of complex analytic spaces. Then the set
    \[
        \left\{ x\in X: f\text{ is quasi-finite at }x\right\}  
    \]
    is open.
\end{corollary}
\begin{proof}
    This follows from \cref{prop-finiteatpointcond}.
\end{proof}



\begin{thm}\label{thm-finitealgeqfiniteanalyticspace}
    Let $S$ be a complex analytic space. Then the functor $\Spec^{\An}_S$ defines an anti-equivalence from the category of finite $\mathcal{O}_S$-algebras to the category of finite analytic spaces over $S$.
\end{thm}
\begin{proof}
    We first observe that the functor is well-defined. This follows from \cref{ConstructionComplex-cor-specanfinitetopfinite} in \nameref{ConstructionComplex-chap-constructionComplex}.

    The functor is fully faithfull by \cref{ConstructionComplex-prop-morphismrelaffspaces} in \nameref{ConstructionComplex-chap-constructionComplex}. Suppose that $f:X\rightarrow S$ is a finite morphism of complex analytic spaces. We need to show that $X$ is isomorphic to $\Spec^{\An}_{S}\mathcal{A}$ for some finite $\mathcal{O}_S$-algebra $\mathcal{A}$ in $\CASCat_{/S}$.

    By \cref{ConstructionComplex-prop-moduletildepush} in \nameref{ConstructionComplex-chap-constructionComplex}, we necessarily have $\mathcal{A}\cong f_*\mathcal{O}_X$. So we need to show that the natural morphism $\Spec_S^{\An} f_*\mathcal{O}_X\rightarrow X$ over $S$ is an isomorphism. The problem is local on $S$. 

    Fix $s\in S$. Write $x_1,\ldots,x_n$ for the distinct points in $f^{-1}(s)$.
    Up to shrinking $S$, we may assume that $X$ is the disjoint union of $V_1,\ldots,V_n$, where $V_i$ is an open neighbourhood of $x_i$ in $X$. 
    We need to show that $X$ has the form $\Spec^{\An}_S \mathcal{B}$ for some $\mathcal{O}_S$-algebra $\mathcal{B}$ in $\CASCat_{/S}$.

    It suffices to handle each $V_i$ separately, so we may assume that $f^{-1}(s)=\{x\}$ consists of a single point. Then $\mathcal{O}_{X,x}$ is finite over $\mathcal{O}_{S,s}$ by \cref{prop-quasifinitechar}. Up to shrinking $S$, we may assume that $\mathcal{O}_{X,x}$ spreads out to a finite $\mathcal{O}_S$-algebra $\mathcal{B}$. Let $X'=\Spec^{\An}_{S}\mathcal{B}$. There is a unique point $x'$ of $X'$ over $s$ and $X'_{x'}$ is isomorphic to $X_x$ over $S_s$. By \cref{Topology-lma-opennhfiberclosedmap} in \nameref{Topology-chap-topology}, up to shrinking $S$, we may assume that $X$ is isomorphic to $X'$ over $S$. We conclude.
\end{proof}

\begin{corollary}\label{cor-finitepushcoh}
    Let $f:X\rightarrow Y$ be a finite morphism of complex analytic spaces and $\mathcal{M}$ be a coherent sheaf of $\mathcal{O}_X$-modules, then $f_*\mathcal{M}$ is coherent. Moreover, $f_*$ is exact from $\CohCat(\mathcal{O}_X)$ to
    $\CohCat(\mathcal{O}_Y)$.
\end{corollary}
\begin{proof}
    This follows from \cref{ConstructionComplex-cor-specpushcohiscoh} in \nameref{ConstructionComplex-chap-constructionComplex} and \cref{thm-finitealgeqfiniteanalyticspace}.
\end{proof}

\begin{corollary}
    Let $X$ be a reduced complex analytic space. Then 
    \begin{enumerate}
        \item $\bar{X}$ is normal;
        \item $p:\bar{X}\rightarrow X$ is finite and surjective;
        \item There is a nowhere dense analytic set $Y$ in $X$ such that $p^{-1}(Y)$ is nowhere dense in $\bar{X}$ and the morphism $\bar{X}\setminus p^{-1}(Y)\rightarrow X\setminus Y$ induced by $p$ is an isomorphism.
    \end{enumerate}
    Conversely, these conditions determines $\bar{X}$ up to a unique isomorphism in $\CASCat_{/X}$.
\end{corollary}
\begin{proof}
    These properties are established in \cref{PropertyComplex-prop-reducedspacenormalizationchar} in \nameref{PropertyComplex-chap-propcomplex}. We need to prove the uniqueness.

    Let $p:X'\rightarrow X$ be a morphism satisfying the three conditions. We need to show that $X'$ is canonically isomorphic to $\bar{X}$ in $\CASCat_{/X}$.
    By (2) and \cref{thm-finitealgeqfiniteanalyticspace}, it suffices to show that $p_*\mathcal{O}_{X'}$ is canonically isomorphic to $\bar{\mathcal{O}}_{X}$. By (1), and the universal property of normalization, there is a canonical morphism
    \[
        p_*\mathcal{O}_{X'}\rightarrow \bar{\mathcal{O}}_{X}
    \]
    of $\mathcal{O}_X$-algebras. We will show that this map is an isomorphism.

    The problem is local. Let $x\in X$. By (3) and \cref{ConstructionComplex-cor-orderrelationsubgermideal} in \nameref{ConstructionComplex-chap-constructionComplex}, up to shrinking $X$, we can find $f\in \mathcal{O}_X(X)$ such that $f(y)=0$ for all $y\in Y$ and $f_x$ is a non-zero divisor in $(p_*\mathcal{O}_{X'})_x$. Up to shrinking $X$, we may assume that $f_y$ is a non-zero divsior in $(p_*\mathcal{O}_{X'})_y$ for all $y\in X$. By (3), we have
    \[
        \mathcal{O}_X|_{X\setminus Y}\rightarrow (p_*\mathcal{O}_{X'})|_{X\setminus Y}  
    \]
    is an isomorphism. It follows that 
    \[
        f p_*\mathcal{O}_{X'}\rightarrow \mathcal{O}_X  
    \]
    is injective. We then have an injective homomorphism:
    \[
        p_*\mathcal{O}_{X'}\rightarrow \mathcal{O}_X \xrightarrow{\times f} \mathcal{O}_X\xrightarrow{\times f^{-1}}\mathcal{O}_X[f^{-1}]. 
    \]
    For each $y\in X$, we deduce that $(p_*\mathcal{O}_{X'})_y$ is in the total ring of fraction of $\mathcal{O}_{X,y}[f_y^{-1}]$. But $(p_*\mathcal{O}_{X'})_y$ is finite and integral over $\mathcal{O}_{X,y}$, so is isomorphic to $\overline{\mathcal{O}_{X,y}}$ as $\mathcal{O}_{Y,y}$-algebras. 
\end{proof}

\begin{corollary}
    Let $f:X\rightarrow Y$ be a finite morphism of complex analytic spaces. Assume that $x\in X$ is a point such that $(f_*\mathcal{O}_X)_{f(x)}$ is torsion-free as an $\mathcal{O}_{Y,f(x)}$-module and $Y$ is integral at $f(x)$. Then $f$ is open at $x$.
\end{corollary}
\begin{proof}
    If not, we can choose open neighbourhoods $U$ of $x$ in $X$ and $V$ of $y:=f(x)$ in $Y$ such that $f(U)\subseteq V$ such that the induced morphism $g:U\rightarrow V$ is finite and $f(U)$ is not a neighbourhood of $y$ in $Y$. 
    Up to shrinking $Y$, we can find $h\in \mathcal{O}_Y(Y)$ such that $h_y\neq 0$ while $h$ vanishes on $f(U)$. 
     Observe that $f(U)$ is an analytic set in $Y$ by  \cref{cor-finitepushcoh}. It follows from \cref{ConstructionComplex-cor-nullversionfunction} in \nameref{ConstructionComplex-chap-constructionComplex} that there is $t\in \mathbb{Z}_{>0}$ such that
     \[
        h_y^t (g_*\mathcal{O}_U)_y=0.   
     \]
     As $\mathcal{O}_{Y,y}$ is integral, this implies that $(g_*\mathcal{O}_U)_y$ is torsion as an $\mathcal{O}_{Y,f(x)}$-module. This is a contradiction, as $(f_*\mathcal{O}_X)_y$ as an $\mathcal{O}_{Y,f(x)}$-module is torsion-free by assumption.
\end{proof} 

\begin{lemma}\label{lma-torsionfreelocuscoana}
    Let $X$ be an integral complex analytic space and $\mathcal{M}$ be a coherent sheaf of $\mathcal{O}_X$-modules. Then
    \[
        \left\{x\in X: \mathcal{M}\text{ is torsion-free at }x \right\}
    \]
    is co-analytic in $X$.
\end{lemma}
\begin{proof}
    It suffices to show that $\Supp \mathcal{T}(\mathcal{M})$ is an analytic set in $X$. As $X$ is integral, $\mathcal{T}(\mathcal{M})$ is just the kernel of the morphism $\mathcal{M}\rightarrow \mathcal{M}^{\vee\vee}$.
\end{proof}

\begin{corollary}
    Let $f:X\rightarrow Y$ be a finite morphism of complex analytic spaces. Assume that $Y$ is integral. Let $x\in X$ be a point such that $X$ is integral at $x$ and $f$ is open at $x$, then there is an open neighbourhood $U$ of $x$ in $X$ such that $f|_U:U\rightarrow Y$ is open.
\end{corollary}
\begin{proof}
    Let $y=f(x)$.
    The problem is local on $Y$.
    By \cref{prop-finiteatpointcond}, we may assume that $\{x\}=f^{-1}(y)$. By \cref{cor-finitepushcoh}, $f_*\mathcal{O}_X$ is coherent. By \cref{lma-torsionfreelocuscoana}, it suffices to show that it is torsion-free.
    
    Observe that $(f_*\mathcal{O}_{X})_y\cn \mathcal{O}_{X,x}$. By \cref{prop-openmapkernelnil}, $f^{\#}_x:\mathcal{O}_{Y,y}\rightarrow \mathcal{O}_{X,x}$ is injective. As $\mathcal{O}_{X,x}$ is integral by our assumption, we conclude.
\end{proof}

\begin{lemma}\label{lma-liftingactive}
    Let $f:X\rightarrow Y$ be a finite morphism of reduced complex analytic spaces and $x\in X$. Assume that $x\in X$, then there is a non-zero divisor $h\in \mathfrak{m}_{f(x)}$ such that $f^{\#}_x(h)$ is a non-zero divisor in $\mathcal{O}_{X,x}$.
\end{lemma}
\begin{proof}
    By \cref{prop-finiteatpointcond}, the problem is local on $X$. We may assume that $X$ can be decomposed into irreducible components at $x$:
    \[
        X=A_1\cup \cdots\cup A_s.    
    \] 
    By \cref{cor-finitepushcoh}, $B_j:=f(A_j)$ is an ananlytic set in $Y$ for $j=1,\ldots,s$. By our assumption, $x$ is not an isolated point in $A_j$, so $y$ is not an isolated point in $B_j$ for $j=1,\ldots,s$. Take a non-zero divisor $h\in \mathfrak{m}_{Y,y}$. Up to shrinking $Y$, we may assume that $h$ spreads to $g\in \mathcal{O}_Y(Y)$. Observe that $W(f^*g)\cap A_j$ is not a neighbourhood of $x$ in $A_j$ for all $j=1,\ldots,s$. So $f^{\#}_xh$ is not a zero divisor.
\end{proof}

\begin{thm}\label{thm-finitemapdim}
    Let $f:X\rightarrow Y$ be a finite morphism of complex analytic spaces and $y\in Y$. Then
    \[
        \dim_y f(X)=\max_{x\in f^{-1}(y)}\dim_x X.  
    \]
\end{thm}
The left-hand side makes sense because $f(X)$ is an analytic set in $Y$ by \cref{cor-finitepushcoh}.
\begin{proof}
    We may assume that $X$ and $Y$ are reduced and $f(X)=Y$.

    \textbf{Step~1}. We reduce to the case where $f^{-1}(y)=\{x\}$ for some $x\in X$.

    Let $x_1,\ldots,x_t$ be the distinct points in $f^{-1}(y)$. The problem is local on $Y$.
    By \cref{Topology-thm-localstructuretopfinitemap} in \nameref{Topology-chap-topology} and \cref{prop-finiteatpointcond}, up to shrinking $Y$, we may assume that $X$ is the disjoint union of open neighbourhoods $U_1,\ldots,U_t$ of $x_1,\ldots,x_t$ and $U_j\rightarrow V$ is finite for each $j=1,\ldots,t$. It suffices to apply the special case to each $U_j\rightarrow V$ for $j=1,\ldots,t$.

    \textbf{Step~2}. We prove the theorem after the reduction in Step~1.

    We make an induction on $d:=\dim_x X$. There is nothing to prove when $d=0$. Assume that $d\geq 1$. By \cref{lma-liftingactive}, we can choose a non-zero divisor $g_y\in \mathfrak{m}_{Y,g_y}$ such that $f^{\#}_x(g_y)$ is a non-zero divisor in $\mathcal{O}_{X,x}$. Up to shrinking $Y$, we may assume that $g$ spreads to $g\in \mathcal{O}_Y(Y)$. It suffices to apply our inductive hypothesis to $W(f^{\#}_x(g_y))\subseteq W(g_y)$.
\end{proof}




\begin{corollary}\label{cor-finiteopensurjthinsetpre}
    Let $f:X\rightarrow Y$ be a finite open surjective morphism of complex analytic spaces. Assume that $A$ is a thin subset of $X$ of order $k\in \mathbb{Z}_{>0}$, then $f(A)$ is a thin subset of $Y$ of order $k$.
\end{corollary}
\begin{proof}
    We may assume that $X$ and $Y$ are reduced.
    By \cref{prop-finiteatpointcond} and the fact that $f$ is open, the problem is local on $X$, we may assume that $A$ is an analytic subset of $X$. Let $x\in A$. It suffices to handle the case where $A$ is irreducible at $x$ and $x$ is the only point in $f^{-1}(f(x))$.
    By \cref{cor-finitepushcoh}, $f(A)$ is an irreducible analytic subset of $Y$.

    We may assume that $Y$ is irreducible at $y:=f(x)$. Then
    \[
        \codim_y(f(A),Y)=\dim_y Y-\dim_y f(A).  
    \]
    By \cref{thm-finitemapdim}, $\dim_y Y=\dim_x X$, $\dim_y f(A)=\dim_x A$. It follows that
    \[
        \codim_y(f(A),Y)=\dim_x X-\dim_x A  \geq \codim_x(A,X)\geq k.
    \]
\end{proof}

\begin{proposition}\label{prop-finitemorphismopen}
    Let $f:X\rightarrow Y$ be a finite morphism of complex analytic spaces and $x\in X$. Assume that $Y$ is unibranch at $f(x)$. Assume that $\dim_x X=\dim_{f(x)}Y$, then $f$ is open at $x$.
\end{proposition}
\begin{proof}
    We may assume that $X$ and $Y$ are both reduced. Let $y=f(x)$. By \cref{prop-finiteatpointcond}, we may assume that $\{x\}=f^{-1}(y)$. By \cref{cor-finitepushcoh}, $f(X)$ is an analytic set in $Y$. By \cref{thm-finitemapdim},
    \[
        \dim_y f(X)=\dim_x X.  
    \]
    As $Y$ is irreducible at $f(x)$, we conclude that $f(X)_y=X_y$ and hence $f(X)$ is a neighbourhood of $y$.
\end{proof}
\begin{corollary}\label{cor-quasifiniemoropen}
    Let $f:X\rightarrow Y$ be a quasi-finite morphism of equidimensional complex analytic spaces of dimension $d\in \mathbb{N}$. Assume that $Y$ is unibranch. Then $f$ is open. 
\end{corollary}
The corollary fails if $Y$ is not unibranch.
\begin{proof}
    By \cref{prop-finiteatpointcond}, $f$ is finite at all $x\in X$. It suffices to apply \cref{prop-finitemorphismopen}.
\end{proof}


\begin{lemma}\label{lma-finiteopenbranch}
    Let $f:X\rightarrow Y$ be a finite open morphism of reduced complex analytic spaces. Assume that $Y$ is a complex manifold. Then $f$ is a branched covering.
\end{lemma}
\begin{proof}
    The statement is local on $Y$, so we may assume that $Y$ is an open neighbourhood of $0$ in $\mathbb{C}^n$ for some $n\in \mathbb{N}$. By \cref{prop-finiteatpointcond}, we may assume that $\pi^{-1}\{0\}$ consists of a single point and $X$ is a closed analytic subspace of a domain $V$ in $\mathbb{C}^d$ for some $d\in \mathbb{N}$. Replacing $X$ by the graph of $f$, we may assume that $X$ is a closed analytic subspace of $V\times Y$ and $f$ is the restriction of the projection map $V\times Y\rightarrow V$.  In this case, the result follows from the local description lemma. \textcolor{red}{Reproduce CAS p72!} 
\end{proof}
\begin{corollary}\label{cor-localdesequidimspace}
    Let $X$ be an equidimensional complex analytic space of dimension $d$ and $x\in X$. Then there is an open neighbourhood $U$ of $x$ in $X$ and a connected domain $V\in \mathbb{C}^d$  such that there is a branched covering $U\rightarrow V$.

    In fact, given any system of parameters $f_1,\ldots,f_d\in \mathcal{O}_{X,x}$, we can define sch a morphism sending $x$ to $0$ and the corresponding local ring homomorphism at $x$ is 
    \[
        \mathcal{O}_{\mathbb{C}^d,0}\rightarrow \mathcal{O}_{X,x}  
    \]
    given by $f_1,\ldots,f_d$.
\end{corollary}
\begin{proof}
    This follows from \cref{ConstructionComplex-thm-morphismdefinedbygeneratorlocal} in \nameref{ConstructionComplex-chap-constructionComplex}, \cref{lma-finiteopenbranch} and \cref{cor-quasifiniemoropen}.
\end{proof}


\begin{corollary}\label{cor-takeallvalues}
    Let $X$ be a complex analytic space and $x\in X$. Assume that $X$ is unibranch at $x$. Let $f\in \mathcal{O}_{X,x}$. We assume that $f$ is not constant and $\dim_x X\geq 1$, then for any open neighbourhood $U$ of $x$ in $X$ such that $f$ spreads to $g\in \mathcal{O}_X(U)$, there is $\epsilon>0$ such that $g$ takes all values $c\in \mathbb{C}$ with $|c-f(x)|<\epsilon$.
\end{corollary}
\begin{proof}
    We may assume that $X$ is reduced and $f(x)=0$. Then $f$ is a non-zero divisor in $\mathcal{O}_{X,x}$. We can find a system of parameters $f,g_1,\ldots,g_{n-1}$ with $n=\dim_x X$ such that $f,g_1,\ldots,g_{n-1}$ induce a branched covering $X\rightarrow V$ sending $x$ to $0$ after shrinking $X$, where $V$ is an open neighbourhood of $0$ in $\mathbb{C}^n$. This follows from \cref{cor-localdesequidimspace}. As the branched covering is open by \cref{prop-finitemorphismopen}, we conclude.
\end{proof}

\begin{thm}\label{thm-finiteopensurjbranchedcov}
    Let $f:X\rightarrow Y$ be a finite open surjective morphism of reduced complex analytic spaces, then $f$ is a branched covering.
\end{thm}
\begin{proof}
    Let $x\in X$ and $y=f(x)$. As $f$ is open, it suffices to find open neighbourhoods $U$ of $x$ in $X$ and $V$ of $y$ in $Y$ such that the morphism $U\rightarrow V$ induced by $f$ is a branched covering. 
    We first take $U$ small enough so that $U$ can be decomposed into prime components at $x$:
    \[
        U=X_1\cup\cdots\cup X_s.
    \]  
    We can assume that $X_i\cap X_j$ is thin in $U$ for $i,j=1,\ldots,s$, $i\neq j$. Up to shrinking $U$, we may assume that $U\rightarrow V$ is finite \cref{prop-finiteatpointcond} for some open neighbourhood $V$ of $y$ in $Y$. As $f$ is open, we may take $V=f(U)$.
    Observe that $f(X_i)$ is analytic in $V$ for $i=1,\ldots,s$ by \cref{cor-finitepushcoh}. Moreover, $f(X_i)$ is irreducible at $y$ for $i=1,\ldots,s$. By \cref{PropertyComplex-thm-equidimlocusopen} in \nameref{PropertyComplex-chap-propcomplex}, we may assume that $f(X_i)$ is equidimensional of dimension $n_i\in \mathbb{N}$ for $i=1,\ldots,s$.
    
    By \cref{cor-localdesequidimspace}, up to shrinking $V$, we may assume that there is a branched covering $\eta_i:f(X_i)\rightarrow V_i$, where $V_i$ is a connected domain in $\mathbb{C}^{n_i}$ for $i=1,\ldots,s$. By \cref{lma-finiteopenbranch}, $\eta_i\circ f|_{X_i}$ is a branched covering for $i=1,\ldots,s$.  It follows that $X_i\rightarrow \pi(X_i)$ is a branched covering for $i=1,\ldots,s$. This readily implies that $f$ is a branched covering.
\end{proof}



\begin{definition}\label{def-charpolmanifold}
    Let $b\in \mathbb{Z}_{>0}$, $f:X\rightarrow Y$ be a $b$-sheeted branched covering with $Y$ being a connected complex manifold. Let $A$ be a thin set in $X$. Take a critical locus $T$ of $f$ containing $f(A)$. 
    
    Consider $g\in \mathcal{O}_X(X\setminus A)$. We define a monic polynomial
    \[
        \chi_g(w)(y):=\prod_{x\in f^{-1}(y)} (w-g(x))\in \mathcal{O}_Y(Y\setminus T)[w]. 
    \]
    By \cref{PropertyComplex-thm-Riemannextsmo} in \nameref{PropertyComplex-chap-propcomplex}, $\chi_g$ can be uniquely extended to $\chi_g\in \mathcal{O}_Y(Y\setminus f(A))[w]$. The monic polynomial $\chi_g$ is called the \emph{characteristic polynomial} of $g$ (with respect to $f$).
\end{definition}

\begin{proposition}\label{prop-charpoly}
    Let $b\in \mathbb{Z}_{>0}$, $f:X\rightarrow Y$ be a $b$-sheeted branched covering with $Y$ being a connected complex manifold. Let $A$ be a thin set in $X$ and $g\in \mathcal{O}_X(X\setminus A)$. Let $\chi_g\in \mathcal{O}_Y(Y\setminus f(A))[w]$ be the characteristic polynomial of $g$. Then $\chi_g(g)=0$.

    If either of the following conditions hold:
    \begin{enumerate}
        \item $g$ is locally bounded near $A$;
        \item $A$ is thin of order $2$ in $Y$.
    \end{enumerate}
    Then $\chi_g$ can be uniquely extended to $\chi_g\in \mathcal{O}_Y(Y)[w]$.
\end{proposition}
\begin{proof}
    Only the second part is non-trivial. By \cref{cor-finiteopensurjthinsetpre}, $f$ is open. 
    By \cref{cor-finiteopensurjthinsetpre}, $f(A)$ is thin in $Y$ and under assumption (2), $f(A)$ is thin of order $2$ in $Y$. It suffices to apply \cref{PropertyComplex-thm-Riemannextsmo} in \nameref{PropertyComplex-chap-propcomplex}.
\end{proof}

\begin{proposition}\label{prop-determinanthol}
    Let $b\in \mathbb{Z}_{>0}$, $f:X\rightarrow Y$ be a $b$-sheeted branched covering with $Y$ being a connected complex manifold. Let $A$ be a thin set in $X$ and $e,g\in \mathcal{O}_X(X\setminus A)$. Take a critical locus $T$ of $f$ containing $f(A)$. 
    Consider the $b\times b$-matrice 
    \[
        M(y)=
        \begin{bmatrix}
            1 & e(x_1) & \dots & e(x_1)^{b-1}\\
            1 & e(x_2) & \dots & e(x_2)^{b-1}\\
            &&\ddots &\\
            1 & e(x_b) & \dots & e(x_b)^{b-1}
        \end{bmatrix}    
    \]
    and $M_i(y)$ is $M(y)$ with the $i$-th colomn replace by 
    \[
    \begin{bmatrix}
        g(x_1)\\
        g(x_2)\\
        \vdots\\
        g(x_b)
    \end{bmatrix}    
    \]
     for
     $i=0,\ldots,b-1$, where $y\in Y\setminus T$ and $x_1,\ldots,x_{b}$ are the distinct points in $f^{-1}(y)$. Then there are $\Delta_e,c_0,\ldots,c_{b-1}\in \mathcal{O}_Y(Y\setminus f(A))$ such that for all $y\in Y\setminus T$, 
     \[
        \Delta_e(y)=(\det M(y))^2,\quad c_i(y)=\det M(y)\cdot \det M_i(y) 
     \]
     for $i=0,\ldots,b-1$. If either of the following conditions holds:
     \begin{enumerate}
        \item $e$ and $g$ are locally bounded near $A$;
        \item $A$ is thin of order $2$ in $X$,
     \end{enumerate}
     then we can take $\Delta_e,c_0,\ldots,c_{b-1}\in \mathcal{O}_Y(Y)$
\end{proposition}
The function $\Delta_e$ is called the \emph{discriminant} of $e$. We say $e$ is \emph{primitive} with respect to $f$ if $\Delta$ is not identically $0$.
\begin{proof}
    We first observe that $\det M(y)$ and $\det M_i(y)$ are independent of the ordering of $x_1,\ldots,x_b$ by elementary lineary algebra, where $i=1,\ldots,b$. The entries of $M(y)$ and $M_i(y)$ can all be taken to be holomorphic outside $T$, so $\Delta_e,c_0,\ldots,c_{b-1}\in \mathcal{O}_Y(Y\setminus T)$ are defined and the desired equation holds. By \cref{PropertyComplex-thm-Riemannextsmo} in \nameref{PropertyComplex-chap-propcomplex}, these functions can be extended uniquely into $\mathcal{O}_Y(Y\setminus f(A))$. 

    By \cref{cor-finiteopensurjthinsetpre}, $f(A)$ is thin in $Y$ and under assumption (2), $f(A)$ is thin of order $2$ in $Y$. Applying \cref{PropertyComplex-thm-Riemannextsmo} in \nameref{PropertyComplex-chap-propcomplex}, we conclude the last assertion.
\end{proof}




\begin{corollary}\label{cor-existenceprimi}
    Let $b\in \mathbb{Z}_{>0}$, $f:X\rightarrow Y$ be a $b$-sheeted branched covering with $Y$ being a connected complex manifold. A primitive element $e\in \mathcal{O}_X(X)$ exists if $X$ is holomorphically separable.
\end{corollary}
\begin{proof}
    Take a critical locus $T$ of $f$. 
    Let $y\in X\setminus T$. Let $x_1,\ldots,x_b$ be distinct points of $f^{-1}(y)$. For each $i,j=1,\ldots,b$ with $i<j$, we can find a $g_{ij}\in \mathcal{O}_X(X)$ with $g(x_i)\neq g(x_j)$. A suitable linear combination of $g_{ij}$'s works.
\end{proof}

\begin{proposition}\label{prop-univdenor}
    Let $b\in \mathbb{Z}_{>0}$, $f:X\rightarrow Y$ be a $b$-sheeted branched covering with $Y$ being a connected complex manifold. Let $A$ be a thin set in $X$. 

    Let $e\in \mathcal{O}_X(X\setminus A)$ primitive element with respect to $f$.
    Then for each $g\in \mathcal{O}_X(X\setminus A)$, we have canonical polynomial $\Omega\in \mathcal{O}_Y(Y\setminus \pi(A))[X]$ such that 
    \[
        \Delta_e g=\Omega(e)  \quad \text{on }X\setminus A.
    \]
    If either of the following conditions holds:
    \begin{enumerate}
       \item $e$ and $g$ are locally bounded near $A$;
       \item $A$ is thin of order $2$ in $X$,
    \end{enumerate}
    then we can take $\Omega\in \mathcal{O}_Y(Y)[X]$.
\end{proposition}
In the traditional terminology, $\Delta_e$ is a \emph{universal denominator} of the $\mathcal{O}_Y(Y)$-module $\mathcal{O}_X(X)$ if one of the two assumptons is satisfied.
\begin{proof}
    Take a critical locus $T$ of $f$ containing $f(A)$. 
    Consider $y\in Y\setminus T$ with fibers $x_1,\ldots,x_b$. Consider the system of $b$-linear equations:
    \[
      \Delta_e(y)g(x_i) =c_0(y)+c_1(y)e(x_i)+\cdots+c_{b-1}(y)e(x_i)^{b-1} 
    \]
    for $j=1,\ldots,b$. By Cramer's rule, if we use the notations of \cref{prop-determinanthol}, if $\det M(y)\neq 0$,
    the unique solution is then
    \[
        c_i(y) = (\det M(y))^{-1}\Delta(y)\det M_{i}(y)=\det M(y)\cdot \det M_i(y)
    \]
    for $i=0,\ldots,b-1$. From \cref{prop-determinanthol}, $c_0,\ldots,c_{b-1}\in \mathcal{O}_Y(Y\setminus \pi(A))$. It suffices to take 
    \[
        \Omega=c_0+c_1X+\cdots+c_{b-1}w^{b-1}.  
    \]
    It is obvious that on $X\setminus (A\cup W(\Delta))$, 
    \[
        \Delta_e g=\Omega(e).  
    \]
    The same holds on $X\setminus A$ by continuity. The last asertion follows from \cref{prop-determinanthol}. 
\end{proof}


\begin{corollary}[Riemann extension theorem]\label{cor-Riemannextgeneral}
    Let $X$ be a reduced equidimensional complex analytic space  of dimension $n\in \mathbb{N}$ and $A$ be a thin set in $X$. Let $f\in \mathcal{O}_X(X\setminus A)$. Assume one of the following conditions holds:
    \begin{enumerate}
        \item $f$ is locally bounded near $A$;
        \item $A$ is thin of order $2$.
    \end{enumerate}   
    Then there is an element $g\in \overline{O}_X(X)$ extending $f$.
\end{corollary}
\begin{proof}
    The uniquenss is obvious, we prove the existence. The problem is local on $X$, we may assume that $X$ is holomorphically separable.
    By \cref{cor-localdesequidimspace}, we may take a connected complex manifold $Y$ of dimension $Y$, $b\in \mathbb{Z}_{>0}$,a $b$-sheeted branched covering $f:X\rightarrow Y$. By \cref{cor-existenceprimi}, we can find a primitive element $e\in \mathcal{O}_X(X)$. By \cref{prop-univdenor} and \cref{prop-charpoly}, it suffices to take $g=\Omega(e)/\Delta_e$, where $\Omega_e$ is the polynomial in   \cref{prop-univdenor}.
\end{proof}

\begin{corollary}\label{cor-Riemannextnormal}
    Let $X$ be a normal complex analytic space. Then the canonical map
    \[
        \mathcal{O}_X(X)\rightarrow \mathcal{O}_X(X^{\reg})  
    \]
    is an isomorphism.
\end{corollary}
\begin{proof}
    By \cref{PropertyComplex-prop-reducedspacefunctiondetermineholo} in \nameref{PropertyComplex-chap-propcomplex}, the map is injective. Take $f\in \mathcal{O}_X(X^{\reg})$, we need to extend it to $g\in \mathcal{O}_X(X)$. The problem is local on $X$.
    As $X$ is normal, it is equidimensional at all points. By shrinking $X$, we may assume that $X$ is equidimensional of some dimension $n\in \mathbb{N}$. Recall that $X^{\Sing}$ is thin of order $2$ in $X$ by \cref{PropertyComplex-prop-normalspacesingcodim2} in \nameref{PropertyComplex-chap-propcomplex}, so we can apply \cref{cor-Riemannextgeneral}.
\end{proof}


\begin{corollary}\label{cor-complthininconnectedconn2}
    Let $X$ be a connected normal complex analytic space then $X^{\reg}$ is connected.
\end{corollary}
\begin{proof}
    If not, we can find a continuous function $f:X^{\reg}\rightarrow \{0,1\}$ which is not constant. By \cref{cor-Riemannextnormal}, $f$ can be extended to $g\in \mathcal{O}_X(X)$. This contradicts the fact taht $X$ is connected.
\end{proof}

\begin{corollary}\label{cor-normirrdimpointequal}
    Let $X$ be an irreducible complex analytic space and $A$ be an analytic set in $X$. Suppose that there is $x\in A$ with $\dim_x A=\dim_x X$, then $A=X$.
\end{corollary}
\begin{proof}
    We may assume that $X$ is irreducible.
    By \cref{thm-finitemapdim}, we may assume that $X$ is normal.

    Endow $A$ with the reduced induced structure.
    As $\dim_x A=\dim_x X$, $\Spec \mathcal{O}_{X,x}=\Spec \mathcal{O}_{A,x}$ has a common irreducible component. By Nullstellensatz, $\Int A$ is non-empty. So $A':=A\setminus X^{\Sing}$ is non-empty and open in $X^{\reg}$. We need to show that $A'=X^{\reg}$, taking closure we then conclude.

    Suppose that $A'\neq X^{\reg}$. Then $\overline{A'}\cap X^{\reg}$ is a non-empty closed in $X^{\reg}$, which is connected by \cref{cor-complthininconnectedconn2}. So 
    \[
        \overline{A'}\cap X^{\reg}\neq A',
    \]
    as otherwise, $X^{\reg}=(\overline{A'}\cap X^{\reg})\cup (X^{\reg}\setminus A')$. Take $a\in (\overline{A'}\cap X^{\reg})\setminus A'$. Take a connected neighbourhood $U$ of $a$ in $X^{\reg}$ and finitely many holomorphic functions $f_1,\ldots,f_k\in \mathcal{O}_X(U)$ so that $U\cap A=W(f_1,\ldots,f_k)$. As $U\cap A'\neq \emptyset$, $f_1,\ldots,f_k$ vanishes identically in $U$ by IdentitÃ¤tssatz. In particular, $a\in A'$, which is a contradiction.
\end{proof}

\begin{corollary}\label{cor-liftmorphismtonormalization}
    Let $f:X\rightarrow Y$ be a morphism of reduced complex analytic spaces. Let $Z\subseteq Y$ be the non-normal locus. Assume that $f^{-1}(Z)$ is nowhere dense in $X$ (for example when $X$ is irreducible and $f$ is surjective), then there is a unique morphism $\bar{f}:\bar{X}\rightarrow \bar{Y}$ such that the following diagram commutes:
    \[
        \begin{tikzcd}
            \bar{X} \arrow[r, "\bar{f}"] \arrow[d] & \bar{Y} \arrow[d] \\
            X \arrow[r, "f"]                       & Y                
        \end{tikzcd}.  
    \]
\end{corollary}
Recall that $Z$ is an analytic set in $Y$ by \cref{PropertyComplex-thm-normallocusopen} in \nameref{PropertyComplex-chap-propcomplex}.
\begin{proof}
    The uniqueness is clear. Let $Z'$ be the inverse image of $Z$ in $\bar{Y}$ and $Z''$ be the inverse image of $Z$ in $\bar{X}$. By our assumption, $Z''$ is thin in $\bar{X}$. By construction, $\eta:\bar{Y}\setminus Z'\rightarrow Y\setminus Z$ is an isomorphism, so we get a morphism $g:\bar{X}\setminus Z''\rightarrow \bar{Y}\setminus Z'$ completion the commutative diagram
    \[
        \begin{tikzcd}
            \bar{X}\setminus Z'' \arrow[r] \arrow[d] & \bar{Y}\setminus Z' \arrow[d] \\
            X \arrow[r, "f"]                         & Y                            
        \end{tikzcd}.  
    \] 
    Let $p\in Z''$. We need to extend $g$ to a neighbourhood of $p$. Choose an open neighbourhood $V\subseteq \bar{Y}$ of the preimage of $p$ in $\bar{X}$ which admits a closed immersion into a bounded domain $D\subseteq \mathbb{C}^n$ for some $n\in \mathbb{N}$. There is an open neighbourhood $U\subseteq \bar{X}$ of $p$ such that $g$ maps $U\setminus Z''\rightarrow V$. The induced morphism $U\setminus Z''\rightarrow D$ is given by bounded holomorphic functions in $\mathcal{O}_{U\setminus Z''}(U\setminus Z'')$. By \cref{cor-Riemannextgeneral}, we get an extension $U\rightarrow D$. But this morphism factorizes through $U\rightarrow V$ as $U$ is reduced, we conclude.
\end{proof}


\begin{corollary}\label{cor-irreduciblesetschar}
    Let $X$ be a complex analytic space. Then the following are equivalent:
    \begin{enumerate}
        \item $X$ is irreducible;
        \item If we write $X=Y_1\cup Y_2$ with $Y_1,Y_2$ being analytic sets in $X$, then $X=Y_1$ or $X=Y_2$.
    \end{enumerate}
\end{corollary}
\begin{proof}
    We may assume that $X$ is reduced.

    (1) $\implies$ (2): We may assume that $X$ is normal.
    Suppose $X=Y_1\cup Y_2$ with $Y_1,Y_2$ being analytic sets in $X$. Then $Y_1\cap Y_2$ is not empty, as otherwise, $X$ is not even connected. Let $x\in Y_1\cap Y_2$. We then have $X_x=Y_{1,x}\cup Y_{2,x}$. This contradicts the fact that $\mathcal{O}_{X,x}$ is integral unless $Y_{1,x}\subseteq Y_{2,x}$ or $Y_{1,x}\subseteq Y_{2,x}$, which is impossible by \cref{cor-normirrdimpointequal}.

    (2) $\implies$ (1): Suppose that $X$ is not irreducible. Then the normalization $\bar{X}$ is not connected, say $\bar{X}=Y_1'\cup Y_2'$, where $Y_1,Y_2$ are disjoint clopen sets in $\bar{X}$. Let $\pi:\bar{X}\rightarrow X$ be the normalization morphism. Then
    \[
        X=\pi(Y_1')\cup \pi(Y_2').  
    \]
    By our assumption, either  $X=\pi(Y_1')$ or $X=\pi(Y_2')$. We assume that the former holds. From \cref{PropertyComplex-prop-reducedspacenormalizationchar} in \nameref{PropertyComplex-chap-propcomplex}, we conclude that $Y_1'=\bar{X}$, which is a contradiction.
\end{proof}


\begin{corollary}
    Let $X$ be a connected complex analytic space. Then $X$ is path-connected.
\end{corollary}
\begin{proof}
    We may assume that $X$ is reduced.

    If $X$ is irreducible, after passing to the normalization, we may assume that $X$ is normal. Then clearly $X^{\reg}$ is connected. So it suffices to apply \cref{PropertyComplex-prop-pathtoXreg} in \nameref{PropertyComplex-chap-propcomplex}.

    In general, take $x\in X$ and let $X'$ be the set of all points of $X$ that can be joined to $x$ by a path. Then from the previous case, $X'$ is the union of certain irreducible componenets of $X$. So is the complement $X\setminus X'$. As $X$ is connected, we find that $X=X'$.
\end{proof}


\begin{corollary}\label{cor-irrimplyequid}
    Let $X$ be an irreducible complex analytic space. Then there is $n\in \mathbb{N}$ such that $X$ is equidimensional of dimension $n$.
\end{corollary}
\begin{proof}
    We may assume that $X$ is reduced. By \cref{thm-finitemapdim}, we can even assume that $X$ is normal. Then $X$ is connected. In particular, $X^{\reg}$ is connected by \cref{cor-complthininconnectedconn2}. But $X^{\reg}$ is then equidimensional of some dimension $n\in \mathbb{N}$. If $\dim_x X\neq n$ for some $x\in X^{\Sing}$, by \cref{PropertyComplex-thm-equidimlocusopen} in \nameref{PropertyComplex-chap-propcomplex}, $\dim_y X=\dim_x X$ whenever $y$ is close to $x$. This is a contradiction.
\end{proof}



\begin{corollary}\label{cor-finitesurjbranchedcov2}
    Let $f:X\rightarrow Y$ be a finite surjective morphism between irreducible reduced complex analytic spaces. Then $f$ is a branched covering.
\end{corollary}
\begin{proof}
    By \cref{cor-liftmorphismtonormalization}, we have an obvious commutative diagram:
    \[
        \begin{tikzcd}
            \bar{X} \arrow[d] \arrow[r, "\bar{f}"] & \bar{Y} \arrow[d] \\
            X \arrow[r, "f"]                       & Y                
        \end{tikzcd}.  
    \]
    If suffices to show that $\bar{f}$ is a branched covering, so we may assume that $X$ and $Y$ are normal.

    By \cref{prop-finitemorphismopen} and \cref{cor-irrimplyequid}, $f$ is open. So it suffices to apply \cref{thm-finiteopensurjbranchedcov}.
\end{proof}

\begin{corollary}\label{cor-branchedcovcondition}
    Let $f:X\rightarrow Y$ be a finite surjective morphism between reduced complex analytic spaces. Then the following are equivalent:
    \begin{enumerate}
        \item $f$ is a branched covering;
        \item The image of each irreducible component of $X$ has an interior point;
        \item The image of each irreducible component of $X$ is an irreducible component of $Y$.
    \end{enumerate}
\end{corollary}
\begin{proof}
    (1) $\implies$ (2): Let $T\subseteq Y$ be a critical locus of $f$. Then $f^{-1}(T)$ is thin in $X$. Each irreducible component $X'$ of $X$ meets $X\setminus f^{-1}(T)$. It follows that $f(X'\setminus f^{-1(T)})$ is non-empty and open in $Y$.

    (2) $\implies$ (3): Let $X'$ be an irreducible component of $X$. Then $f(X)$ is an analytic set in $Y$. It is clearly irreducible. So $f(X)$ is contained in an irreducible component $Y'$ of $Y$. But as $f(X')$ has an interior point, we find that $f(X')=Y'$ by \cref{cor-normirrdimpointequal}.

    (3) $\implies$ (1): The assertion is local, we may assume that the number of irreducible components of $X$ is finite. Let $X_1,\ldots,X_s$ be the irreducible components of $X$.
    For each $i=1,\ldots,s$, the induced map $X_i\rightarrow \pi(X_i)$ is finite and hence a branched covering by \cref{cor-finitesurjbranchedcov2}. It is enough to vefity that $\pi^{-1}(\pi(X_i\cap X_j))$ is thin in $X$ for $i,j=1,\ldots,s$ and $i\neq j$. If this fials, this set contains an interior point in $X_k$ for some $k\in \{1,\ldots,s\}$. But then 
    \[
        X_k\subseteq \pi^{-1}(\pi(X_i\cap X_j)).  
    \]
    It follows that 
    \[
        \pi(X_i\cap X_j)\supseteq \pi(X_k).  
    \]
    This is impossible as $X_i\cap X_j\cap X_k$ is thin in $X_k$.
\end{proof}



\begin{definition}
    Let $b\in \mathbb{Z}_{>0}$, $f:X\rightarrow Y$ be a $b$-sheeted branched covering with $Y$ being a normal complex analytic space. Take a critical locus $T\subseteq Y$ of $f$ containing $Y^{\Sing}$. 
    
    Consider $g\in \mathcal{O}_X(X)$. We define the \emph{characteristic polynomial} $\chi_g\in \mathcal{O}_Y(Y)[w]$ of $g$ (with respect to $f$) as follows: When $Y$ is connected, by \cref{cor-complthininconnectedconn2}, $Y^{\reg}$ is a connected complex manifold. We define $\chi_g\in \mathcal{O}_Y(Y^{\reg})[w]$ as in \cref{def-charpolmanifold}. We then extend $\chi_g$ to $\mathcal{O}_Y(Y^{\reg})[w]$ using \cref{cor-Riemannextnormal}. It is a monic polynomial of degree $b$. When $Y$ is not connected, we just glue the characteristic polynomials defined using each connected components. Then we find a monic polynomial $\chi_g\in \mathcal{O}_Y(Y)[w]$ of degree $b$.
\end{definition}


\begin{proposition}\label{prop-charpolygen}
    Let $b\in \mathbb{Z}_{>0}$, $f:X\rightarrow Y$ be a $b$-sheeted branched covering with $Y$ being a normal complex analytic space. Let $g\in \mathcal{O}_X(X)$. Let $\chi_g\in \mathcal{O}_Y(Y)[w]$ be the characteristic polynomial of $g$. Then $\chi_g(g)=0$.
\end{proposition}
\begin{proof}
    This follows immediately from \cref{prop-charpoly}.
\end{proof}

We give an alternative characterization of $\overline{\mathcal{O}}_X$.
\begin{proposition}
    Let $X$ be a reduced complex analytic space. Then for any open set $U\subseteq X$, 
    \[
        \overline{\mathcal{O}}_X(U)\cn \left\{f:U\rightarrow \mathbb{C}: f\text{ is weakly holomorphic} \right\}.      
    \]
\end{proposition}

\begin{proof}
    We temporarily denote the sheaf stated in theproposition by $\mathcal{O}'$. From the uniqueness in \cref{prop-normalizationcas}, it suffices to show that $\mathcal{O}'_{x}$ is isomorphic to $\overline{\mathcal{O}_{X,x}}$ as $\mathcal{O}_{X,x}$-algebras for any $x\in X$.

    We first observe that $\overline{\mathcal{O}}_X$ is a subsheaf of  $\mathcal{O}'$. Let $U\subseteq X$ be an open subset and $f\in \overline{\mathcal{O}}_X(U)$.  We need to show that $f$ is locally bounded around $y\in U\cap X^{\Sing}$. 
    Take an integral equation
    \[
        f_y^n+a_{1,y}f_y^{n-1}+\cdots+a_{n,y}=0  
    \]
    with $a_{1,y},\ldots,a_{n,y}\in \mathcal{O}_{X,x}$.
    Take an open neighbourhood $V$ of $y$ in $U$ such that $a_{1,y},\ldots,a_{n,y}$ lift to $a_1,\ldots,a_n\in \mathcal{O}_X(V)$ and
    \[
        (f|_V)^n +a_1f|_V^{n-1}+\cdots+ a_n=0. 
    \] 
    Then for any $z\in V\setminus X^{\Sing}$,
    \[
        |f(z)|\leq \max\{1,|a_1(z)|+\ldots+|a_n(z)|\}.  
    \]
    So $f\in \mathcal{O}'$. 
    
    Conversely, let $U\subseteq X$ be an open subset and $f\in \mathcal{O}'(U)$. By \cref{PropertyComplex-prop-reducedspacenormalizationchar} in \nameref{PropertyComplex-chap-propcomplex}, $p_*\mathcal{O}_{\overline{X}}=\mathcal{O}_X$, where $p:\overline{X}\rightarrow X$ is the normalization morphism. It follows from \cref{PropertyComplex-prop-reducedspacenormalizationchar} in \nameref{PropertyComplex-chap-propcomplex} and \cref{cor-Riemannextgeneral} that $f$ can be uniquely extended to $g\in \mathcal{O}_{\overline{X}}(p^{-1}U)=\mathcal{O}_X(U)$.
\end{proof}


\begin{proposition}[Rado, Cartan]\label{prop-Rado}
    Let $X$ be a normal complex analytic space and $f:X\rightarrow \mathbb{C}$ be a continuous map. Let $Z=f^{-1}(0)$. Assume that there is $g\in \mathcal{O}_X(X\setminus Z)$ such that $[g]=f|_{X\setminus Z}$, then $f=[g]$. 
\end{proposition}
This result is proved in \cite{Car52}.
\begin{proof}
    By \cref{cor-Riemannextnormal}, we may assume that $X$ is a complex manifold.
    The problem is local on $X$, we may assume that $X$ is the unit polydisk in $\mathbb{C}^n$ for some $n\in \mathbb{N}$. By Hartogs theorem, we may assume that $n=1$.

    It remains to show that a continuous function $f:\{z\in \mathbb{C}:|z|<1\}$ which  is holomorphic outside $Z:=\{f=0\}$ is holomorphic. This result is well-known.
 \end{proof}


 \section{Flat morphisms}
 The notion of flat morphisms is defined for all ringed spaces. See \cite[\href{https://stacks.math.columbia.edu/tag/02N2}{Tag 02N2}]{stacks-project}. We will make use of these notions directly.

 \begin{proposition}\label{prop-flatnesschar}
    Let $f:X\rightarrow Y$ be a morphism of complex analytic spaces and $x\in X$. Write $y=f(x)$. Let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module. Then the folloiwng are equivalent:
    \begin{enumerate}
        \item $\mathcal{F}$ is $f$-flat at $x$;
        \item $\mathcal{F}_x$ is a flat $\mathcal{O}_{Y,y}$-module;
        \item For all $n\in \mathbb{N}$, 
            \[
                \hat{\mathcal{F}}_x\otimes_{\hat{\mathcal{O}}_{Y,y}}\hat{\mathcal{O}}_{Y,y}/\hat{\mathfrak{m}}_y^{n+1}  
            \]
            is a flat $\hat{\mathcal{O}}_{Y,y}/\mathfrak{m}_y^{n+1}$-module;
        \item We have
            \[
                \Tor_1^{\mathcal{O}_{Y,y}}(\mathbb{C},\mathcal{F}_x)=0.
            \]
    \end{enumerate}
 \end{proposition}
 \begin{proof}
(1) $\Leftrightarrow$ (2): This is the definition of flatness.

(2) $\Leftrightarrow$ (3): This follows from \cite[\href{https://stacks.math.columbia.edu/tag/0523}{Tag 0523}]{stacks-project}.

(2) $\Leftrightarrow$ (4): This follows from \cite[\href{https://stacks.math.columbia.edu/tag/00MK}{Tag 00MK}]{stacks-project}.
 \end{proof}


\begin{proposition}
    Let $f:X\rightarrow Y$ be a morphism of complex analytic spaces and $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module. Let $g:Y'\rightarrow Y$ be a morphism of complex analytic spaces and consider the following Cartesian diagram:
    \[
        \begin{tikzcd}
            X' \arrow[r,"g'"] \arrow[d, "f'"] \arrow[rd, "\square", phantom] & X \arrow[d, "f"] \\
            Y' \arrow[r,"g"]                                                & Y               
        \end{tikzcd}.  
    \]
    Consider a point $x'\in X'$ defined by $x\in X$ and $y'\in Y'$ with common image $y\in Y$. 
    \begin{enumerate}
        \item If $\mathcal{F}$ is $f$-flat at $x$, then $g'^{*}\mathcal{F}$ is $f'$-flat at $x'$.
        \item If $g'^*\mathcal{F}$ is $f'$-flat at $x'$ and $\hat{\mathcal{O}}_{Y,y}\rightarrow \hat{\mathcal{O}}_{Y',y'}$ is injective, then $\mathcal{F}$ is $f$-flat at $x$.
    \end{enumerate}
\end{proposition}
\begin{proof}
    (1) Recall that
    \[
        \hat{\mathcal{O}}_{X',x'}\cn   \hat{\mathcal{O}}_{X,x}\hat{\otimes}_{\hat{\mathcal{O}}_{Y,y}}\hat{\mathcal{O}}_{Y',y'}.
    \]
    Let $n\in \mathbb{N}$, we then find
    \[
        \hat{\mathcal{O}}_{X',x'}/\hat{\mathfrak{m}}_{y'}^{n+1}\hat{\mathcal{O}}_{X',x'}\cn   \hat{\mathcal{O}}_{X,x}\hat{\otimes}_{\hat{\mathcal{O}}_{Y,y}}\left(\hat{\mathcal{O}}_{Y',y'}/\hat{\mathfrak{m}}_{y'}^{n+1}\right)\cn  \hat{\mathcal{O}}_{X,x}\otimes_{\hat{\mathcal{O}}_{Y,y}}\left(\hat{\mathcal{O}}_{Y',y'}/\hat{\mathfrak{m}}_{y'}^{n+1}\right).
    \]
    By \cref{prop-flatnesschar}, $\hat{\mathcal{F}}_x\otimes_{\hat{\mathcal{O}}_{Y,y}}\hat{\mathcal{O}}_{Y,y}/\hat{\mathfrak{m}}_y^{n+1}$ is a flat $\mathcal{O}_{Y',y'}$-module for each $n\in \mathbb{N}$. By \cref{prop-flatnesschar} again, $\mathcal{F}$ is $f'$-flat at $x'$.

    (2) For each $n\in \mathbb{N}$, let $I_n$ be the inverse image of $\hat{\mathfrak{m}}_{y'}^{n+1}$ with respect to $\hat{\mathcal{O}}_{Y,y}\rightarrow \hat{\mathcal{O}}_{Y',y'}$. As the latter map is assumed to be injective, by Krull's intersection theorem, we find that
    \[
        \bigcap_{n\in \mathbb{N}}I_n=0.  
    \]
    It follows that the $I_n$'s form a basis at $0$ in $\hat{\mathcal{O}}_{Y,y}$. By \cref{prop-flatnesschar}, we are reduced to show that $\hat{\mathcal{F}}_x/I_n\hat{\mathcal{F}}_x$ is flat over $\hat{\mathcal{O}}_{Y,y}/I_n$. But by \cref{prop-flatnesschar} again, we know that its base change along $\hat{\mathcal{O}}_{Y,y}/\hat{\mathcal{O}}_{Y',y'}/\hat{\mathfrak{m}}_{y'}^{n+1}$. So we are reduced to the well-known algebraic case.
\end{proof}



\printbibliography
\end{document}











\iffalse

\begin{proposition}\label{prop-projlemma}
    Let $n\in \mathbb{N}$ and $D$ be an open neighbourhood of $0$ in $\mathbb{C}^n$. 
    Let $X$ be a closed subspace of $D$ which intersections $\{(0,\ldots,0)\}\times \mathbb{C}$ at and only at $0$. Then there is a connected open product neighbourhood $B\times W\subseteq \mathbb{C}^{n-1}\times \mathbb{C}$ of $0$ in $D$ such that 
    \begin{enumerate}
        \item the projection $B\times W\rightarrow B$ induces a finite morphism $h:X'\rightarrow B$ with $X'=X\cap (B\times W)$;
        \item for any coherent sheaf $\mathcal{M}$ of $\mathcal{O}_{X'}$-modules, $h_*\mathcal{M}$ is coherent.
    \end{enumerate}
\end{proposition}
\begin{proof}
    We will denote the coordinates on $\mathbb{C}^{n-1}\times \mathbb{C}$ as $(z,w)$.

    Let $\mathcal{I}$ be the ideal of $X$ in $D$. By our assumption, we can choose $f_0\in \mathcal{I}_0$ such that $\deg_w f_0<\infty$ and $f_0(0)=0$. By \cref{Local-thm-Weierstrassprep} in \nameref{Local-chap-local}, we can find a Weierstrass polynomial $\omega_0=w^b+a_1w^{b-1}+\cdots+a_b\in \mathbb{C}\{ z_1,\ldots,z_{n-1} \}[w]$ such that $f_0=e\omega_0$ for some unit $e$ in $\mathbb{C}\{ z_1,\ldots,z_{n} \}$. We choose a product neighbourhood $B\times W\subseteq \mathbb{C}^{n-1}\times \mathbb{C}$ of $0$ in $D$ such that $\omega_0$ can be represented by $\omega\in \mathcal{O}_{\mathbb{C}^{n-1}}(B)[w]$ with $\omega|_{B\times W}\in \mathcal{I}(B\times W)$. Let $\pi:A\rightarrow B$ be the Weierstrass map defined by $\omega$. Then $\pi$ is finite by \cref{thm-Weiemapfiniteandopen}. 
    Up to shrinking $B$ and $W$, we may assume that $A\cap (B\times W)\rightarrow B$ is finite as well. Set $X':=X\cap (B\times W)$. The restriction $h:X'\rightarrow B$ of $\pi$ is then finite. This proves (1).

    Let $\mathcal{I}'$ be the zero-extension of $\mathcal{I}$ to $A$. Then $\mathcal{I}'$ is coherent. It suffices to show that $\pi_*\mathcal{I}'$ is coherent. Let $y\in B$ be a point and $x_1,\ldots,x_n$ be the distinct points in $\pi^{-1}(y)$.  FOr each $j=1,\ldots,n$, we can find an open neighbourhood $U_j$ of $x_j$ in $A$, pairwise disjoint and an exact sequence 
    \[
        \mathcal{O}_{U_j}^{p_j}\rightarrow \mathcal{O}_{U_j}^{q_j}\rightarrow \mathcal{I}'|_{U_j}\rightarrow 0
    \]
    for some $p_j,q_j\in \mathbb{Z}_{>0}$.  We may assume that $p_1=\cdots=p_n$ and $q_1=\cdots=q_n$. We denote the common values by $p$ and $q$. Then $U=U_1\cup\cdots\cup U_n$ is a neighbourhood of $\pi^{-1}(y)$, and we have an exact sequence 
    \[
        \mathcal{O}_{U}^{p}\rightarrow \mathcal{O}_{U}^{q}\rightarrow \mathcal{I}'|_{U}\rightarrow 0.
    \]
    By \cref{Topology-lma-opennhfiberclosedmap} in \nameref{Topology-chap-topology}, we may assume that $U=\pi^{-1}(V)$ for some open neighbourhood $V$ of $y$ in $B$. The induced map $\pi':U\rightarrow V$ is finite and by \cref{Topology-cor-pushforwardsheaffinite} in \nameref{Topology-chap-topology}, we have an exact sequence
    \[
        \pi'_*\mathcal{O}_{U}^{p}\rightarrow \pi'_*\mathcal{O}_{U}^{q}\rightarrow \pi'_*\left(\mathcal{I}'|_{U}\right)=(\pi_*\mathcal{I}')|_V\rightarrow 0.
    \]
    By \cref{thm-Okacoh} and \cref{thm-Weierstrassiso}, the first two terms are both coherent, hence so is $(\pi_*\mathcal{I}')|_V$.
\end{proof}

\begin{corollary}\label{cor-projlemma}
    Let $n,k\in \mathbb{N}$ and $D$ be an open neighbourhood of $0$ in $\mathbb{C}^n$. 
    Let $X$ be a closed subspace of $D$ which intersections $\{(0,\ldots,0)\}\times \mathbb{C}^k$ at and only at $0$. Then there is a connected open product neighbourhood $B\times W\subseteq \mathbb{C}^{n-k}\times \mathbb{C}^k$ of $0$ in $D$ such that 
    \begin{enumerate}
        \item the projection $B\times W\rightarrow B$ induces a finite morphism $h:X'\rightarrow B$ with $X'=X\cap (B\times W)$;
        \item for any coherent sheaf $\mathcal{M}$ of $\mathcal{O}_{X'}$-modules, $h_*\mathcal{M}$ is coherent.
    \end{enumerate}
\end{corollary}
\begin{proof}
    This follows from a repeted application of \cref{prop-projlemma}.
\end{proof}

\begin{proposition}\label{prop-quasifinitefinite}
    Let $f:X\rightarrow Y$ be a morphism of complex analytic spaces. Assume that $f$ is quasi-finite at $x\in X$. Then there is an open neighbourhood $U$ of $x$ in $X$ and an open neighbourhood of $f(x)$ in $Y$ with $f(U)\subseteq V$ such that 
    \begin{enumerate}
        \item the induced map $f':U\rightarrow V$ is finite;
        \item for any coherent sheaf $\mathcal{F}$ of $\mathcal{O}_U$-modules, $f'_*\mathcal{F}$ is coherent. 
    \end{enumerate}
\end{proposition}
\begin{proof}
    The assertion is local on both $X$ and $Y$. So we may assume that $U$ and $V$ are complex model spaces in domains $W\subseteq \mathbb{C}^k$ and $B\subseteq \mathbb{C}^d$ respectively with $x=0$ and $y=0$. Moreover, we may assume that $\{x\}=f'^{-1}(y)$. We have the following commutative diagram:
    \[
        \begin{tikzcd}
            &                                & U\times V \arrow[dd] \arrow[r, hook] & W\times B \arrow[dd] \\
U \arrow[r] \arrow[rrd,"f'"] & \Gamma_f \arrow[rd] \arrow[ru] &                                      &                      \\
            &                                & V \arrow[r, hook]                    & B                   
\end{tikzcd},
    \]
    where $\Gamma_{f'}$ denotes the graph of $f':U\rightarrow V$. As $\{x\}=f'^{-1}(y)$, we have $\mathbb{C}^k\times\{0\}$ intersects $\Gamma_f$ only at the origin. By \cref{cor-projlemma}, up to shrinking $W$ and $B$, we may guarantee that the projection $W\times B\rightarrow B$ induces a finite morphism $\Gamma_f\rightarrow B$ and the pushforward under this map preserves coherence. Observe that $U\rightarrow \Gamma_f$ is a biholomorphism, we conclude that $f'$ is finite. This proves (1). Moroever, observe that the zero-extension of $f'_*\mathcal{I}$ is the successive pushforward of $\mathcal{I}$ along $U\rightarrow U_f$ and then along $U_f\rightarrow B$. It follows that  $f'_*\mathcal{I}$ is coherent.
\end{proof}


\begin{theorem}\label{thm-finitepushcoherent}
    Let $f:X\rightarrow Y$ be a finite morphism of complex analytic spaces, then for any coherent sheaf $\mathcal{M}$ of $\mathcal{O}_X$-modules, $f_*\mathcal{M}$ is also coherent.
\end{theorem}
\begin{proof}
    Let $y\in Y$ and $x_1,\ldots,x_n$ be the distinct points in $f^{-1}(y)$. By \cref{prop-quasifinitefinite}, we can find an open neighbourhood $W_j$ of $x_j$ in $X$ and open neighbourhoods $V_j$ of $y$ in $Y$ with $f(W_j)\subseteq V_j$ for $j=1,\ldots,n$ such that the induced maps $W_j\rightarrow V_j$ are all finite and pushforwards along these maps preserve coherence. We may assume that $W_1,\ldots,W_n$ are pairwise disjoint.
    Let $V=V_1\cap \cdots\cap V_n$. For each $j=1,\ldots,n$, define $U_j:=f^{-1}(V)\cap W_j$. By \cref{Topology-thm-localstructuretopfinitemap} in \nameref{Topology-chap-topology}, up to shrinking $V$ and $W$, we may guarantee that
    \[
        (f_*\mathcal{I})|_V\cong \prod_{j=1}^n f_{j*}(\mathcal{I}|_{U_j}),
    \]
    where $f_j:U_j\rightarrow V$ is the morphism induced by $f$. Now it is clear that $(f_*\mathcal{I})|_V$ is coherent.
\end{proof}

\fi