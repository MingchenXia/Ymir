\input{preamble}
\title{Affinoid algebras}
\begin{document}
\maketitle
\tableofcontents




\section{Introduction}\label{sec-introduction}
Our references  for this chapter include \cite{BGR}, \cite{Berk12}.
\section{Tate algebras}
Let $(k,|\bullet|)$ be a complete non-Archimedean valued-field. 

\begin{definition}
    Let $n\in \mathbb{N}$ and $r=(r_1,\ldots,r_n)\in \mathbb{R}^n_{>0}$. We set 
    \[
        \begin{split}
        k\{r^{-1}T\}=& k\{r_1^{-1}T_1,\ldots,r_n T_n^{-1}\} \\
        :=&\left\{f=\sum_{\alpha\in \mathbb{N}^n} a_{\alpha}T^{\alpha}\in k[[T_1,\ldots,T_n]]:a_{\alpha}\in k, |a_{\alpha}|r^{\alpha}\to 0\text{ as }|\alpha|\to\infty \right\}.
        \end{split}
    \]
    For any $f=\sum_{\alpha\in \mathbb{N}^n} a_{\alpha}T^{\alpha}\in k\{r^{-1}T\}$, we set
    \[
        \|f\|_r=\max_{\alpha}|a_{\alpha}|r^{\alpha}.  
    \]
    We call $(k\{r^{-1}T\},\|\bullet\|_r)$ the \emph{Tate algebra} in $n$-variables with radii $r$. The norm $\|\bullet\|_r$ is called the \emph{Gauss norm}.

    We omit $r$ from the notation if $r=(1,\ldots,1)$.
\end{definition}
This is a special case of \cref{Banach-ex-strictconvseriesradius}  in the chapter Banach Rings.
\begin{proposition}\label{prop-TateGaussvaluation}
    Let $n\in \mathbb{N}$ and $r=(r_1,\ldots,r_n)\in \mathbb{R}^n_{>0}$.  Then the Tate algebra $(k\{r^{-1}T\},\|\bullet\|_r)$ is a Banach $k$-algebra and $\|\bullet\|_r$ is a valuation.
\end{proposition}

\begin{proof}
    This is a special case of \cref{Banach-prop-strictconvseriesradiusBanach} in the chapter Banach Rings.
\end{proof}

\begin{remark}
One should think of $k\{r^{-1}T\}$ as analogues of $\mathbb{C}\langle r^{-1}T\rangle$ in the theory of complex analytic spaces.  We could have studied complex analytic spaces directly from the Banach rings $\mathbb{C}\langle r^{-1}T\rangle$, as we will do in the rigid world. But in the complex world, the miracle is that we have \emph{a priori} a good theory of functions on all open subsets of the unit polydisk, so things are greatly simplified. The unit polydisk is a ringed space for free.

As we will see, constructing a good function theory, or more precisely, enhancing the unit disk to a ringed site is the main difficulty in the theory of rigid spaces. And Tate's innovation comes in at this point.
\end{remark}

\begin{example}\label{ex-trivvaluedaff}
    Assume that the valuation on $k$ is trivial. 

    Let $n\in \mathbb{N}$ and $r\in \mathbb{R}^n_{>0}$. 
    Then $k\{r^{-1}T\}\cong k[T_1,\ldots,T_n]$ if $r_i\geq 1$ for all $i$ and $k\{r^{-1}T\}\cong k[[T_1,\ldots,T_n]]$ otherwise.
\end{example}

\begin{lemma}\label{lma-Tatestrictuniv}
    Let $A$ be a Banach $k$-algebra. For each $n\in \mathbb{N}$ and $a_1,\ldots,a_n\in \mathring{A}$, there is a unique continuous homomorphism $k\{T_1,\ldots,T_n\}\rightarrow A$ sending $T_i$ to $a_i$.
\end{lemma}
\begin{proof}
    This is a special case of \cref{Banach-prop-Tateunivprop} in the chapter Banach Rings.
\end{proof}





\section{Affinoid algebras}
Let $(k,|\bullet|)$ be a complete non-Archimedean valued field and $H$ be a subgroup of $\mathbb{R}_{>0}$ such that $|k^{\times}|\cdot H\neq \{1\}$.
 
\begin{definition}
    A Banach $k$-algebra $A$ is \emph{$k$-affinoid} (resp. \emph{strictly $k$-affinoid}) if there are $n\in \mathbb{N}$, $r\in \mathbb{R}^n_{>0}$ and an admissible epimorphism $k\{r^{-1}T\}\rightarrow A$ (resp. an admissible epimorphism $k\{T\}\rightarrow A$).


    More generally, a Banach $k$-algebra $A$ is \emph{$k_H$-affinoid} if there are $n\in \mathbb{N}$, $r\in H^n$  and an admissible epimorphism $k\{r^{-1}T\}\rightarrow A$.

    A morphism between $k$-affinoid (resp. strictly $k$-affinoid, resp. $k_H$-affinoid) algebras is a bounded $k$-algebra homomorphism.

    The category of $k$-affinoid (resp. strictly $k$-affinoid, resp. $k_H$-affinoid) algebras is denoted by $k\text{-}\AffAlgCat$ (resp. $\text{st-}k\text{-}\AffAlgCat$, resp. $k_H\text{-}\AffAlgCat$). 
    
    
    %The opposite categories of these categories are denoted by $k\text{-}\AffCat$, $\text{st-}k\text{-}\AffCat$ and $k_H\text{-}\AffCat$. For any $A$ in $k\text{-}\AffAlgCat$ (resp. $\text{st-}k\text{-}\AffAlgCat$, resp. $k_H\text{-}\AffAlgCat$), the corresponding image in the opposite category is denoted by $\Sp A$. We can also identify $\Sp A$ with the topological space defined in \cref{Banach-def-Berkspectrum} in the chapter Banach Rings.

    %An affinoid $k$-algebra is a $K$-affinoid algebra for some complete non-Archimedean field extension $K/k$.
\end{definition}
For the notion of admissible morphisms, we refer to \cref{Banach-def-admissiblemorphism} in the chapter Banach rings.

Although we have defined strictly $k$-affinoid algebra when $k$ is trivially valued, we will deliberately avoid talking about it in order to avoid pathologies.
\begin{remark}
    Berkovich also introduced the notion of \emph{affinoid $k$-algebras}: it is a $K$-affinoid algebra for some complete non-Archimedean field extension $K/k$. We will not use this notion.
\end{remark}


\begin{definition}
    The category of \emph{$k$-affinoid spectra} $k\text{-}\AffCat$ (resp. \emph{strictly $k$-affinoid spectra} $\text{st-}k\text{-}\AffCat$, resp. \emph{$k_H$-affinoid spectra} $k_H\text{-}\AffCat$) is the opposite category of $k\text{-}\AffAlgCat$ (resp. $\text{st-}k\text{-}\AffAlgCat$, resp. $k_H\text{-}\AffAlgCat$). An object in these categories are called a \emph{$k$-affinoid spectrum}, \emph{strictly $k$-affinoid spectrum} and \emph{$k_H$-affinoid spectrum} respectively.

    Given an object $A$ of $k\text{-}\AffAlgCat$ (resp. $\text{st-}k\text{-}\AffAlgCat$, resp. $k_H\text{-}\AffAlgCat$), we denote the corresponding object in $k\text{-}\AffCat$ (resp. $\text{st-}k\text{-}\AffCat$, resp. $k_H\text{-}\AffCat$) by $\Sp A$. We call $\Sp A$ the \emph{affinoid spectrum} of $A$.
\end{definition}
In \cref{Banach-def-Berkspectrum} in the chapter Banach Rings, we defined functors $\Sp:k\text{-}\AffCat\rightarrow \TopCat$, $\Sp:\text{st-}k\text{-}\AffCat\rightarrow \TopCat$ and $\Sp:k_H\text{-}\AffCat\rightarrow \TopCat$. This motivates our notation. We will freely view $\Sp A$ as an object in these categories or as a topological space.

\begin{proposition}\label{prop-existfiberprod}
    Finite limits exist in $k_H\text{-}\AffCat$. Moreover, fiber products in $k_H\text{-}\AffCat$ corresponds to completed tensor product in $k_H\text{-}\AffAlgCat$.
\end{proposition}
\begin{proof}
    It suffices to prove that finite fibered products exsit.

    We prove the equivalent statement, finite fibered coproducts exist in $k_H\text{-}\AffAlgCat$. Given $k_H$-affinoid algebras $A,B,C$ and morphisms $A\rightarrow B$, $A\rightarrow C$, we claim that $B\hat{\otimes}_A C$ represents the fibered coproduct of $B$ and $C$ over $A$. 
    By general abstract nonsense, we are reduced to handle the following cases: $A=k$ and $A\rightarrow C$ is the codiagonal $C\hat{\otimes}_k C\rightarrow C$. In both cases, the proposition is clear.


\end{proof}




\begin{example}\label{ex-Kraffinoid}
    Let $r\in \mathbb{R}_{>0}$. We let $k_r$ denote the subring of $k[[T]]$ consisting of $f=\sum_{i=-\infty}^{\infty} a_i T^i$ satisfying $|a_i| r^i\to 0$ for $i\to \infty$ and $i\to -\infty$. We define a norm $\|\bullet\|_r$ on $k_r$ as follows:
    \[
          \|f\|_{r}:=\max_{i\in \mathbb{Z}}|a_i| r^i.
    \]
    We will show in \cref{prop-Krisaffinoid} that $k_r$ is $k$-affinoid.
\end{example}
\begin{proposition}\label{prop-Krisaffinoid}
    Let $r\in \mathbb{R}_{>0}$, then $(k_r,\|\bullet\|_r)$ defined in \cref{ex-Kraffinoid} is a $k$-affinoid algebra. Moreover, $\|\bullet\|_r$ is a valuation.
\end{proposition}
\begin{proof}
    Observe that we have an admissible epimorphism
    \[
        \iota:k\{r^{-1}T_1,rT_2\}\rightarrow k_r,\quad T_1\mapsto T, T_2\mapsto T^{-1}.  
    \]
    As we do not have the universal property at our disposal yet, let us verify by hand that this defines a ring homomorphism: consider a series
    \[
        f=\sum_{(i,j)\in \mathbb{N}^2} a_{i,j}T_1^i T_2^j\in  k\{r^{-1}T_1,rT_2\}, 
    \]
    namely, 
    \begin{equation}\label{eq-aijrijto0}
        |a_{i,j}|r^{i-j}\to 0  
    \end{equation}
    as $i+j\to \infty$. Observe that for each $k\in \mathbb{Z}$, the series 
    \[
        c_k:=  \sum_{i-j=k,i,j\in \mathbb{N}} a_{i,j}
    \]
    is convergent.

    Then by definition, the image $\iota(f)$ is given by
    \[
        \sum_{k=-\infty}^{\infty} c_k T^{k}.
    \]
    We need to verify that $\iota(f)\in k_r$. That is 
    \[
        |c_k|r^k\to 0  
    \]
    as $k\to \pm\infty$. When $k\geq 0$, we have $|c_k|\leq |a_{k0}|$ by definition of $c_k$. So $|c_k|r^k\to 0$ as $k\to\infty$ by \eqref{eq-aijrijto0}. The case $k\to -\infty$ is similar.

    We conclude that we have a well-defined map of sets $\iota$. It is straightforward to verify that $\iota$ is a ring homomorphism. Next we show that $\iota$ is surjective. Take $g=\sum_{i=-\infty}^{\infty} c_i T^i\in k_r$. We want to show that $g$ lies in the image of $\iota$. As $\iota$ is a ring homomorphism, it suffices to treat two cases separately: $g=\sum_{i=0}^{\infty} c_i T^i$ and $g=\sum_{i=-\infty}^0 c_iT^i$. We handle the first case only, as the second case is similar. In this case, it suffices to consider $f=\sum_{i=0}^{\infty} c_i T_1^i\in k\{r^{-1}T_1,rT_2\}$. It is immediate that $\iota(f)=g$.


    Next we show that $\iota$ is admissible. We first identify the kernel of $\iota$. We claim that the kenrel is the ideal $I$ generated by $T_1T_2-1$. It is obvious that $I\subseteq \ker \iota$. Conversely, consider an element
    \[
        f=\sum_{(i,j)\in \mathbb{N}^2} a_{i,j}T_1^i T_2^j\in  k\{r^{-1}T_1,rT_2\}  
    \]
    lying in the kenrel of $\iota$. Observe that 
    \[
        f=\sum_{k=-\infty}^{\infty}f_k, \quad f_k=\sum_{(i,j)\in \mathbb{N}^2, i-j=k} a_{i,j}T_1^i T_2^j.
    \]
    If $f\in \ker\iota$, then so is each $f_k$ by our construction. 
    
    We first show that each $f_k$ lies in the ideal generated by $T_1T_2-1$. The condition that $f_k\in \ker\iota$ means
    \[
        \sum_{(i,j)\in \mathbb{N}^2, i-j=k} a_{i,j}=0.  
    \]
    It is elementary to find $b_{i,j}\in k$ for $i,j\in \mathbb{N}$, $i-j=k$ such that
    \[
        a_{i,j}=b_{i-1,j-1} -b_{i,j}.
    \]
    Then 
    \[
      f_k=(T_1T_2-1)\sum_{i,j\in \mathbb{N},i-j=k}b_{i,j}T_1^i T_2^j.
    \]
    Observe that we can make sure that $|b_{i,j}|\leq \max\{|a_{i',j'}|:i-j=i'-j'\}$. In particular, the sum of $\sum_{i,j\in \mathbb{N},i-j=k}b_{i,j}T_1^i T_2^j$ for various $k$ converges to some $g\in k\{r^{-1}T_1,rT_2\}$ and hence $f_k=(T_1T_2-1)g$.
    Therefore, we have proved that $\ker \iota$ is generated by $T_1T_2-1$.

    It remains to show that $\iota$ is admissible. In fact, we will prove a stronger result: $\iota$ induces an isometric isomorphism
    \[
        k\{r^{-1}T_1,rT_2\}/I\rightarrow k_r. 
    \]
    To see this, take $f=\sum_{k=-\infty}^{\infty}c_k T^k\in k_r$ and we need to show that 
    \[
        \|f\|_r=\inf\{\|g\|_{(r,r^{-1})}:\iota(g)=f\}.
    \]
    Observe that if we set $g=\sum_{k=0}^{\infty} c_k T_1^k+\sum_{k=1}^{\infty}c_{-k}T_2^k$, then $\iota(g)=f$ and $\|g\|_{(r,r^{-1})}=\|f\|$. So it suffices to show that for any $h=\sum_{(i,j)\in \mathbb{N}^2} d_{i,j}T_1^iT_2^j\in k\{r^{-1}T_1,rT_2\}$, we have
    \begin{equation}\label{eq-fnormequalquotientnorm}
        \|f\|_r\leq \|g+h(T_1T_2-1)\|_{r,r^{-1}}.  
    \end{equation}
    We compute
    \[
        g+h(T_1T_2-1)=\sum_{k=1}^{\infty}(c_k-d_{k,0})T_1^k+\sum_{k=1}^{\infty}(c_{-k}-d_{0,k})T_2^k+(c_0-d_0)+\sum_{i,j\geq 1} (d_{i-1,j-1}-d_{i,j})T_1^iT_2^j.
    \]
    So 
    \[
        \|g+h(T_1T_2-1)\|_{r,r^{-1}}=\max\left\{\max_{k\geq 0} C_{1,k},\max_{k\geq 1} C_{2,k} \right\},  
    \]
    where
    \[
        C_{1,k}=\max\left\{ |c_k-d_{k,0}|, \left|\sum_{i-j=k,i,j\geq 1} d_{i-1,j-1}-d_{i,j}\right| \right\} 
    \]
    for $k\geq 0$
    and
    \[
        C_{2,k}=\max\left\{ |c_{-k}-d_{0,k}|, \left|\sum_{i-j=-k,i,j\geq 1} d_{i-1,j-1}-d_{i,j}\right| \right\}
    \] 
    for $k\geq 1$.
    It follows from the strong triangle inequality that $|c_k|\leq C_{1,k}$ for $k\geq 0$ and $c_{-k}\leq C_{2,k}$ for $k\geq 1$. So \eqref{eq-fnormequalquotientnorm} follows.
\end{proof}

\begin{proposition}
    Let $r\in \mathbb{R}_{>0}\setminus \sqrt{|k^{\times}|}$, then $\|\bullet\|_r$ defined in \cref{ex-Kraffinoid} is a valuation on $k_r$.
\end{proposition}
\begin{proof}
    Take $f,g\in k_r$, we need to show that
    \[
      \|fg\|_r\geq \|f\|_r\|g\|_r.  
    \]
    Let us expand
    \[
      f=\sum_{i=-\infty}^{\infty} a_i T^i,\quad   g=\sum_{i=-\infty}^{\infty} b_i T^i.
    \]
    Take $i$ and $j$ so that
    \begin{equation}\label{eq-aibjnorm}
      |a_i|r^i=\|f\|_r,\quad |b_j|r^j=\|g\|_r.  
    \end{equation}
    By our assumption on $r$, $i,j$ are unique.
    Then
    \[
      \|fg\|_r=\max_{k\in \mathbb{Z}}\{ |c_k|r^k\},
    \]
    where 
    \[
      c_k:=\sum_{u,v\in \mathbb{Z},u+v=k}a_ub_v.  
    \]
    It suffices to show that
    \begin{equation}\label{eq-ckrkequalfrgr}
        |c_k|r^k=\|f\|_r\|g\|_r.
    \end{equation}
    for $k=i+j$. Of course, we may assume that $a_i\neq 0$ and $b_j\neq 0$ as otherwise there is nothing to prove.
    For $u,v\in \mathbb{Z}$, $u+v=i+j$ while $(u,v)\neq (i,j)$, we may assume that $u\neq i$. Then $|a_u|r^u < |a_i|r^i$ and $|b_v|r^v\leq |b_j|r^j$. So $|a_ub_v|< |a_ib_j|$ and we conclude \eqref{eq-ckrkequalfrgr}.
\end{proof}
\begin{remark}
    The argument of \cref{Banach-prop-strictconvseriesradiusBanach} in the chapter Banch Rings does not work here if $r\in \sqrt{|k^{\times}|}$, as in general one can not take minimal $i,j$ so that \eqref{eq-aibjnorm} is satisfied.
\end{remark}



\begin{proposition}\label{prop-Krvaluation}
    Assume that $r\in \mathbb{R}_{>0}\setminus \sqrt{|k^{\times}|}$. Then $k_r$ is a valuation field and $\|\bullet\|_r$ is non-trivial.
\end{proposition}
\begin{proof}
    We first show that $\Sp k_r$ consists of a single point: $\|\bullet\|_r$. Assume that $|\bullet|\in \Sp k_r$. As $\|\bullet\|_r$ is a valuation, we find 
    \begin{equation}\label{eq-compseminormnormr}
      |\bullet|\leq \|\bullet\|_r.  
    \end{equation}
    In particular, $|\bullet|$ restricted to $k$ is the given valuation on $k$. It suffices to show that $|T|=r$. This follows from \eqref{eq-compseminormnormr} applied to $T$ and $T^{-1}$.

    It follows that $k_r$ does not have any non-zero proper closed ideals: if $I$ is such an ideal, $k_r/I$ is a Banach $k$-algebra. By \cref{Banach-prop-Berkospecnonempty} in the chapter Banach rings, $\Sp k_r$ is non-empty. So $k_r$ has to admit bounded semi-valuation with non-trivial kernel.

    In particular, by \cref{Banach-cor:maximalidealclosedinBanachring} in the chapter Banach rings, the only maximal ideal of $k_r$ is $0$. It follows that $k_r$ is a field.

    The valuation $\|\bullet\|_r$ is non-trivial as $\|T\|_r=r$.
\end{proof}

\begin{definition}\label{def-kfreekr}
    An element $r=(r_1,\ldots,r_n)\in \mathbb{R}^n_{>0}$ for some $n\in \mathbb{N}$ is called a \emph{$k$-free polyray} if $r_1,\ldots,r_n$ are linearly independent in the $\mathbb{Q}$-linear space $\mathbb{Q}\otimes_{\mathbb{Z}}\mathbb{R}_{>0}/\sqrt{|k^{\times}|}$.

    Let $n\in \mathbb{N}$ and $r=(r_1,\ldots,r_n)\in \mathbb{R}^n_{>0}$. Assume that $r$ is a $k$-free polyray. We define 
    \[
        k_r=k_{r_1}\hat{\otimes}_k \cdots \hat{\otimes}_k k_{r_n}.  
    \]
\end{definition}
By an interated application of \cref{prop-Krvaluation}, $k_r$ is a complete valuation field.

As a general explanation of why $k_r$ is useful, we prove the following proposition:
\begin{proposition}\label{prop-Krfaithflat}
    Let $n\in \mathbb{N}$ and $r=(r_1,\ldots,r_n)$ be a $k$-free polyray.
    \begin{enumerate}
        \item For any $k$-Banach space $X$, the natural map
        \[
            X\rightarrow X\hat{\otimes}_k k_r    
        \]
        is an isometric embedding.
        \item Consider a sequence of bounded homomorphisms of $k$-Banch spaces $X\rightarrow Y\rightarrow Z$. Then the sequence is admissible and exact (resp. coexact) if and only if $X\hat{\otimes}_k k_r \rightarrow Y\hat{\otimes}_k k_r \rightarrow Z\hat{\otimes}_k k_r $ is admissible and exact (resp. coexact).
    \end{enumerate}
\end{proposition}
\begin{proof}
    We may assume that $n=1$. 

    (1) We have a more explicit description of $X\hat{\otimes}_k k_r$: as a vector space, it is the space of $f=\sum_{i=-\infty}^{\infty}a_i T^i$ with $a_i\in X$ and $\|a_i\|r^i\to 0$ when $|i|\to \infty$. The norm is given by $\max_i\|a_i\|r^i$. From this description, the embedding is obvious.

    (2) This follows easily from the explicit description in (1).
\end{proof}
When $X$ is a Banach $k$-algebra,  $X\hat{\otimes}_k k_r$ is a Banach $k_r$-algebra. 

\begin{example}\label{ex-generalkr}
    For any $n\in \mathbb{N}$, $r\in \mathbb{R}^n_{>0}$, not necessarily $k$-free. We define $k_r$ as the completed fraction field of $k\{r^{-1}T\}$ provided with the extended valuation $|\bullet|_r$. Then $k_r$ is still a valuation field extending $k$.
    
    When $r$ is a $k$-free polyray, we claim that $k_r$ coincides with $k_r$ defined in \cref{def-kfreekr}.
    To see this, let us temporarily denote the $k_r$ defined in this example as $k_r'$
    consider the extension of field:
    \[
        \Frac k\{r^{-1}T\}\rightarrow k_r=k\{r^{-1}T,rS\}/(T_1S_1-1,\ldots,T_nS_n-1) 
    \]
    sending $T_i$ to $T_i$ for $i=1,\ldots,n$. Observe that this is an extension of valuation field as well by the same arguments as in \cref{prop-Krisaffinoid}. In particular, it induces an extension of complete valuation fields $k_r'\rightarrow k_r$. But the image clearly contains the classes of all polynomials in $k[T,S]$, so $k_r'\rightarrow k_r$ is an isometric isomorphism.
\end{example}


\begin{proposition}\label{prop-strictlykafffinite}
    Assume that $k$ is non-trivially valued.
    Let $B$ be a strict $k$-affinoid algebra and $\varphi:B\rightarrow A$ be a finite bounded $k$-algebra homomorphism into a $k$-Banach algebra $A$. Then $A$ is also strictly $k$-affinoid.
\end{proposition}
\begin{proof}
    We may assume that $B=k\{T_1,\ldots,T_n\}$ for some $n\in \mathbb{N}$. By assumption, we can find finitely many $a_1,\ldots,a_m\in A$ such that $A=\sum_{i=1}^m \varphi(B)a_i$.

    We may assume that $a_i\in \mathring{A}$ as $k$ is non-trivially valued. By \cref{Banach-prop-Tateunivprop} in the chapter Banach Rings, $\varphi$ admits a unique extension to a bounded $k$-algebra epimorphism 
    \[
        \Phi:  k\{T_1,\ldots,T_n,S_1,\ldots,S_m\}\rightarrow A
    \]
    sending $S_i$ to $a_i$. By \cref{Banach-cor-bddisadmi} in the chapter Banach Rings, $\Phi$ is admissible. Moreover, the homomorphism $\Phi$ is surjective by our assumption. It follows that $A$ is strictly $k$-affinoid.
\end{proof}

\begin{proposition}\label{prop-finiteinduceaffnorm}
    Assume that $k$ is non-trivially valued.
    Let $B$ be a strict $k$-affinoid algebra and $\varphi:B\rightarrow A$ be a finite $k$-algebra homomorphism into a $k$-algebra $A$. Then there is a norm on $A$ such that the morphism is bounded and $A$ is strictly $k$-affinoid.
\end{proposition}
\begin{proof}
    By \cref{Banach-prop-algebrafinitenormadmi} in the chapter Banach Rings, we can endow $A$ with a Banach norm such that $\varphi$ is admissible. Then we can apply \cref{prop-strictlykafffinite}.
\end{proof}

\begin{lemma}\label{lma-tatestrictaff}
    Assume that $k$ is non-trivially valued.
    Let $n\in \mathbb{N}$ and $r=(r_1,\ldots,r_n)\in \mathbb{R}^n_{>0}$. The algebra $k\{r^{-1}T\}$ is strictly $k$-affinoid if $r_i\in \sqrt{|k^{\times}|}$ for all $i=1,\ldots,n$.
\end{lemma}
\begin{remark}
    The converse is also true.     
\end{remark}

\begin{proof}
    Assume that $r_i\in \sqrt{|k^{\times}|}$ for all $i=1,\ldots,n$. Take $s_i\in \mathbb{N}$ and $c_i\in k^{\times}$ such that 
    \[
        r_i^{s_i}=|c_i^{-1}|  
    \]
    for $i=1,\ldots,n$. We deifne a bounded $k$-algebra homomorphism $\varphi:k\{T_1,\ldots,T_n\}\rightarrow k\{r_1^{-1}T_1,\ldots,r_n^{-1}T_n\}$ by sending $T_i$ to $c_iT_i^{s_i}$. This is possible by \cref{Banach-prop-Tateunivprop} in the chapter Banach Rings.

    We claim that $\varphi$ is finite. To see this, it suffices to observe that if we expand $f\in k\{r_1^{-1}T_1,\ldots,r_n^{-1}T_n\}$ as
    \[
        f=\sum_{\alpha \in \mathbb{N}^n} a_{\alpha}T^{\alpha},  
    \]
    we can regroup
    \[
        f=\sum_{\beta \in \mathbb{N}^n, \beta_i<s_i} T^{\beta}\sum_{\gamma\in \mathbb{N}^n} a_{\gamma s+\beta}c^{-\gamma} (cT^s)^{\gamma},
    \]
    where the product $\gamma s$ is taken component-wise. For each $\beta \in \mathbb{N}^n, \beta_i<s_i$, we set
    \[
        g_{\beta}:=\sum_{\gamma\in \mathbb{N}^n} a_{\gamma s+\beta}c^{-\gamma} (T)^{\gamma}\in k\{T_1,\ldots,T_n\}.
    \]  
    While $f=\sum_{\beta \in \mathbb{N}^n, \beta_i<s_i} \varphi(g_{\beta})T^{\beta}$. So We have shown that $\varphi$ is finite. Hence, $k\{r_1^{-1}T_1,\ldots,r_n^{-1}T_n\}$ is $k$-affinoid by \cref{prop-strictlykafffinite}.
\end{proof}


\begin{proposition}\label{prop-redtostrictlykaff}
    Let $A$ be a $k$-affinoid algebra, then there is $n\in \mathbb{N}$ and a $k$-free polyray $r=(r_1,\ldots,r_n)$ such that $A\hat{\otimes}_k k_r$ is strictly $k_r$-affinoid. Moreover, we can guarantee that $k_r$ is non-trivially valued.
\end{proposition} 
\begin{proof}
    By \cref{prop-Krfaithflat}, we may assume that $A=k\{t^{-1}T\}$ for some $t\in \mathbb{R}^m_{>0}$. By \cref{lma-tatestrictaff}, it suffices to take $r$ so that the linear subspace of $\mathbb{R}_{>0}/\sqrt{|k^{\times}|}$ generated by $r_1,\ldots,r_n$ contains all components of $t$. By taking $n\geq 1$, we can guarantee that $k_r$ is non-trivially valued.
\end{proof}

\begin{proposition}\label{prop-monoaffinj}
    Let $\varphi:\Sp B\rightarrow \Sp A$ be a monomorphism in $k_H\text{-}\AffCat$. Then for any $y\in \Sp B$ with $x=\varphi(y)$, one has $\varphi^{-1}(x)=\{y\}$ and the natural map $\mathscr{H}(x)\rightarrow \mathscr{H}(y)$ is an isomorphism of complete valuation rings.
\end{proposition}
\begin{proof}
    It suffices to show that $\mathscr{H}(x)\rightarrow B\hat{\otimes}_A \mathscr{H}(y)$ is an isomorphism as Banach $k$-algebras. \textcolor{red}{Include details about cofiber products in affalg.} By assumption, the codiagonal map $B\hat{\otimes}_A B\rightarrow B$ is an isomorphism. It follows that the base change with respect to $A\rightarrow \mathscr{H}(x)$ is also an isomorphism: $B'\hat{\otimes}_{\mathscr{H}(x)}B'\rightarrow B'$, where $B'=B\hat{\otimes}_A \mathscr{H}(x)$.

    \textcolor{red}{Include the fact that the first map is injective.}
    It follows that the composition $B'\otimes_{\mathscr{H}(x)}B\rightarrow B'\hat{\otimes}_{\mathscr{H}(x)}B'\rightarrow B'$ is injective.
    Therefore, $\mathscr{H}(x)\rightarrow B'$ is an isomorphism of rings.  We also know that this map is bounded.
    But we already know that $\mathscr{H}(x)$ is a complete valuation ring, so the map $\mathscr{H}(x)\rightarrow B'$ is an isomorphism of complete valuation rings.
\end{proof}

\section{Weierstrass theory}
Let $(k,|\bullet|)$ be a complete non-Archimedean valued-field.

\begin{proposition}\label{prop-reductionTn}
    We have canonical identifications
    \[
        \begin{aligned}
        (k\{T_1,\ldots,T_n\} )^{\circ}\cong & \mathring{k}\{T_1,\ldots,T_n\},\\
        (k\{T_1,\ldots,T_n\} )^{\check{}}\cong & \check{k}\{T_1,\ldots,T_n\},\\
        \widetilde{k\{T_1,\ldots,T_n\}  }\cong & \tilde{k}[T_1,\ldots,T_n].
        \end{aligned}
    \]
    The last identification extends $\mathring{k}\rightarrow \tilde{k}$ and $T_i$ is mapped to $T_i$.
\end{proposition}
\begin{proof}
    This follows from \cref{Banach-cor-reductionstrictlyconv} from the chapter Banach rings.
\end{proof}
We will denote the reduction map $\mathring{k}\{T_1,\ldots,T_n\}\rightarrow \tilde{k}[T_1,\ldots,T_n]$ by $\tilde{\bullet}$.

\begin{definition}\label{def-affchart}
    Let $n\in \mathbb{N}$. A system $f_1,\ldots,f_n\in k\{T_1,\ldots,T_n\}$ is called an \emph{affinoid chart} of $k\{T_1,\ldots,T_n\}$ if $f_i\in \mathring{k}\{T_1,\ldots,T_n\}$ for each $i=1,\ldots,n$ and the continuous $k$-algebra homomorphism $k\{T_1,\ldots,T_n\}\rightarrow k\{T_1,\ldots,T_n\}$ sending $T_i$ to $f_i$ is an isomorphism.
\end{definition}
The map $k\{T_1,\ldots,T_n\}\rightarrow k\{T_1,\ldots,T_n\}$ is well-defined by \cref{prop-reductionTn} and \cref{lma-Tatestrictuniv}.


\begin{lemma}\label{lma-unitsTate}
    Let $n\in \mathbb{N}$ and $f\in k\{T_1,\ldots,T_n\}$. Assume that $\|f\|_1=1$. Then the following are equivalent:
    \begin{enumerate}
        \item $f$ is a unit $k\{T_1,\ldots,T_n\}$.
        \item $\tilde{f}$ is a unit in $\tilde{k}[T_1,\ldots,T_n]$.
    \end{enumerate}
\end{lemma}
\begin{proof}
    As $\|\bullet\|_1$ is a valuation by \cref{prop-Krisaffinoid}, $f$ is a unit in $k\{T_1,\ldots,T_n\}$ if and only if it is a unit in $(k\{T_1,\ldots,T_n\} )^{\circ}$, which is identified with $\mathring{k}\{T_1,\ldots,T_n\}$ by \cref{prop-reductionTn}. This result then follows from \cref{Banach-cor-unitsstrictlyconv} in the chapter Banach Rings.
\end{proof}

\begin{definition}
   Let $n\in \mathbb{N}$. Consider $g\in k\{T_1,\ldots,T_n\}$. We expand $g$ as
   \[
        g=\sum_{i=0}^{\infty}g_i T_n^{i},\quad g_i\in k\{T_1,\ldots,T_{n-1}\}.
   \] 
   For $s\in \mathbb{N}$, we say $g$ is \emph{$X_n$-distinguished of degree $s$} if $g_s$ is a unit in $k\{T_1,\ldots,T_{n-1}\}$, $\|g_s\|_{1}=\|g\|_1$ and $\|g_s\|_1>\|g_{t}\|_1$ for all $t>s$.
\end{definition}

\begin{thm}[Weierstrass division theorem]\label{thm-Weierstrassdivision}
    Let $n,s\in \mathbb{N}$ and $g\in k\{T_1,\ldots,T_n\}$ be $X_n$-distinguished of degree $s$. Then for each $f\in k\{T_1,\ldots,T_n\}$, there exist $q\in k\{T_1,\ldots,T_n\}$ and $r\in k\{T_1,\ldots,T_{n-1}\}[T_n]$ with $\deg_{T_n}r<s$ such that 
    \[
        f=qg+r.
    \]
    Moreover, $q$ and $r$ are uniquely determined. We have the following estimates
    \begin{equation}\label{eq-estiWeirediv}
        \|q\|_1\leq \|g\|_1^{-1}\|f\|_1,\quad \|r\|_1\leq \|f\|_1.   
    \end{equation}
    If in addition, $f,g\in k\{T_1,\ldots,T_{n-1}\}[T_n]$, then $q\in k\{T_1,\ldots,T_{n-1}\}[T_n]$ as well. 
\end{thm}
\begin{proof}
    We may assume that $\|g\|_1=1$.

    \textbf{Step~1}. Assuming the existence of the division. Let us prove \eqref{eq-estiWeirediv}. We may assume that $f\neq 0$, so that one of $q,r$ is non-zero. Up to replacing $q,r$ by a scalar multiple, we may assume that $\max\{\|q\|_1,\|r\|_1\}=1$. So $\|f\|_1\leq 1$ as well. We need to show that $\|f\|_1= 1$. Assume the contrary, then 
    \[
        0=\tilde{f} =\tilde{q}\tilde{g}+\tilde{r}. 
    \]
    Here $\tilde{\bullet}$ denotes the reduction map. By our assumption, $\deg_{T_n}=s>\deg_{T_n}r\geq \deg_{T_n}\tilde{r}$. From  \cref{prop-reductionTn}, the equality is in $\tilde{k}[T_1,\ldots,T_n]$. From the usual Euclidean division, we have $\tilde{q}=\tilde{r}=0$. This is a contradiction to our assumption.

    \textbf{Step~2}. Next we verify the uniqueness of the division. Suppose that 
    \[
        0=qg+r  
    \]
    with $q$ and $r$ as in the theorem. The estimate in Step~1 shows that $q=r=0$.

    \textbf{Step~3}. We prove the existence of the division.

    We define
    \[
        B:=\left\{qg+r:r\in k\{T_1,\ldots,T_{n-1}\}[T_n], \deg_{T_n}r<s,q\in k\{T_1,\ldots,T_{n}\}\right\}.
    \]
    From Step~1, $B$ is a closed subgroup of $k\{T_1,\ldots,T_{n}\}$. In fact, suppose $f_i\in B$ is a sequence converging to $f\in k\{T_1,\ldots,T_{n}\}$. From Step~1, we can represent $f_i=q_ig+r_i$, then from Step~1, $q_i$ and $r_i$ are both Cauchy sequences, we may assume that $q_i\to q\in k\{T_1,\ldots,T_{n}\}$ and $r_i\to r$. As $\deg_{T_n}r_i<s$, it follows that $r\in k\{T_1,\ldots,T_{n-1}\}[T_n]$ and $\deg_{T_n}r<s$. So $f=qg+r$ and hence $B$ is closed.

    It suffices to show that $B$ is dense $k\{T_1,\ldots,T_{n}\}$. We write 
    \[
      g=\sum_{i=0}^{\infty}g_i T_n^{i},\quad g_i\in k\{T_1,\ldots,T_{n-1}\}.  
    \]
    We may assume that $\|g\|_1=1$.
    Define $\epsilon:=\max_{j\geq s} \|g_j\|$. Then $\epsilon<1$ by our assumption. Let $k_{\epsilon}=\{x\in k:|x|\leq \epsilon\}$ for the moment. There is a natural surjective ring homomorphism 
    \[
        \tau_{\epsilon}:(k\{T_1,\ldots,T_n\} )^{\circ}\rightarrow (\mathring{k}/k_{\epsilon})[T_1,\ldots,T_n]
    \] 
    with kernel $\{f\in k\{T_1,\ldots,T_n\}  : \|f\|_1\leq \epsilon\}$.  We now apply Euclidean division in the ring $(\mathring{k}/k_{\epsilon})[T_1,\ldots,T_n]$ to write
    \[
        \tau_{\epsilon}(f)=\tau_{\epsilon}(q)\tau_{\epsilon}(g)+\tau_{\epsilon}(r)
    \]
    for some $q\in (k\{T_1,\ldots,T_n\} )^{\circ}$ and $r\in (k\{T_1,\ldots,T_{n-1}\} )^{\circ}[T_n]$ with $\deg_{T_n}r<s$. So
    \[
        \|f-qg-r\|_1\leq \epsilon.  
    \]
    This proves that $B$ is dense in $k\{T_1,\ldots,T_{n}\}$ by \cref{Banach-prop-epsilondenseimpliesdense} in the chapter Banach rings.

    \textbf{Step~4}. It remains to prove the last assertion. But this is a consequence of the usual Euclidean division theorem for the ring $k\{T_1,\ldots,T_{n-1}\}[T_n]$ and the uniqueness proved in Step~2.
\end{proof}
\begin{lemma}\label{lma-Weierstrasspolycancel2}
    Let $\omega\in k\{ T_1,\ldots,T_{n-1}\}[T_n] $ be a Weierstrass polynomial and $g\in k\{ T_1,\ldots,T_{n}\}$. Assume that $\omega g\in k\{ T_1,\ldots,T_{n-1}\}[T_n]$, then $g\in k\{ T_1,\ldots,T_{n-1}\}[T_n]$.
\end{lemma}
\begin{proof}
    By the division theorem of polynomial rings, we can write
    \[
        \omega g = q\omega+r  
    \]
    for some $q,r\in k\{ T_1,\ldots,T_{n-1}\}[T_n]$, $\deg_{T_n}r<\deg_{T_n}\omega g$. But we can write $\omega g= \omega \cdot g$. From the uniqueness part of \cref{thm-Weierstrassdivision}, we know that $q=g$, so $g$ is a polynomial in $T_n$.
\end{proof}

As a consequence, we deduce Weierstrass preparation theorem.
\begin{definition}
    Let $n\in \mathbb{Z}_{>0}$. A \emph{Weierstrass polynomial} in $n$-variables is a monic polynomial $\omega\in k\{T_1,\ldots,T_{n-1}\}[T_n]$ with $\|\omega\|_1=1$.
\end{definition}
\begin{lemma}\label{lma-Weierstrassfact}
    Let $n\in \mathbb{Z}_{>0}$ and $\omega_1,\omega\in k\{T_1,\ldots,T_{n-1}\}[T_n]$ be two monic polynomials. If $\omega_1\omega_2$ is a Weierstrass polynomial then so are $\omega_1$ and $\omega_2$.
\end{lemma}
\begin{proof}
    As $\omega_1$ and $\omega_2$ are monic, $\|\omega_i\|_1\geq 1$ for $i=1,2$. On the other hand, $\|\omega_1\|_1\cdot\|\omega_2\|_1=\|\omega_1\omega_2\|_1=1$, so $\|\omega_i\|_1= 1$ for $i=1,2$.
\end{proof}

\begin{thm}[Weierstrass preparation theorem]\label{thm-Weierstrasspreparation}
    Let $n\in \mathbb{Z}_{>0}$ and $g\in k\{T_1,\ldots,T_{n}\}$ be $X_n$-distinguished of degree $s$. Then there are a Weierstrass polynomial $\omega\in k\{T_1,\ldots,T_{n-1}\}[T_n]$ of degree $s$ and a unit $e\in k\{T_1,\ldots,T_{n}\}$ such that 
    \[
        g=e\omega.
    \]
    Moreover, $e$ and $\omega$ are unique. If $g\in k\{T_1,\ldots,T_{n-1}\}[T_n]$, then so is $e$.
\end{thm}
\begin{proof}
    We first prove the uniqueness. Assume that a decomposition as in the theorem is given. Let $r=T_n^s-\omega$. Then $T_n^s=e^{-1}g+r$. The uniqueness part of \cref{thm-Weierstrassdivision} implies that $e$ and $r$ are uniquely determined, hence so is $\omega$.

    Next we prove the existence.
    By Weierstrass division theorem \cref{thm-Weierstrassdivision}, we can write
    \[
          T_n^s=q g+r
    \]
    for some $q\in k\{T_1,\ldots,T_{n}\}$ and $r\in k\{T_1,\ldots,T_{n-1}\}[T_n]$ with $\deg_{T_n} r<s$. Let $\omega=T_n^s-r$. From the estimates in \cref{thm-Weierstrassdivision}, $\|r\|_1\leq 1$. So $\|\omega\|_1=1$.
    Then $\omega$ is a Weierstrass polynomial of degree $s$ and $\omega=q g$.
    It suffices to argue that $q$ is a unit. 

    We may assume that $\|g\|_1=1$. By taking reductions, we find
    \[
        \tilde{\omega}=\tilde{q}\tilde{g}.  
    \]
    As $\deg_{T_n}\tilde{g}=\deg_{T_n}\tilde{\omega}$ and the leading coefficients of both polynomials are units in $\tilde{k}[T_1,\ldots,T_{n-1}]$, it follows that $\tilde{q}$ is a unit in $\tilde{k}[T_1,\ldots,T_{n-1}]$. It follows that $\tilde{q}$ is also a unit in $\tilde{k}[T_1,\ldots,T_{n}]$. By \cref{lma-unitsTate}, $q$ is a unit in $k\{T_1,\ldots,T_{n}\}$.

    The lsat assertion is already proved in \cref{thm-Weierstrassdivision}.

\end{proof}

\begin{definition}
    Let $n\in \mathbb{Z}_{>0}$ and $g\in k\{T_1,\ldots,T_{n}\}$ be $X_n$-distinguished. Then the Weierstrass polynomial $\omega$ constructed in \cref{thm-Weierstrasspreparation} is called the \emph{Weierstrass polynomial} defined by $g$.
\end{definition}

\begin{corollary}\label{cor:quotientreplacedbyWeie}
    Let $n\in \mathbb{Z}_{>0}$ and $g\in k\{T_1,\ldots,T_{n}\}$ be $X_n$-distinguished. Let $\omega$ be the Weierstrass polynomial of $g$. Then the injection
    \[
        k\{T_1,\ldots,T_{n-1}\}[T_n]\rightarrow  k\{T_1,\ldots,T_{n}\}
    \]
    induces an isomorphism of $k$-algebras
    \[
        k\{T_1,\ldots,T_{n-1}\}[T_n]/(\omega)\rightarrow  k\{T_1,\ldots,T_{n}\}/(g).
    \]
\end{corollary}
\begin{proof}
    The surjectivity follows from \cref{thm-Weierstrassdivision} and the injectivity follows from \cref{lma-Weierstrasspolycancel2}.
\end{proof}

In the complex setting, we can perturb a convergent power series so that it has finite degree along a fixed axis, the corresponding result in the current setting is:
\begin{lemma}\label{lma-perturb}
    Let $n\in \mathbb{Z}_{>0}$ and $g\in k\{T_1,\ldots,T_{n}\}$ is non-zero. Then there is a $k$-algebra automorphism $\sigma$ of $k\{T_1,\ldots,T_{n}\}$ so that $\sigma(g)$ is $T_n$-distinguished.
\end{lemma}

\begin{proof}
    We may assume that $\|g\|_1=1$. We expand $g$ as
    \[
        g=\sum_{\alpha\in \mathbb{N}^n} a_{\alpha}T^{\alpha}.
    \]
    Endow $\mathbb{N}^n$ with the lexicographic order. Take the maximal $\beta\in \mathbb{N}^n$ so that $|a_{\beta}|=1$. Take $t\in \mathbb{Z}_{>0}$ so that $t\geq \max_{i=1,\ldots,n} \alpha_i$ for all $\alpha\in \mathbb{N}^n$ with $\tilde{a}_{\alpha}\neq 0$.

    We will define $\sigma$ by sending $T_i$ to $T_i+T_n^{c_i}$ for all $i=1,\ldots,n-1$. The $c_i$'s are to be defined. We begin with $c_n=1$ and define the other $c_i$'s inductively:
    \[
        c_{n-j}=1+t\sum_{d=0}^{j-1}c_{n-d}  
    \]
    for $j=1,\ldots,n-1$. We claim that $\sigma(f)$ is $T_n$-distinguished of order $s=\sum_{i=1}^n c_i \beta_i$.

    A straightforward computation shows that 
    \[
        \widetilde{\sigma(g)}=\sum_{i=1}^s p_i T_n^i  
    \]
    for some $p_i\in \tilde{k}[T_1,\ldots,T_{n-1}]$ and $p_s=\tilde{a_{\beta}}$. Our claim follows.
\end{proof}



\begin{proposition}\label{prop-strictnoetherian}
    Let $n\in \mathbb{N}$. Then $k\{T_1,\ldots,T_n\}$ is Noetherian.
\end{proposition}
\begin{proof}
    We make induction on $n$. The case $n=0$ is trivial. Assume that $n>0$. It suffices to show that for any non-zero $g\in k\{T_1,\ldots,T_n\}$, $k\{T_1,\ldots,T_n\}/(g)$ is Noetherian. By \cref{lma-perturb}, we may assume that $g$ is $T_n$-distinguished. By \cref{thm-Weierstrassdivision}, $k\{T_1,\ldots,T_n\}/(g)$ is a finite free $k\{T_1,\ldots,T_{n-1}\}$-module. By the inductive hypothesis and Hilbert basis theorem, $k\{T_1,\ldots,T_n\}/(g)$ is indeed Noetherian.
\end{proof}

\begin{proposition}\label{prop-TateJacobson}
    Let $n\in \mathbb{N}$. Then $k\{T_1,\ldots,T_n\}$ is Jacobson.
\end{proposition}
\begin{proof}
    When $n=0$, there is nothing to prove. We make induction on $n$ and assume that $n>0$. Let $\mathfrak{p}$ be a prime ideal in $k\{T_1,\ldots,T_n\}$, we want to show that the Jacobson radical of $\mathfrak{p}$ is equal to $\mathfrak{p}$. 
    
    We distinguish two cases. First we assume that $\mathfrak{p}\neq 0$. Let $\mathfrak{p}'=\mathfrak{p}\cap k\{T_1,\ldots,T_{n-1}\}$. By \cref{lma-perturb}, we may assume that $\mathfrak{p}$ contains a Weierstrass polynomial $\omega$. Observe that
    \[
        k\{T_1,\ldots,T_{n-1}\}/\mathfrak{p}'\rightarrow k\{T_1,\ldots,T_n\}/\mathfrak{p}
    \]
    is finite by \cref{thm-Weierstrassdivision}. For any $b\in J(k\{T_1,\ldots,T_n\}/\mathfrak{p})$ (where $J$ denotes the Jacobson radical), we consider a monic integral equation of minimal degree over $k\{T_1,\ldots,T_{n-1}\}/\mathfrak{p}'$:
    \[
        b^n+a_1b^{n-1}+\cdots+a_n=0,\quad a_i\in   k\{T_1,\ldots,T_{n-1}\}/\mathfrak{p}'.
    \]
    Then
    \[
        a_n\in J(k\{T_1,\ldots,T_{n}\}/\mathfrak{p})\cap k\{T_1,\ldots,T_{n-1}\}/\mathfrak{p}'=J(k\{T_1,\ldots,T_{n-1}\}/\mathfrak{p}')=0
    \]
    by our inductive hypothesis. It follows that $n=1$ and so $b=0$. This proves $J(k\{T_1,\ldots,T_{n}\}/\mathfrak{p})=0$.

    On the other hand, let us consider the case $\mathfrak{p}=0$. As $k\{T_1,\ldots,T_n\}$ is a valuation ring, it is an integral domain, so the nilradical is $0$. We need to show that
    \[
        J(k\{T_1,\ldots,T_n\})=0.  
    \]
    Assume that there is a non-zero element $f$ in $J(k\{T_1,\ldots,T_n\})$. We may assume that $\|f\|_1=1$. 
    
    We claim that there is $c\in k$ with $|c|=1$ such that $c+f$ is not a unit in $k\{T_1,\ldots,T_n\}$. Assuming this claim for the moment, we can find a maximal ideal $\mathfrak{m}$ of $k\{T_1,\ldots,T_n\}$ such that $c+f\in \mathfrak{m}$. But $f\in \mathfrak{m}$ by our assumption, so $c\in \mathfrak{m}$ as well. This contradicts the fact that $c\in k^{\times}$.
    
    It remains to prove the claim. We treat two cases separately. When $|f(0)|<1$, we simply take $c=1$, which works thanks to \cref{lma-unitsTate}.
    If $|f(0)|=1$, we just take $c=-f(0)$.
\end{proof}

\begin{proposition}\label{prop-Tatealgufd}
    Let $n\in \mathbb{N}$. Then $k\{T_1,\ldots,T_n\}$ is UFD. In particular, $k\{T_1,\ldots,T_n\}$ is normal.
\end{proposition}
\begin{proof}
    As $\|\bullet\|_1$ is a valuation by \cref{prop-TateGaussvaluation}, $k\{T_1,\ldots,T_n\}$ is an integral domain. In order to see that $k\{T_1,\ldots,T_n\}$ has the unique factorization property, we make induction on $n\geq 0$. When $n=0$, there is nothing to prove. Assume that $n>0$. Take a non-unit element $f\in k\{T_1,\ldots,T_n\}$. By \cref{thm-Weierstrasspreparation} and \cref{lma-perturb}, we may assume that $f$ is a Weierstrass polynomial. By inductive hypothesis, $k\{T_1,\ldots,T_{n-1}\}$ is a UFD, hence so is $k\{T_1,\ldots,T_{n-1}\}[T_n]$ by \cite[\href{https://stacks.math.columbia.edu/tag/0BC1}{Tag 0BC1}]{stacks-project}. It follows that $f$ can be decomposed into the products of monic prime elements $f_1,\ldots,f_r\in k\{T_1,\ldots,T_{n-1}\}[T_n]$, which are all Weierstrass polynomials by \cref{lma-Weierstrassfact}. Then by \cref{cor:quotientreplacedbyWeie}, we see that each $f_i$ is prime in $k\{T_1,\ldots,T_{n}\}$.

    Any UFD is normal by \cite[\href{https://stacks.math.columbia.edu/tag/0AFV}{Tag 0AFV}]{stacks-project}.
\end{proof}


\begin{corollary}\label{cor-rhofaithful}
    Let $A$ be a strictly $k$-affinoid algebra, $d\in \mathbb{N}$ and $\varphi:k\{T_1,\ldots,T_d\}\rightarrow A$ be an integral torsion-free injective homomorphism of $k$-algebras. Then $\rho$ is a faithful $k\{T_1,\ldots,T_d\}$-algebra norm on $A$. If $f^n+\varphi(t_1)f^{n-1}+\cdots+\varphi(t_n)=0$ is the minimal integral equation of $f$ over $k\{T_1,\ldots,T_d\}$, then 
    \[
        |f|_{\sup}=\max_{i=1,\ldots,n} |t_i|^{1/i}.  
    \]
\end{corollary}
\begin{proof}
    This follows from \cref{Banach-prop-fsupspecexp} in the chapter Banach Rings and \cref{prop-Tatealgufd}.
\end{proof}


\section{Noetherian normalization and maximal modulus principle}
Let $(k,|\bullet|)$ be a complete non-trivially valued non-Archimedean valued-field. 

\begin{thm}\label{thm-Noetheriannorm}
    Let $A$ be a non-zero strictly $k$-affinoid algebra, $n\in \mathbb{N}$ and $\alpha:k\{T_1,\ldots,T_n\}\rightarrow A$ be a finite (resp. integral) $k$-algebra homomorphism. Then up to replacing $T_1,\ldots,T_n$ by an affinoid chart, we can guarantee that there exists $d\in \mathbb{N}$, $d\leq n$ such that $\alpha$ when restricted to $k\{T_1,\ldots,T_d\}$ is finite (resp. integral) and injective.
\end{thm}
\begin{proof}
    We make an induction on $n$. The case $n=0$ is trivial. Assume that $n>0$. If $\ker \alpha=0$, there is nothing to prove, so we may assume that $\ker \alpha\neq 0$. By \cref{lma-perturb} and \cref{thm-Weierstrasspreparation}, we may assume that there is a Weierstrass polynomial $\omega\in k\{T_1,\ldots,T_{n-1}\}[T_n]$ in $\ker \alpha$. Then $\alpha$ induces a finite (resp. integral) homomorphism $\beta:k\{T_1,\ldots,T_n\}/(\omega)\rightarrow A$. By \cref{thm-Weierstrassdivision}, $k\{T_1,\ldots,T_{n-1}\}\rightarrow k\{T_1,\ldots,T_n\}/(\omega)$ is a finite homomorphism. So their composition is a finite (resp. integral) homomorphism $k\{T_1,\ldots,T_{n-1}\}\rightarrow A$. We can apply the inductive hypothesis to conclude.
\end{proof}
\begin{corollary}\label{cor-noenormalization}
    Let $A$ be a non-zero strictly $k$-affinoid algebra, then there is $d\in \mathbb{N}$ and a finite injective $k$-algebra homomorphism: $k\{T_1,\ldots,T_d\}\rightarrow A$.
\end{corollary}
\begin{proof}
    Take some $n\in \mathbb{N}$ and a surjective $k$-algebra homomorphism $k\{T_1,\ldots,T_n\}\rightarrow A$ and apply \cref{thm-Noetheriannorm}, we conclude.
\end{proof}


\begin{corollary}\label{cor-affinoidquotientfinite}
    Let $A$ be a strictly $k$-affinoid algebra and $I$ be an ideal in $A$ such that $\sqrt{I}$ is a maximal ideal in $A$, then $A/I$ is finite-dimensional over $k$.

    In particular, $\Spm A=\Spm_k A$.
\end{corollary}
\begin{proof}
    By \cref{cor-noenormalization}, there is $d\in \mathbb{N}$ and a finite monomorphism $f:k\{T_1,\ldots,T_d\}\rightarrow A/I$. It suffices to show that $d=0$. Observe that the composition 
    \[
        k\{T_1,\ldots,T_d\}\xrightarrow{f} A/I\rightarrow A/\sqrt{I}
    \]
    is finite and injective as $k\{T_1,\ldots,T_d\}$ is an integral domain, so $k\{T_1,\ldots,T_d\}$ is a field. This is possible only when $d=0$. 
\end{proof}

\begin{corollary}\label{cor-morphismstrictaffbdd}
    Let $B$ be a strictly $k$-affinoid algebra and $A$ be a Noetherian Banach $k$-algebra. Let $f:A\rightarrow B$ a $k$-algebra homomorphism. Then $f$ is bounded.
\end{corollary}
\begin{proof}
    This follows from \cref{Banach-prop-morphismBanachcont} in the chapter Banach Rings and \cref{prop-strictnoetherian}.
\end{proof}
In particular, we see that the topology of a $k$-affinoid algebra is uniquely determined by the algebraic structure.

\begin{corollary}\label{cor-finitehomoadmi}
    Let $A$, $B$ be strictly $k$-affinoid algebras. Let $f$ be a finite $k$-algebra homomorphism, then $f$ is admissible.
\end{corollary}
\begin{proof}
    This follows from \cref{prop-finiteinduceaffnorm} and \cref{cor-morphismstrictaffbdd},
\end{proof}
\begin{definition}
    For any non-Archimedean valuation field $(K,|\bullet|)$ and $n\in \mathbb{N}$, we define the \emph{$n$-dimensional polydisk} with value in $K$:
    \[
        B^n(K):=\left\{(x_1,\ldots,x_n)\in K^n: \max_{i=1,\ldots,n}|x_i|\leq 1\right\}.
    \]
\end{definition}

\begin{definition}
    Let $n\in \mathbb{N}$ and $f\in k\{T_1,\ldots,T_n\}$, say with an expansion
    \[
        f=\sum_{\alpha \in \mathbb{N}^n} a_{\alpha}T^{\alpha},\quad a_{\alpha}\in k.  
    \]
    We define the associated function $f:B^n(k^{\alg})\rightarrow k^{\alg}$ as sending $x=(x_1,\ldots,x_n)\in B^n(k^{\alg})$ to 
    \[
        \sum_{\alpha \in \mathbb{N}^n} a_{\alpha}x^{\alpha}.
    \]
\end{definition}


\begin{lemma}\label{lma-finducecontfunction}
    Let $n\in \mathbb{N}$ and $f\in k\{T_1,\ldots,T_n\}$, then $f:B^n(k^{\alg})\rightarrow k^{\alg}$ is continuous and for any $x\in B^n(k^{\alg})$,
    \[
        |f(x)|\leq \|f\|_1.
    \]
    There is $x=(x_1,\ldots,x_n)\in B^n(k^{\alg})$ such that $|f(x)|=\|f\|_1$.
\end{lemma}
\begin{proof}
    To see that $f$ is continuous, it suffices to observe that $f$ is a uniform limit of polynomials. For any $x=(x_1,\ldots,x_n)\in B^n(k^{\alg})$, we have
    \[
        |f(x)|  =\left|\sum_{\alpha \in \mathbb{N}^n} a_{\alpha}x^{\alpha}\right|\leq \max_{\alpha \in \mathbb{N}^n} |a_{\alpha}x^{\alpha}|\leq \|f\|_1.
    \]
    To prove the last assertion, we may assume that $\|f\|_1=1$. As the residue field of $k^{\alg}$ is equal to $\tilde{k}^{\alg}$, it has infinitely many elements, so there is a point $x\in B^n(k^{\alg})$ such that $\widetilde{f(x)}=\tilde{f}(\tilde{x})\neq 0$. In other words, $\|f(x)\|_1=1$.
\end{proof}

\begin{proposition}\label{prop-maxmod}
    Let $n\in \mathbb{N}$, then the maximal modulus principle holds for $k\{T_1,\ldots,T_n\}$. Moreover, for any $f\in k\{T_1,\ldots,T_n\}$, $\|f\|_1=|f|_{\sup}$.
\end{proposition}
\begin{proof}
    By \cref{Banach-lma-supnormbddbyrho} in the chapter Banach Rings, we have
    \[
        \|f\|_1\geq |f|_{\sup}
    \]
    for any $f\in A$. We only have to show that for any $f\in k\{T_1,\ldots,T_n\}$ there is a maximal ideal $\mathfrak{m}\subseteq k\{T_1,\ldots,T_n\}$ such that $|f(\mathfrak{m})|=\|f\|_1$.

    By \cref{lma-finducecontfunction} we can take $x=(x_1,\ldots,x_n)\in B^n(k^{\alg})$ such that $|f(x)|=\|f\|_1$. Let $L$ be the field extension of $k$ generated by $x_1,\ldots,x_n$, then $L/k$ is finite. Then we can define a homomorphism
    \[
        \mathrm{ev}_x:  k\{T_1,\ldots,T_n\} \rightarrow L
    \]
    sending $g\in k\{T_1,\ldots,T_n\}$ to $g(x)$. Observe that the image is indeed in $L$. Clearly $\mathrm{ev}_x$ is surjective. So $\mathfrak{m}_x:=\ker \mathrm{ev}_x$ is a $k$-algebraic maximal ideal in $k\{T_1,\ldots,T_n\}$. Then
    \[
        |f(\mathfrak{m}_x)|=|f(x)|=\|f\|_1.  
    \]
\end{proof}


\begin{corollary}\label{cor-strictlyaffsupnorm}
    Let $A$ be a strictly $k$-affinoid algebra. Then for any $f\in A$,
    \[
        |f|_{\sup}\subseteq \sqrt{|k^{\times}|}\cup \{0\}.  
    \]
\end{corollary}
\begin{proof}
    We may assume that $A\neq 0$.
    By \cref{cor-noenormalization} and \cref{Banach-prop-fsupspecexp} in the chapter Banach Rings, we may assume that $A=k\{T_1,\ldots,T_n\}$ for some $n\in \mathbb{N}$. The result then follows from \cref{prop-maxmod}.
\end{proof}


\begin{corollary}\label{cor:maxmodprin}
    Maximal modulus principle holds for any strictly $k$-affinoid algebras.
\end{corollary}
\begin{proof}
    This follows from \cref{cor-noenormalization}, \cref{Banach-prop-fsupspecexp} in the chapter Banach Rings and \cref{prop-maxmod}.
\end{proof}

\begin{proposition}\label{prop-integralstrictafffsup}
    Let $\varphi:B\rightarrow A$ be an integral $k$-algebra homomorphism of strictly $k$-affinoid algebras. Then for each non-zero $f\in A$, there is a moinc polynomial $q(f)=f^n+\varphi(b_1)f^{n-1}+\cdots+\varphi(b_n)$ of $f$ over $B$. Then 
    \[
        |f|_{\sup}=\max_{i=1,\ldots,n}|b_i|_{\sup}^{1/i}.  
    \]
\end{proposition}
\begin{proof}
    One side is simple: choose $j=1,\ldots,n$ that maximizes $|\varphi(b_j)f^{n-j}|_{\sup}$, then
    \[
        |f|_{\sup}^n=|f^n|_{\sup}\leq  |\varphi(b_j)f^{n-j}|_{\sup}\leq |b_j|_{\sup}\cdot |f|_{\sup}^{n-j}.
    \]
    So
    \[
        |f|_{\sup}\leq |b_j|_{\sup}^{1/j}.  
    \]

    To prove the reverse inequality, let us begin with the case where $A$ is an integral domain. 
    
    We claim that there is $d\in \mathbb{N}$ and a $k$-algebra homomorphism $\psi:k\{T_1,\ldots,T_d\}\rightarrow B$ such that $\varphi\circ \psi$ is integral and injective.  In fact, choosing an epimorphism $\alpha:k\{T_1,\ldots,T_d\}\rightarrow A$, we can apply \cref{thm-Noetheriannorm} to find $\phi\circ \alpha$ to conclude.

    By \cref{cor-rhofaithful}, if $p$ denotes the minimal polynomial of $f$ over $k\{T_1,\ldots,T_d\}$, we have $|f|_{\sup}=\sigma(p)$. In particular, $p(f)=0$. Let $q\in B[X]$ be the polynomial obtained from $p$ by replacing all coefficients by their $\psi$-images in $B$. Then clearly, $|f|_{\sup}=\sigma(q)$.

    In general, let $\mathfrak{p}_1,\ldots,\mathfrak{p}_r$ be the minimal primes in $A$. The number is finite by \cref{prop-strictnoetherian}. For each $i=1,\ldots,r$, let $\pi_i:A\rightarrow A/\mathfrak{p}_i$ denote the natural homomorphism. We know that there are monic polynomials $q_i\in B[X]$ such that $q_i(\pi(f))=0$ and $|\pi_i(f)|_{\sup}=\sigma(q_i)$ for $i=1,\ldots,r$. We let $q'=q_1\cdots q_r$. Then 
    \[
        q'(f)\in \bigcap_{i=1}^r\mathfrak{p}_i.
    \]
    So there is $e\in \mathbb{Z}_{>0}$ such that $q'(f)^e=0$. Let $q=q'^e$. By \cref{Banach-prop-sigmaproduct} in the chapter Banach Rings,
    \[
        \sigma(q)\leq  \max_{i=1,\ldots,r}\sigma(q_i) =\max_{i=1,\ldots,r} |\pi_i(f)|_{\sup}=|f|_{\sup}.
    \]
    The last equality follows from \cref{Banach-prop-supeqsp} in the chapter Banach Rings.
\end{proof}

\begin{lemma}\label{lma-tauinvkertildevarphi}
    Let $\varphi:B\rightarrow A$ be an admissible $k$-algebra homomorphism between strictly $k$-affinoid algebras. Let $\tau:\mathring{B}\rightarrow \tilde{B}$ be the reduction map, then
    \[
        \tau^{-1} (\ker\tilde{\varphi} )=\sqrt{\check{B}+\ker \mathring{\varphi}},\quad \ker\tilde{\varphi}=\sqrt{\tau(\ker \mathring{\varphi})}. 
    \]
\end{lemma}
\begin{proof}
    The second equation follows from the first one by applying $\tau$. Let us prove the first equation. By assumption, $\varphi(\check{B})$ is open in $\varphi(B)$. Consider $g\in \tau^{-1}(\ker\tilde{\varphi} )$, we know that
    \[
        \lim_{n\to\infty} \varphi(g)^n=0.  
    \]
    So $\varphi(g)^n\in \varphi(\check{B})$ for $n$ large enough, and hence $g^n\in \check{B}+\ker \mathring{\varphi}$.
\end{proof}

\begin{lemma}\label{lma-varphirestfinite}
    Let $m\in \mathbb{N}$ and $T=k\{T_1,\ldots,T_m\}$. Let $A$ be a $k$-affinoid algebra and $\varphi:T\{S_1,\ldots,S_n\}\rightarrow A$ be a finite morphism such that $\tilde{\varphi}(S_i)$ is integral over $\tilde{T}$. Then $\varphi|_T:T\rightarrow A$ is finite.
\end{lemma}
\begin{proof}
    We make an induction on $n$. When $n=0$, there is nothing to prove. So assume $n>0$ and the lemma has been proved for smaller values of $n$.

    Let $T'=T\{S_1,\ldots,S_n\}$. By assumption, there is a Weierstrass polynomial
    \[
        \omega=S_n^k+a_1S_n^{k-1}+\cdots+a_k\in \mathring{T}[S_n]  
    \]
    such that $\tilde{\omega}\in \ker\tilde{\varphi}$. As $\varphi$ is admissible by \cref{cor-finitehomoadmi}, we have $\omega^q\in \check{T'}+\ker \mathring{\varphi}$ for some $q\in \mathbb{Z}$ by \cref{lma-tauinvkertildevarphi}.

    In particular, we can find $r\in (T')^{\check{}}$ such that $g:=\omega^q-r\in \ker\mathring{\varphi}$. Observe that $g$ is $S_n$ distinguished of order $mq$ as $\tilde{g}=\tilde{\omega}^q$. By \cref{cor:quotientreplacedbyWeie}, the restriction of $\varphi$ to $T\{S_1,\ldots,S_{n-1}\}$ is finite. We can apply the inductive hypothesis to conclude.
\end{proof}

\begin{lemma}\label{lma-reductionfiniteimplyfinite}
    Let $\varphi:B\rightarrow A$ be a $k$-algebra homomorphism of strictly $k$-affinoid algebras. Assume that there exist affinoid generators $f_1,\ldots,f_n\in \mathring{A}$ of $A$ such that $\tilde{f}_1,\ldots,\tilde{f}_n$ are all integral over $\tilde{B}$, then $\varphi$ is finite.
\end{lemma}
\begin{proof}
    By assumption, we can find $s_i\in \mathbb{Z}_{>0}$, $b_{ij}\in \mathring{B}$ for $i=1,\ldots,n$, $j=1,\ldots,s_i$ such that
    \[
        \tilde{f}_i^{s_i}+\tilde{\varphi}(\tilde{b}_{i1}) \tilde{f}_i^{s_i-1}+\cdots+\tilde{\varphi}(\tilde{b}_{is_i})=0 
    \]
    for $i=1,\ldots,n$. Let $s=s_1+\cdots+s_n$ and define a bounded $k$-algebra homomorphism $\psi:D:=k\{T_{ij}\}\rightarrow B$ sending $T_{ij}$ to $b_{ij}$, for $i=1,\ldots,n$ and $j=1,\ldots,s_i$. Observe that $\tilde{f}_1,\ldots,\tilde{f}_n$ are all integral over $\tilde{D}$. So it suffices to prove the theorem when $B=k\{T_1,\ldots,T_m\}$. We extend $\varphi$ to a bounded $k$-algebra epimorphism $\varphi':T\{S_1,\ldots,S_n\}\rightarrow A$ sending $S_i$ to $f_i$ for $i=1,\ldots,n$.  Then $\tilde{\varphi'(S_i)}$ is integral over $\tilde{B}$. It suffices to apply \cref{lma-varphirestfinite}.
\end{proof}

\section{Properties of affinoid algebras}
Let $(k,|\bullet|)$ be a complete non-Archimedean valued field and $H$ be a subgroup of $\mathbb{R}_{>0}$ such that $|k^{\times}|\cdot H\neq \{1\}$.

\begin{proposition}\label{prop-powerbddinstrictlyaff}
    Assume that $k$ is non-trivially valued. Let $A$ be a strictly $k$-afifnoid algebra. Then
    \[
        \mathring{A}=\{f\in A: \rho(f)\leq 1\}=\{f\in A: |f|_{\sup}\leq 1\}.    
    \]
\end{proposition}
\begin{proof}
    By \cref{Banach-lma-supnormbddbyrho}, we have 
    \[
        \mathring{A}\subseteq \{f\in A: \rho(f)\leq 1\}\subseteq \{f\in A: |f|_{\sup}\leq 1\}. 
    \]
    Conversely, let $f\in A$, $|f|_{\sup}\leq 1$. Choose $d\in \mathbb{N}$ and a surjective $k$-algebra homomorphism
    \[
        \varphi:k\{T_1,\ldots,T_d\}\rightarrow A.  
    \]
    Let $f^n+t_1f^{n-1}+\cdots+t_n=0$ be the minimal equation of $f$ over $k\{T_1,\ldots,T_d\}$. Then $t_i\in (k\{T_1,\ldots,T_d\})^{\circ}$ by \cref{Banach-prop-fsupspecexp} in the chapter Banach Rings. An induction on $i\geq 0$ shows that
    \[
        f^{n+i}\in \sum_{j=0}^{n-1}\varphi\left((k\{T_1,\ldots,T_d\})^{\circ} \right)f^j.
    \]
    The right-hand side is clearly bounded.
\end{proof}


\begin{corollary}\label{cor-rhoequsup}
    Assume that $k$ is non-trivially valued.
    Let $(A,\|\bullet\|)$ be a strictly $k$-affinoid algebra. For any $f\in A$,
    \[
        \rho(f)=|f|_{\sup}.  
    \]
\end{corollary}
\begin{proof}
    We have shown that $\rho(f)\geq |f|_{\sup}$ in \cref{Banach-lma-supnormbddbyrho} from the chapter Banach Rings. 
    Assume tha tthe inverse inequality fails: for some $f\in A$,
    \[
        \rho(f)> |f|_{\sup}.
    \]
    If $|f|_{\sup}=0$, then $f$ lies in the Jacobson radical of $A$, which is equal to the nilradial of $A$ by \cref{prop-TateJacobson}. But then $\rho(f)=0$ as well. We may therefore assume that $|f|_{\sup}\neq 0$.
    By \cref{cor-strictlyaffsupnorm}, we may assume that $|f|_{\sup}=1$ as $\rho$ is power-multiplicative. Then $\rho(f)>1$. This contradicts \cref{prop-powerbddinstrictlyaff}.
\end{proof}

\begin{thm}\label{thm-affnoetherian}
A $k$-affinoid algebra $A$ is Noetherian and all ideals of $A$ are closed.  
\end{thm}
\begin{proof}
    Let $I$ be an ideal in $A$. 
    By \cref{prop-redtostrictlykaff}, we can take a suitable $r\in \mathbb{R}^m_{>0}$ so that $A\hat{\otimes} k_r$ is strictly $k_r$-affinoid. Then $I (A\hat{\otimes} k_r)$ is an ideal in $A\hat{\otimes} k_r$. By \cref{prop-strictnoetherian}, the latter ring is Noetherian. So we may take finitely many generators $f_1,\ldots,f_k\in I$. Each $f\in I$ can be written as 
    \[
        f=\sum_{i=1}^k f_i g_i  
    \]
    with $g_i=\sum_{j=-\infty}^{\infty}g_{i,j}T^j\in A\hat{\otimes} k_r$. But then 
    \[
        f=\sum_{i=1}^k f_i g_{i,0}.  
    \]
    So $I$ is finitely generated.

    As $I=A\cap (I (A\hat{\otimes} k_r))$, by \cref{Banach-cor-idealclosed} in the chapter Banach Rings, we see that $I$ is closed in $A\hat{\otimes} k_r$ and hence closed in $A$.
\end{proof}

\begin{proposition}\label{prop-fnnormbyrho}
    Let $(A,\|\bullet\|)$ be a $k$-affinoid algebra and $f\in A$. Then there is $C>0$ and $N\geq 1$ such that for any $n\geq N$, we have
    \[
        \|f^n\|\leq C\rho(f)^n.  
    \]
\end{proposition}
Recall that $\rho$ is the spectral radius map defined in \cref{Banach-def-spectralradius} in the chapter Banach Rings.
\begin{proof}
    By \cref{prop-Krfaithflat}, we may assume that $k$ is non-trivially valued and $k$ is non-trivially valued.
    
    If $\rho(f)=0$, then $f$ lies in each maximal ideal of $A$. To see this, we may assume that $A$ is a field, then by \cref{Banach-prop-Berkospecnonempty} in the chapter Banach Rings, there is a bounded valuation $\|\bullet\|'$ on $A$. But then $\rho(f)=0$ implies that $\|f\|'=0$ and hence $f=0$.

    It follows that if $\rho(f)=0$ then $f$ lies in $J(A)$, the Jacobson radical of $A$. By \cref{prop-TateJacobson}, $A$ is a Jacobson ring. So $f$ is nilpotent. The assertion follows.

    So we can assume that $\rho(f)>0$. In this case, by \cref{cor-noenormalization} and \cref{Banach-prop-fsupspecexp} in the chapter Banach Rings, we have $\rho(f)\in \sqrt{|k^{\times}|}$. Take $a\in k^{\times}$ and $d\in \mathbb{Z}_{>0}$ so that $\rho(f)^d=|a|$. Then $\rho(f^d/a)=1$ and hence it is powerly-bounded by \cref{prop-powerbddinstrictlyaff}. It follows that there is $C>0$ so that for $n\geq 1$, 
    \[
        \|f^{nd}\|\leq C |a|^n=C\rho(f)^{nd}. 
    \]
    It follows that $\|f^n\|\leq C\rho(f)$ for $n\geq d$ as long as we enlarge $C$.
\end{proof}


\begin{corollary}\label{cor-univpropTatenonstrict}
    Let $\varphi:A\rightarrow B$ be a bounded homomorphism of $k$-affinoid algebras. Let $n\in \mathbb{N}$ and  $f_1,\ldots,f_n\in B$ and $r_1,\ldots,r_n\in \mathbb{R}_{>0}$ with $r_i\geq \rho(f_i)$ for $i=1,\ldots,n$. Write $r=(r_1,\ldots,r_n)$, then there is a unique bounded homomorphism $\Phi:A\{r^{-1}T\}\rightarrow B$ extending $\varphi$ and sending $T_i$ to $f_i$.
\end{corollary}
\begin{proof}
    The uniqueness is clear. Let us consider the existence. Given 
    \[
        f=\sum_{\alpha\in \mathbb{N}^n} a_{\alpha}T^{\alpha}\in A\{r^{-1}T\}, 
    \]
    we define 
    \[
        \Phi(h)=\sum_{\alpha\in \mathbb{N}^n} \varphi(a_{\alpha})f^{\alpha}. 
    \]
    It follows from \cref{prop-fnnormbyrho} that the right-hand side the series converges. The boundedness of $\Phi$ is obvious.
\end{proof}



\begin{proposition}\label{prop-admissepiperturbation}
    Let $(A,\|\bullet\|_A),(B,\|\bullet\|_B)$ be $k$-affinoid algebras, $r \in \mathbb{R}_{>0}^n$ and $\varphi:A\{r^{-1}T\}\rightarrow B$ be an admissible epimorphism. Write $f_i=\varphi(T_i)$ for $i=1,\ldots,n$. Then there is $\epsilon>0$ such that for any $g=(g_1,\ldots,g_n)\in B^n$ with $\|f_i-g_i\|_{B}<\epsilon$ for all $i=1,\ldots,n$, there exists a unique bounded $k$-algebra homomorphism $\psi: A\{r^{-1}T\}\rightarrow B$ that coincides with $\varphi$ on $A$ and sends $T_i$ to $g_i$. Moreover, $\psi$ is also an admissible epimorphism.
\end{proposition}
\begin{proof}
    The uniqueness of $\psi$ is obvious. We prove the remaining assertions.
    Taking $\epsilon>0$ small enough, we could further guarantee that $\rho(g_i)\leq r_i$. It follows from \cref{cor-univpropTatenonstrict} that there exists a bounded homomorphism $\psi$ as in the statement of the proposition.

    As $\varphi$ is an admissible epimorphism, we may assume that $\|\bullet\|_B$ is the residue induced by $\|\bullet\|_{r}$ on $A\{r^{-1}T\}$.

    By definition of the residue norm, for any $\delta>0$ and any $h\in B$, we can find 
    \[
        k_0=\sum_{\alpha\in \mathbb{N}^n}a_{\alpha} T^{\alpha}\in A\{r^{-1}T\}  
    \]
    with
    \[
        \|a_{\alpha}\|_A r^{\alpha}\leq (1+\delta)\|h\|_B 
    \]
    for any $\alpha \in \mathbb{N}^n$. Choose $\epsilon\in (0, (1+\delta)^{-1})$. Now for $g_1,\ldots,g_n$ as in the statement of the proposition, we can write
    \[
        h=\sum_{\alpha\in \mathbb{N}^n}  a_{\alpha}f^{\alpha}=\sum_{\alpha\in \mathbb{N}^n}  a_{\alpha}g^{\alpha}+h_1=\psi(k_0)+h_1.
    \]
    It follows that
    \[
      \|h_1\|_B=\left\| \sum_{\alpha\in \mathbb{N}^n}  a_{\alpha}(f^{\alpha}-g^{\alpha})\right\|_B\leq (1+\delta)\epsilon \|h\|_B.
    \]
    Repeating this procedure, we can construct $k_i\in A\{r^{-1}T\}$ for $i\in \mathbb{N}$ and $h_j\in B$ for $j\in \mathbb{Z}_{>0}$ such that for any $i\in \mathbb{Z}_{>0}$, we have
    \[
        \begin{aligned}
        h=&\psi(k_0+\cdots+k_{i-1})+h_i,\\
        \|k_i\|_r\leq & ((1+\delta)\epsilon)^i(1+\delta)\|h\|_B,\\
         \|h_i\|_B\leq & ((1+\delta)\epsilon)^i\|h\|_B.
        \end{aligned}
    \]
    In particular, $k:=\sum_{i=0}^{\infty} k_i$ converges in $A\{r^{-1}T\}$ and
    \[
        \|k\|_r\leq (1+\delta)\|h\|_B.
    \]  
    It follows that $\psi$ is an admissible epimorphism.
\end{proof}

\begin{corollary}\label{cor-affkhann}
    Let $A$ be a Banach $k$-algebra, $n\in \mathbb{N}$ and $r=(r_1,\ldots,r_n)$ be a $k$-free polyray. Assume that $A\hat{\otimes}_k k_r$ is $k_r$-affinoid, then $A$ is $k$-affinoid.

    If $A\hat{\otimes}_k k_r$ is $k_H$-affinoid and $r\in H$, then $A$ is also $k_H$-affinoid. 
\end{corollary}
\begin{proof}
    We may assume that $r$ has only one component.

    Take $m\in \mathbb{N}$, $p_1,\ldots,p_m\in \mathbb{R}_{>0}$ and an admissible epimorphism
    \[
        \pi:k_r\{p_1^{-1}S_1,\ldots,p_{m}^{-1}S_m\}\rightarrow  A\hat{\otimes}_k k_r. 
    \]
    Let 
    \[
        \pi(S_i)=\sum_{j=-\infty}^{\infty} a_{i,j}T^j,\quad a_{i,j}\in A  
    \]
    for $i=1,\ldots,m$. By \cref{prop-admissepiperturbation}, we may assume that there is a large integer $l$ such that $a_{i,j}=0$ for $|j|>l$ and for any $i=1,\ldots,m$. We define $B=k\{p_i^{-1}r^jT_{i,j}\}$, $i=1,\ldots,n$ and $j=-l,-l+1,\ldots,l$. Let $\varphi:B\rightarrow A$ be the bounded $k$-algebra homomorphism sending $T_{i,j}$ to $a_{i,j}$. The existence of $\varphi$ is guaranteed by \cref{cor-univpropTatenonstrict}.

    We claim that $\varphi$ is an admissible epimorphism. It is clearly an epimorphism. Let us show that $\varphi$ is admissible. Let $\eta:k_r\{p_1^{-1}S_1,\ldots,p_{m}^{-1}S_m\}\rightarrow B\hat{\otimes}_k k_r$ be the bounded homomorphism sending $S_i$ to $\sum_{j=-l}^l T_{i,j}T^j$, then we have the following commutative diagram
    \[
        \begin{tikzcd}
            k_r\{p^{-1}S\} \arrow[rd, "\pi"] \arrow[d, "\eta"]           &                      \\
            B\hat{\otimes}_k k_r \arrow[r, "\varphi\hat{\otimes}_k k_r"] & A\hat{\otimes}_k k_r
        \end{tikzcd}  
    \]
    It follows that $\varphi\hat{\otimes}_k k_r$ is also an admissible epimorphism. By  \cref{prop-Krfaithflat}, $\varphi$ is also admissible.
\end{proof}


\section{\texorpdfstring{$H$}{H}-strict affinoid algebras}
Let $(k,|\bullet|)$ be a complete non-Archimedean valued field and $H$ be a subgroup of $R_{>0}$ such that $|k^{\times}|\cdot H\neq \{1\}$.


We next give a non-strict extension of \cref{prop-strictlykafffinite}.
\begin{proposition}\label{prop-strictlykafffinite2}
    Let $B$ be a $k_H$-affinoid algebra and $\varphi:B\rightarrow A$ be a finite bounded homomorphism into a $k$-Banach algebra $A$. Then $A$ is also $k_H$-affinoid.
\end{proposition}
\begin{proof}
    We first assume that $k$ is non-trivially valued.

    We may assume that $B=k\{r_1^{-1}T_1,\ldots,r_n^{-1}T_n\}$ for some $n\in \mathbb{N}$ and $r_1,\ldots,r_n\in H$.
    By assumption, we can find finitely many $a_1,\ldots,a_m\in A$ such that $A=\sum_{i=1}^m \varphi(B)a_i$.

    We may assume that $a_i\in \mathring{A}$ as $k$ is non-trivially valued. By \cref{Banach-prop-Tateunivprop} in the chapter Banach Rings, $\varphi$ admits a unique extension to a bounded $k$-algebra epimorphism 
    \[
        \Phi:  k\{r_1^{-1}T_1,\ldots,r_n^{-1}T_n,S_1,\ldots,S_m\}\rightarrow A
    \]
    sending $S_i$ to $a_i$. By \cref{Banach-cor-bddisadmi} in the chapter Banach Rings, $\Phi$ is admissible. Moreover, the homomorphism $\Phi$ is surjective by our assumption. It follows that $A$ is $k_H$-affinoid.

    If $k$ is trivially valued, then $H$ is non-trivial.
    Take $s\in H \setminus \{1\}$. It follows from the previous case applied to  $\varphi\hat{\otimes}k_s:B \hat{\otimes}k_s\rightarrow A \hat{\otimes}k_s$ that $A \hat{\otimes}k_s$ is $k_H$-affinoid. By \cref{cor-affkhann}, $A$ is also $k_H$-affinoid. 
\end{proof}


\begin{proposition}\label{prop-affkhchar1}
    Let $A$ be a Banach $k$-algebra. Then the following are equivalent:
    \begin{enumerate}
        \item $A$ is $k_H$-affinoid;
        \item there are $n\in \mathbb{N}$, $r\in \sqrt{|k^{\times}|\cdot H}$ and an admissible epimorphism $k\{r^{-1}T\}\rightarrow A$.
    \end{enumerate}
\end{proposition}
\begin{proof}
    The non-trivial direction is (2). Assume (2).
    Take $s_1,\ldots,s_n\in \mathbb{Z}_{>0}$, $c_1,\ldots,c_n\in k^{\times}$ and $h_1,\ldots,h_n\in H$ such that
    \[
        r_i^{s_i}=|c_i^{-1}|h_i  
    \]
    for $i=1,\ldots,n$. We define a bounded $k$-algebra homomorphism
    \[
        \varphi:k\{h_1^{-1}T_1,\ldots,h_n^{-1}T_n\}\rightarrow k\{r_1^{-1}T_1,\ldots,r_n^{-1}T_n\}  
    \]
    by sending $T_i$ to $c_i T_i^{s_i}$. The existence of such a homomorphism is guaranteed by \cref{cor-univpropTatenonstrict}. The same proof of \cref{lma-tatestrictaff} shows that $\varphi$ is finite. By \cref{prop-strictlykafffinite2}, $k\{r_1^{-1}T_1,\ldots,r_n^{-1}T_n\}  $ is $k_H$-affinoid.
\end{proof}


\begin{lemma}\label{lma-strictlykaffintermsofrho}
    Assume that $k$ is non-trivially valued.
    Let $A$ be a $k$-affinoid algebra. Then the following are equivalent:
    \begin{enumerate}
        \item $A$ is strictly $k$-affinoid;
        \item for any $a\in A$, $\rho(a)\in \sqrt{|k^{\times}|}\cup\{0\}$.
    \end{enumerate}
\end{lemma}
\begin{proof}
    (1) $\implies$ (2) by \cref{cor-strictlyaffsupnorm} and \cref{cor-rhoequsup}.

    (2) $\implies$ (1): Take $n\in \mathbb{N}$, $r\in \mathbb{R}^n_{>0}$ and  an admissible epimorphism 
    \[
        \varphi:k\{r^{-1}T\}\rightarrow A.  
    \]
    Let $f_i=\varphi(T_i)$ for $i=1,\ldots,n$. Suppose $r_1,\ldots,r_m\not\in \sqrt{|k^{\times}|}$ and $r_{m+1},\ldots,r_n\in \sqrt{|k^{\times}|}$. Then $\rho(f_i)<r_i$ for $i=1,\ldots,m$ and we can choose $r_1',\ldots,r_m'\in \sqrt{|k^{\times}|}$ such that 
    \[
        \rho(f_i)\leq r'_i<r_i
    \]
    for $i=1,\ldots,m$. Set $r'_i=r_i$ when $i=m+1,\ldots,n$. We can then define a bounded $k$-algebra homomorphism $\psi:k\{r'^{-1}T\}\rightarrow A$ sending $T_i$ to $f_i$ for $i=1,\ldots,n$. The existence of $\psi$ is guaranteed by \cref{cor-univpropTatenonstrict}. Observe that $\psi$ is surjective and admissible. It follows that $A$ is strictly $k$-affinoid.
\end{proof}

\begin{thm}\label{thm-strictaffdfnequal}
    Let $A$ be a $k$-affinoid algebra. Then the following are equivalent:
    \begin{enumerate}
        \item $A$ is $k_H$-affinoid;
        \item $A$ is $k_{\sqrt{|k^{\times}|\cdot H}}$-affinoid;
        \item For any non-zero $a\in A$, $\rho(a)\in \sqrt{|k^{\times}|\cdot H}\cup\{0\}$.
    \end{enumerate}
\end{thm}
\begin{proof}
    The equivalence between (1) and (2) follows from \cref{prop-affkhchar1}.

    (1) $\implies$ (3): we may assume that $H\supseteq |k^{\times}|$. Take $n\in \mathbb{N}$, $r=(r_1,\ldots,r_n)\in H^n$ and an admissible epimorphism 
    \[
        \varphi:k\{r^{-1}T\} \rightarrow A. 
    \]
    Take a $k$-free polyray $s$ with at least one component so that $|k_s|\supseteq \{r_1,\ldots,r_n\}$. We can apply \cref{lma-strictlykaffintermsofrho} to $\varphi\hat{\otimes}_k k_s$, it follows that $\rho(A)\subseteq \sqrt{|k_s^{\times}|}\cup \{0\}$.

    (3) $\implies$ (2): we may assume that $H\supseteq |k^{\times}|$. It suffices to apply the same argument as (2) $\implies$ (1) in the proof of \cref{lma-strictlykaffintermsofrho}.

\end{proof}


\section{Finite modules over affinoid algebras}
Let $(k,|\bullet|)$ be a complete non-Archimedean valued field. 

For any $k$-affinoid algebra $A$, we have defined the category $\BanCat_A^f$ of finite Banach $A$-modules in \cref{Banach-def-finiteBanachmodules} in the chapter Banach Rings. We write $\ModCat_A^f$ for the category of finite $A$-modules. 

\begin{lemma}\label{lma-finiteBanachmodulemapbdd}
    Let $A$ be a $k$-affinoid algebra, $(M,\|\bullet\|_M)$ be a finite Banach $A$-module and $(N,\|\bullet\|_N)$ be a Banach $A$-module $N$.
    Let $\varphi:M\rightarrow N$ be an $A$-linear homomorphism. Then $\varphi$ is bounded.
\end{lemma}
\begin{proof}
    Take $n\in \mathbb{N}$ such that there is an admissible epimorphism 
    \[
        \pi:A^n\rightarrow M.  
    \]   
    It suffices to show that $\varphi\circ\pi$ is bounded. So we may assume that $M=A^n$. For $i=1,\ldots,n$, let $e_i$ be the vector with $(0,\ldots,0,1,0,\ldots,0)$ of $A^n$ with $1$ placed at the $i$-th place.
    Set $C=\max_{i=1,\ldots,n} \|\varphi(e_i)\|_N$. For a general $f=\sum_{i=1}^n a_i e_i$ with $a_i\in A$, we have
    \[
        \|\varphi(f)\|_N\leq C\|f\|_M.
    \]
    So $\varphi$ is bounded.
\end{proof}

\begin{proposition}\label{prop-finteBanachAmoduleequivfinitemodule}
    Let $A$ be a $k$-affinoid algebra. 
    The forgetful functor $\BanCat_A^f\rightarrow \ModCat_A^f$ is an equivalence of categories.
\end{proposition}

\begin{proof}
    It suffices to construct the inverse functor. Let $M$ be a finite $A$-module. Choose $n\in \mathbb{N}$ and an $A$-linear epimorphism $\pi:A^n\rightarrow M$. By \cref{thm-affnoetherian}, $\ker \pi$ is closed in $A^n$. We can endow $M$ with the residue norm. By \cref{lma-finiteBanachmodulemapbdd}, the equivalence class of the norm does not depend on the choice of $\pi$.

    For any $A$-linear homomorphism $f:M\rightarrow N$ of finite $A$-modules, we endow $M$ and $N$ with the Banach structures as above. It follows from \cref{lma-finiteBanachmodulemapbdd} that $f$ is bounded. We have defined the inverse functor of the forgetful functor  $\BanCat_A^f\rightarrow \ModCat_A^f$.
\end{proof}
\begin{remark}Let $A$ be a $k$-affinoid algebra. 
    It is not true that a Banach $A$-module which is finite as $A$-module is finite as Banach $A$-module. 

    As an example, take $0<p<q<1$ and $A=k\{q^{-1}T\}$, $B=k\{p^{-1}T\}$. Then $B$ is a Banach $A$-module.
    By \cref{ex-trivvaluedaff}, the underlying rings of $A$ and $B$ are both $k[[T]]$. So the canonical map $A\rightarrow B$ is bijective. But $B$ is not a finite $A$-module. As otherwise, the inverse map $B\rightarrow A$ is bounded by \cref{lma-finiteBanachmodulemapbdd}, which is not the case.

    The correct statement is the following: consider a Banach $A$-module $(M,\|\bullet\|_M)$ which is finite as $A$-module, then there is a norm on $M$ such that $M$ becomes a finite Banach $A$-module. The new norm is not necessarily equivalent to the given norm $\|\bullet\|_M$.
\end{remark}


\begin{proposition}\label{prop-finiteBanachtensor}
    Let $A$ be a $k$-affinoid algebra and $M,N$ be finite Banach $A$-modules. Then the natural map
    \[
        M\otimes_A N\rightarrow M\hat{\otimes}_A N
    \]
    is an isomorphism of Banach $A$-modules
    and $M\hat{\otimes}_A N$ is a finite Banach $A$-module.
\end{proposition}
Here the Banach $A$-module structure on $M\otimes_A N$ is given by \cref{prop-finteBanachAmoduleequivfinitemodule}.
\begin{proof}
    Choose $m,m'\in \mathbb{N}$ an admissibly coexact sequence
    \[
        A^{m'}\rightarrow A^m \rightarrow M\rightarrow 0  
    \]
    of Banach $A$-modules. Then we have a commutative diagram of $A$-modules:
    \[
        \begin{tikzcd}
            A^{m'}\otimes_A N \arrow[r] \arrow[d] & A^{m}\otimes_A N \arrow[r] \arrow[d] & M\otimes_A N \arrow[r] \arrow[d] & 0 \\
            A^{m'}\hat{\otimes}_A N \arrow[r]     & A^{m}\hat{\otimes}_A N \arrow[r]     & M\hat{\otimes}_A N \arrow[r]     & 0
        \end{tikzcd}  
    \]
    with exact rows. By $5$-lemma, in order to prove $M\otimes_A N\cn M\hat{\otimes}_A N$ and $M\hat{\otimes}_A N$ is a finite Banach $A$-module, we may assume that $M=A^m$ for some $m\in \mathbb{N}$. Similarly, we can assume $N=A^n$ for some $n\in \mathbb{N}$. In this case, the isomorphism is immediate and $M\hat{\otimes}_A N$ is clearly a finite Banach $A$-module. By \cref{lma-finiteBanachmodulemapbdd}, the Banach $A$-module structure on $M\hat{\otimes}_A N$ coincides with the Banach $A$-module strucutre on $M\otimes_A N$ induced by \cref{prop-finteBanachAmoduleequivfinitemodule}.
\end{proof}

\begin{proposition}\label{prop-finitemodulebasechange}
    Let $A$, $B$ be a $k$-affinoid algebra and $A\rightarrow B$ be a bounded $k$-algebra homomorphism. Let $M$ be a finite Banach $A$-module, then the natural map
    \[
        M\otimes_A B\rightarrow M\hat{\otimes}_A B  
    \]
    is an isomorphism of Banach $B$-modules and $M\hat{\otimes}_A B $ is a finite Banach $B$-module. 
\end{proposition}
\begin{proof}
    By the same argument as \cref{prop-finiteBanachtensor}, we may assume that $M=A^n$ for some $n\in \mathbb{N}$. In this case, the assertions are trivial.
\end{proof}

\begin{proposition}\label{prop-finitemodulemapadmi}
    Let $A$ be a $k$-affinoid algebra and $M,N$ be finite Banach $A$-modules. Let $\varphi:M\rightarrow N$ be an $A$-linear map. Then $\varphi$ is admissible.
\end{proposition}
\begin{proof}
    By \cref{lma-finiteBanachmodulemapbdd}, $\varphi$ is always bounded.
    By \cref{prop-finitemodulebasechange} and \cref{prop-Krfaithflat}, we may assume that $k$ is non-trivially valued. By \cref{thm-affnoetherian}, $N$ is a Noetherian $A$-module. It follows from \cref{Banach-cor-idealclosed} in the chapter Banach Rings that $\Img \varphi$ is closed in $N$ and is finite as an $A$ module. In particular, the norm induced from $N$ and from $M$ are equivalent by \cref{lma-finiteBanachmodulemapbdd}. It follows that $\varphi$ is admissible.
\end{proof}

\begin{proposition}\label{prop-finitenessdescent1}
    Let $A$ be a $k$-affinoid algebra. Let $n\in \mathbb{N}$ and $r=(r_1,\ldots,r_n)$ be a $k$-free polyray. Then $M$ is a finite Banach $A$-module if and only if $M\hat{\otimes}_k k_r$ is a finite Banach $A\hat{\otimes}_k k_r$-module.
\end{proposition}
\begin{proof}
    We may assume that $r$ has only one component and write $r_1=r$. The direct implication is trivial. Let us assume that $M\hat{\otimes}_k k_r$ is a finite Banach $A\hat{\otimes}_k k_r$-module. Take $n\in \mathbb{N}$ and an admissible epimorphism of $A\hat{\otimes}_k k_r$-modules
    \[
        \varphi:  (A\hat{\otimes}_k k_r)^n\rightarrow M\hat{\otimes}_k k_r.
    \]
    Let $e_1,\ldots,e_n$ denotes the standard basis of $(A\hat{\otimes}_k k_r)^n$. We expand
    \[
        \varphi(e_i)=\sum_{j=-\infty}^{\infty} m_{i,j}T^j.  
    \]
    By \cref{prop-admissepiperturbation}, we can assume that there is $l>0$ such that $m_{i,j}=0$ for all $i=1,\ldots,n$ and $|j|>l$. It follows that 
    \[
        A^{n(2l+1)}\rightarrow M  
    \]
    sending the standard basis to $m_{i,j}$ with $i=1,\ldots,n$ and $j=-l,-l+1,\ldots,l$ is an admissible epimorphism.
\end{proof}


\begin{proposition}\label{prop-finiteadmissibledesc}
    Let $\phi:A\rightarrow B$ be a morphism of $k$-affinoid algebras, $n\in \mathbb{N}$ and $r\in \mathbb{R}^n_{>0}$. Then the following are equivalent:
    \begin{enumerate}
        \item $\phi$ is finite and admissible.
        \item $\phi\hat{\otimes}_k k_r$ is finite and admissible.
    \end{enumerate}
\end{proposition}
This is \cite[Lemma~3.2]{Tem04}. I do not understand Temkin's argument. The following proof is a modification of the argument of Temkin's.
\begin{proof}
    (1) $\implies$ (2): This is straightforward.

    (2) $\implies$ (1): The admissible part is straightforward. Let us prove that $\phi$ is finite. We may assume that $n=1$. When $r$ is not in $\sqrt{|k^{\times}|}$, we just apply \cref{prop-finitenessdescent1}. Now suppose $r\in\sqrt{|k^{\times}|}$. 
    Let us take $m\in \mathbb{Z}_{>0}$ such that $r^m=|c^{-1}|$ for some $c\in k^{\times}$. Define a bounded $k$-algebra homomorphism
    \[
        \varphi:k\{T\}\rightarrow k\{r^{-1} T\}
    \]
    sending $T$ to $cT^m$. Observe that $\varphi$ is injective.
    We have argued in the proof of \cref{lma-tatestrictaff} that this homomorphism is finite. 

    Then $\varphi$ induces a finite extension of ring $\Frac  k\{r^{-1} T\}/\Frac k\{T\}$. In particular, the closure of $\Frac k\{T\}$ in $k_r$ is a subfield over which $k_r$ is finite. 
    But this valuation field is isomorphic to $k\{T\}$. By \cref{prop-finitemodulebasechange} and fpqc descent \cite[\href{https://stacks.math.columbia.edu/tag/02LA}{Tag 02LA}]{stacks-project}, we may assume that $r=1$.

    Recall that $k_1$ is the completion of $\Frac k\{T\}$.
    Let $\{\tilde{f}_i\}_{i\in I}$ be the set of irreducible monic polynomials in $\tilde{k}[T]$. Lift each $\tilde{f}_i$ to $f_i\in \mathring{k}[T]$. Let $a\in A\hat{\otimes}_k k_1$, we represent $a$ as
    \[
        a=\sum_{l=0}^{\infty} a_l T^l+\sum_{i\in I, j\geq 1,0\leq k<\deg f_i}a_{ijk}T^k/f_i^j.
    \]
    A similar expression exists for elements in $B\hat{\otimes}_k k_1$ as well. Moreover, the representation is unique.

    As $B\hat{\otimes}_k k_1$ is finite over $A\hat{\otimes}_k k_1$, we can find $b_1,\ldots,b_m$ such that any $b\in B$ can be written as
    \[
        b=\sum_{j=1}^m \phi\hat{\otimes}_k k_1(a_j) b_j,
    \]
    where $a_j\in A\hat{\otimes}_k k'$. We can replace $b_j$ by $b_{j,0}$ and $a_j$ by $a_{j,0}$. It follows that $B$ is generated $b_{1,0},\ldots,b_{m,0}$ over $A$.
\end{proof}

For any ring $A$, $\AlgCat_A^f$ denotes the category of finitely generated $A$-algebras.

\begin{proposition}\label{prop-Banachalgebrafiniteforget}
    Let $A$ be a $k$-affinoid algebra. Then the forgetful functor $\BanAlgCat_A^f\rightarrow \AlgCat_A^f$ is an equivalence of categories.
\end{proposition}
Recall that $\BanAlgCat_A^f$ is defined in \cref{Banach-def-finiteBanachalgebra} in the chapter Banach Rings.
\begin{proof}
    It suffices to construct an inverse functor. Let $B$ be a finite $A$-algebra. 
    We endow $B$ with the norm $\|\bullet\|_B$ as in \cref{prop-finteBanachAmoduleequivfinitemodule}. We claim that $B$ is a Banach $A$-algebra.

    Let us recall the definition of the norm.
    Take $n\in \mathbb{N}$, an epimorphism $\varphi:A^n\rightarrow B$ of $A$-modules. Then $\|\bullet\|_B$ is the residue norm induced by $\varphi$.

    Consider the $A$-linear epimorphism $\psi:A^n\otimes_A A^n\rightarrow B\otimes_A B$. By \cref{prop-finitemodulemapadmi}, when both sides are endowed with the norms $\|\bullet\|_{A^n\otimes_A A^n}$ and $\|\bullet\|_{B\otimes_A B}$ as in \cref{prop-finteBanachAmoduleequivfinitemodule}, $\psi$ is admissible. It follows that there is $C>0$ such that for any $f,g\in B$,
    \[
        \|f\otimes g\|_{B\otimes B}\leq C\|f\|_B \cdot\|g\|_B.  
    \]
    On the other hand, by \cref{prop-finteBanachAmoduleequivfinitemodule}, the natural map $B\otimes_A B\rightarrow B$ is bounded. It follows that there is a constant $C'>0$ such that
    \[
        \|fg\|_B\leq C'\|f\otimes g\|_{B\otimes B}.
    \]
    It follows that the multiplication in $B$ is bounded and hence $B$ is a finite Banach algebra. Given any morphism $B\rightarrow B'$ in $\AlgCat_A^f$, we endow $B$ and $B'$ with the norms given by \cref{prop-finteBanachAmoduleequivfinitemodule}. It follows from \cref{lma-finiteBanachmodulemapbdd} that $B\rightarrow B'$ is a bounded homomorphism of finite Banach $A$-algebras. So we have defined an inverse functor to the forgetful functor $\BanAlgCat_A^f\rightarrow \AlgCat_A^f$.
\end{proof}
\begin{remark}
    It is not true that any homomorphism of $k$-affinoid algebras is bounded. For example, if the valuation on $k$ is trivial. Take $0<p<q<1$ and consider the natural homomorphism $k_p\rightarrow k_q$. This homomorphism is bijective but not bounded.
\end{remark}


\section{Affinoid domains}
Let $(k,|\bullet|)$ be a complete non-Archimedean valued field and $H$ be a subgroup of $\mathbb{R}_{>0}$ such that $|k^{\times}|\cdot H\neq \{1\}$.

\begin{definition}\label{def-affinoiddomain}
    Let $A$ be a $k_H$-affinoid algebra. A closed subset $V\subseteq \Sp A$ is said to be a \emph{$k_H$-affinoid domain} in $X$ if there is an object $\Sp A_V\in k_H\text{-}\AffCat$ and a morphism $\phi:\Sp A_V\rightarrow \Sp A$ in $k_H\text{-}\AffCat$ such that
    \begin{enumerate}
        \item the image of $\phi$ in $\Sp A$ is $V$;
        \item given any object $\Sp B\in k_H\text{-}\AffCat$ and a morphism $\Sp B\rightarrow \Sp A$ whose image lies in $V$, there is a unique morphism $\Sp B\rightarrow \Sp A$ in $k_H\text{-}\AffCat$ such that the following diagram commutes
        \[
            \begin{tikzcd}
                \Sp B \arrow[d, "!", dotted] \arrow[rd] &       \\
                \Sp A_V \arrow[r, "\phi"]               & \Sp A
            \end{tikzcd}    
        \]
    \end{enumerate}

    We say $V$ is \emph{represented by} the morphism $\phi$ or by the corresponding morphism $A\rightarrow A_V$.

    When $H=\mathbb{R}_{>0}$, we say $V$ is a \emph{$k$-affinoid domain} in $X$. When $H=|k^{\times}|$, we say $V$ is a \emph{strict $k$-affinoid domain} in $X$.
\end{definition}
We observe that $A_V$ is canonically determined by the universal property.
\begin{remark}
    This definition differs from the original definition of \cite{Berk12}, we follow the approach of Temkin instead. It can be shown that this definition is equivalent to the orignal definition of Berkovich when $H=\mathbb{R}_{>0}$.
\end{remark}
A priori, this does not seem to be a good definition, as it is not easy to see that it is preserved by base field extension. But we will prove that it is the case after establishing the Gerritzen--Grauert theorem.

We begin with a few examples.
\begin{example}\label{ex-Laurentdomain}
    Let $A$ be a $k_H$-affinoid domain.
    Let $n,m\in \mathbb{N}$ and $f=(f_1,\ldots,f_n)\in A^n$, $g=(g_1,\ldots,g_m)\in A^m$. Let $r=(r_1,\ldots,r_n)\in\sqrt{|k^{\times}|\cdot H}^n$ and $s=(s_1,\ldots,s_m)\in \sqrt{|k^{\times}|\cdot H}^m$. We define
    \[
        (\Sp A)\left\{r^{-1}f,sg^{-1}\right\}:=\left\{x\in \Sp A: |f_i(x)|\leq r_i, |g_j(x)|\geq s_j, 1\leq i\leq n, 1\leq j\leq m\right\}.  
    \]
    We claim that $\Sp A\left\{r^{-1}f,sg^{-1}\right\}$ is a $k_H$-affinoid domain in $\Sp A$. These domains are called \emph{$k_H$-Laurent domains} in $\Sp A$. When $m=0$, the domains $\Sp A\{r^{-1}f\}$ are called \emph{$k_H$-Weierstrass domains} in $\Sp A$.

    To see this, we define
    \[
        A\left\{r^{-1}f,sg^{-1}\right\}:=A\{r^{-1}T,sS\}/(T_1-f_1,\ldots,T_n-f_n,g_1S_1-1,\ldots,g_mS_m-1).
    \]
    By \cref{thm-affnoetherian}, this defines a Banach $k$-algebra structure.
    We write $\|\bullet\|'$ for the quotient norm.
    By definition, $A\left\{r^{-1}f,sg^{-1}\right\}$ is a $k_H$-affinoid algebra and there is a natural morphism $A\rightarrow A\left\{r^{-1}f,sg^{-1}\right\}$. We claim that this morphism represents $\Sp A\left\{r^{-1}f,sg^{-1}\right\}$.

    For this purpose, we first compute $\Sp A\left\{r^{-1}f,sg^{-1}\right\}$. We observe that $\Sp A\left\{r^{-1}f,sg^{-1}\right\}\rightarrow \Sp A$ is injective since
    $A[f,g^{-1}]$ is dense in $A\left\{r^{-1}f,sg^{-1}\right\}$. We will therefore identify $\Sp A\left\{r^{-1}f,sg^{-1}\right\}$ with a subset of $\Sp A$. 
    
    Next we show that the image of $\Sp A\left\{r^{-1}f,sg^{-1}\right\}$ in $\Sp A$ is contained in $(\Sp A)\left\{r^{-1}f,sg^{-1}\right\}$. Take $\|\bullet\|\in \Sp A\left\{r^{-1}f,sg^{-1}\right\}$. Then there is a constant $C>0$ such that
    \[
        \|\bullet\|\leq C\|\bullet\|'.  
    \]
    Applying this to $f^k_i$ for some $k\in \mathbb{Z}_{>0}$ and $i=1,\ldots,n$, we find that
    \[
        \|f_i\|^k=\|f_i^k\|\leq C\|f_i^k\|'\leq C\|T_i^i\|_{r,s^{-1}}= Cr_i^{k}.  
    \]
    It follows that 
    \[
        \|f_i\|\leq r_i.
    \]
    Similarly, we deduce $|g_j|\geq s_j$ for $j=1,\ldots,m$. Namely, $\|\bullet\|\in (\Sp A)\left\{r^{-1}f,sg^{-1}\right\}$.


    Next we verify the universal property: let $\Sp B\rightarrow \Sp A$ be a morphism of $k_H$-affinoid domains that factorizes through $(\Sp A)\left\{r^{-1}f,sg^{-1}\right\}$. We write $\psi:A\rightarrow B$ for the corresponding morphism of $k_H$-affinoid algebras.
    By \cref{Banach-cor-rhoequsup} in the chapter Banach Rings, we have
    \[
        \rho_B(f_i)=\sup_{x\in \Sp B}|f_i(x)|\leq \sup_{y\in (\Sp A)\left\{r^{-1}f,sg^{-1}\right\}} |f_i(y)|\leq r_i
    \]   
    for $i=1,\ldots,n$. Similarly, one deduces that $\rho(g_j)\leq s_j^{-1}$ for $j=1,\ldots,m$.
    
    We will construct the dotted arrows: 
    \[
        \begin{tikzcd}
            A \arrow[r, "\psi"] \arrow[d]                  & B \\
            {A\{r^{-1}T,sS\}} \arrow[d] \arrow[ru, dotted,"\eta"] &   \\
            {A\{r^{-1}f,sg\}} \arrow[ruu, dotted, "\tau"]          &  
        \end{tikzcd}
    \]
    so that this diagram commutes. We define $\eta$ as the unique morphism sending $T_i$ to $f_i$ and $S_j$ to $g_j$ for  $i=1,\ldots,n$, $j=1,\ldots,m$. The existence of such a morphism is guaranteed by \cref{cor-univpropTatenonstrict}. In order to descend this morphism to $\eta'$, it suffices to show that $T_i-f_i$ and $g_jS_j-1$ for $i=1,\ldots,n$ and $j=1,\ldots,m$ lie in the kernel of $\eta$. But this is immediate from our definition. Moreover, it is clear that $\eta'$ is necessarily unique.

    It remains to show that each point in $(\Sp A)\left\{r^{-1}f,sg^{-1}\right\}$ lies in $\Sp A\left\{r^{-1}f,sg^{-1}\right\}$. 
    
    It suffices to treat the cases $(n,m)=(1,0)$ and $(n,m)=(0,1)$. We will only handle the former case, as the latter is similar. In concrete terms, we need to show that for any $x\in \Sp A$ corresponding to a bounded semi-valuation $|\bullet|_x$ on $A$ satisfying $|f(x)|\leq r$, we can always extend $|\bullet|_x$ to a bounded semi-valuation $\|\bullet\|$ on $A\{r^{-1}f\}$.
    Replacing $A$ by $A/\ker |\bullet|_x$, we may assume that $|\bullet|_x$ is a valuation on $A$. We endow $A\{r^{-1}T\}$ with the Gauss norm $\|\bullet\|_{x,r}$ induced by $|\bullet|_x$ and $A\{r^{-1}T\}$ with the quotient norm $\|\bullet\|$. This norm is bounded by construction. It suffices to show that it is a valuation and it extends the given valuation on $A$. The former is a consequence of the latter, as $A$ is dense in $A\{r^{-1}f\}$. Now suppose $a\in A$. A general preimage of $a$ in $A\{r^{-1}T\}$ is 
    \[
        a+(T-f)\sum_{j=0}^{\infty}b_j T^j=  a-fb_0+\sum_{j=1}^{\infty} (b_{j-1}-fb_j)T^j
    \] 
    with $\|b_j\|_A r^j\to 0$ as $j\to\infty$. Now we compute
    \[
        \begin{aligned}
          \|a-fb_j+\sum_{j=1}^{\infty} (b_{j-1}-fb_j)\|_{x,r}=&\max \left\{|a-fb_0|_x, \max_{j\geq 1}|b_{j-1}-fb_j|_x r^j \right\}\\
          \geq & \max \left\{|a-fb_0|_x, \max_{j\geq 1}|b_{j-1}-fb_j|_x |f|_x^j \right\}\\
          =& \max \left\{|a-fb_0|_x, \max_{j\geq 1}|f^jb_{j-1}-f^{j+1}b_j|_x\right\}
          \geq & |a|_x.
        \end{aligned}
    \]
    So $\|a\|\geq |a|_x$. The reverse inequality is trivial. We conclude.
\end{example}

\begin{example}\label{ex-rationaldomains}
    Let $A$ be a $k_H$-affinoid domain. Let $n\in \mathbb{N}$, $g\in A$, $f=(f_1,\ldots,f_n)\in A^n$, $r=(r_1,\ldots,r_n)\in \sqrt{|k^{\times}|\cdot H}^n$. Assume that $g,f_1,\ldots,f_n$ generates the unit ideal. Define
    \[
        (\Sp A)\left\{r^{-1}\frac{f}{g}\right\}=\left\{ x\in \Sp A: |f_i(x)|\leq r_i|g(x)|\text{ for }i=1,\ldots,n \right\}.  
    \]
    Then we claim that $(\Sp A)\left\{r^{-1}\frac{f}{g}\right\}$ is a $k_H$-affinoid domain in $\Sp A$. Domains of this form are called \emph{$k_H$-rational domains}.

    To see this, we define
    \[
        A\left\{r^{-1}\frac{f}{g}\right\}:=A\{r^{-1}T\}/(gT_1-f_1,\ldots,gT_n-f_n).
    \]
    By \cref{thm-Noetheriannorm}, this is indeed a $k_H$-affinoid domain. We will denote by $\|\bullet\|'$ the residue norm. We will prove that the natural map $A\rightarrow A\left\{r^{-1}\frac{f}{g}\right\}$ represents the affinoid domain $(\Sp A)\left\{r^{-1}\frac{f}{g}\right\}$. Observe that 
    \[
        \Sp A\left\{r^{-1}\frac{f}{g}\right\}
    \]
    is injective as elemnts of the form $a/g$ with $a\in A$ is dense in $A\left\{r^{-1}\frac{f}{g}\right\}$. Next we show that
    \[
        (\Sp A)\left\{r^{-1}\frac{f}{g}\right\}\supseteq \Sp A\left\{r^{-1}\frac{f}{g}\right\}.
    \]
    Let $x\in \Sp A\left\{r^{-1}\frac{f}{g}\right\}$, take $|\bullet|_x$ as the correspoding bounded semi-valuation on $A\left\{r^{-1}\frac{f}{g}\right\}$. Then there is a constant $C>0$ such that for any $k\in \mathbb{Z}_{>0}$,
    \[
        |f_i|_x^k=|f_i^k|_x=|g|_x^k \cdot |T_i^k|_x
        \leq C|g|_x^k r_i^k.
    \]
    for all $i=1,\ldots,n$. In particular,
    \[
        |f_i|_x\leq r_i|g|_x.  
    \]
    Hence, $x\in (\Sp A)\left\{r^{-1}\frac{f}{g}\right\}$.

    Next we verify the universal property. Let $\Sp B\rightarrow \Sp A$ be a morphism of $k_H$-affinoid spectra factorizing through $(\Sp A)\left\{r^{-1}\frac{f}{g}\right\}$. 
    Observe that $g(x)\neq 0$ for all $x\in (\Sp A)\left\{r^{-1}\frac{f}{g}\right\}$. As otherwise, $f_i(x)=0$ for all $i=1,\ldots,n$. This contradicts our assumption on $g,f_1,\ldots,f_n$.
    It follows that $\psi(g)$ is invertible by \cref{Banach-cor-invertibleintermsofsp} int the chapter Banach Rings. From the definition of $(\Sp A)\left\{r^{-1}\frac{f}{g}\right\}$, it is clear that $\rho(\psi(f_i))\leq r\rho(\psi(g))$ for $i=1,\ldots,n$.
    
    We construct 
    \[
        \begin{tikzcd}
            A \arrow[r, "\psi"] \arrow[d]                  & B \\
            {A\{r^{-1}T\}} \arrow[d] \arrow[ru, dotted,"\eta"] &   \\
            {A\left\{r^{-1}\frac{f}{g}\right\}} \arrow[ruu, dotted, "\tau"]          &  
        \end{tikzcd}
    \]
    successively. The morphism $\eta$ sends $T_i$ to $\psi(f_i)/\psi(g)$ for $i=1,\ldots,n$.  The existence of such a morphism is guaranteed by \cref{cor-univpropTatenonstrict}.  Clearly $gT_i-f_i$ is contained in $\ker \eta$, so $\eta$ descends to $\tau$. The morphism $\tau$ is clearly unique.

    It remains to verify that the image of $\Sp A\left\{r^{-1}\frac{f}{g}\right\}$ in $\Sp A$ is exactly $(\Sp A)\left\{r^{-1}\frac{f}{g}\right\}$. In other words, we need to verify that if $|\bullet|_x$ is a bounded semi-valuation on $A$ satisfying $|f_i|_x\leq r_i |g|_x$, then $|\bullet|_x$ extends to a bounded semi-valuation on   $A\left\{r^{-1}\frac{f}{g}\right\}$. 
    Replacing $A$ by $A/\ker |\bullet|_x$, we may assume that $|\bullet|_x$ is a valuation on $A$. Consider the Gauss valuation $|\bullet|_{x,r}$ on $A\{r^{-1}T\}$ and the residue norm $\|\bullet\|$ on $A\left\{r^{-1}\frac{f}{g}\right\}$. It suffices to show that $\|\bullet\|$ is a valuation extending the valuation $|\bullet|_x$ on $A$. The former is a consequence of the latter. Take $a\in A$, we need to show that $|a|_x=\|a\|$.

    A general preimage of $a$ in $A\{r^{-1}T\}$ has the form
    \[
        a+\sum_{i=1}^n(gT_i-f_i)\sum_{\alpha\in \mathbb{N}^n}^{\infty}b_{i,\alpha}T^{\alpha}
    \]
    with $\|b_{i,\alpha}\|_Ar^{\alpha}$, where $\|\bullet\|_A$ denotes the initial norm on $A$. The same argument as in \cref{ex-Laurentdomain} shows that 
    \[
        \|a+\sum_{i=1}^n(gT_i-f_i)\sum_{\alpha\in \mathbb{N}^n}^{\infty}b_{i,\alpha}T^{\alpha}\|_{x,r}\geq |a|_x.
    \]
    So $\|a\|_x\geq |a_x|$, the reverse inequality is trivial. 
\end{example}




\begin{proposition}\label{prop-affdomainhoemo}
    Let $A$ be a $k_H$-affinoid algebra and $V\subseteq \Sp A$ be a $k_H$-affinoid domain represented by $\varphi:A\rightarrow A_V$. Then $\Sp \varphi$ induces a homeomorphism $\Sp A_V\rightarrow V$. 
\end{proposition}
In particular, we will identify $V$ with $\Sp A_V$ and say $\Sp A_V$ is a $k_H$-affinoid domain in $\Sp A$.
\begin{proof}
    We observe that $\Sp A_V\rightarrow \Sp A$ is a monomorphism in the category $k_H\text{-}\AffCat$. In other words, $A\rightarrow A_V$ is an epimorphism in the category $k_H\text{-}\AffAlgCat$. To see this, let $\eta_1,\eta_2:A_V\rightarrow B$ be two arrows in $k_H\text{-}\AffAlgCat$ such that $\eta_1\circ \varphi=\eta_2\circ \varphi$. It follows from the universal property in \cref{def-affinoiddomain} that $\eta_1=\eta_2$. By \cref{prop-monoaffinj}, $\Sp A_V\rightarrow \Sp A$ is a bijection. But $\Sp A_V$ and $\Sp_A$ are both compact and Hausdorff by \cref{Banach-thm-spectrumcptHaus} in the chapter Banach rings, so $\Sp A_V\rightarrow V$ is a homeomorphism.
\end{proof}


\begin{corollary}\label{cor-affinoiddomaintransi}
    Let $A$ be a $k_H$-affinoid algebra. Let $\Sp B$ be a $k_H$-affinoid domain in $\Sp A$ and $\Sp C$ is a $k_H$-affinoid domain in $\Sp A$, then $\Sp C$ is a $k_H$-affinoid domain in $\Sp A$.
\end{corollary}
\begin{proof}
    This follows immediately from \cref{prop-affdomainhoemo}.
\end{proof}

\begin{proposition}\label{prop-intersecrationaldomain}
    Let $A$ be a $k_H$-affinoid algebra and $V,W$ be $k_H$-Weierstrass domains (resp. $k_H$-Laurent domains, resp. $k_H$-rational domains) in $\Sp A$. Then $V\cap W$ is also a $k_H$-Weierstrass domain (resp. $k_H$-Laurent domain, resp. $k_H$-rational domain).
\end{proposition}
\begin{proof}
    This is clear in the Weierstrass and Laurent cases. We will prove therefore assume that $V$ and $W$ are $k_H$-rational.

    We take $f_1,\ldots,f_n\in A$, $g_1,\ldots,g_m\in A$ both generating the unit ideal and $r=(r_1,\ldots,r_n)\in \sqrt{|k^{\times}|\cdot H}^n$, $s=(s_1,\ldots,s_m)\in \sqrt{|k^{\times}|\cdot H}^m$ such that
    \[
        V=\Sp A\left\{r^{-1}\frac{f}{f_m}\right\},\quad  W=\Sp A\left\{s^{-1}\frac{g}{g_n}\right\}.
    \]
    We may assume that $r_n=s_m=1$.
    Now let $R=(R_{i,j})\in \sqrt{|k^{\times}|\cdot H}^{mn}$ where $R_{i,j}=r_is_j$ and $F=(F_{i,j})$ with $F_{i,j}=f_ig_j$ for $i=1,\ldots,n$, $j=1,\ldots,m$. Observe that the $F_{i,j}$'s generate the unit ideal.
    We consider the $k_H$-rational domain
    \[
        Z= \Sp A\left\{R^{-1}\frac{F}{f_ng_m} \right\}.
    \]
    We clearly have $V\cap W\subseteq Z$. We need to prove the reverse inequality. Let $x\in Z$, so we have
    \[
        |f_ig_j(x)|\leq r_{i}s_j |f_n g_m(x)|
    \]
    for any $i=1,\ldots,n$, $j=1,\ldots,m$. In particular, when $j=m$, we have
    \[
        |f_ig_m(x)|\leq r_{i} |f_n g_m(x)|
    \]
    for any $i=1,\ldots,n$. But $f_ng_m$ is invertible, so we can cancel $g_m(x)$ to find
    \[
        |f_i(x)|\leq  r_i |f_n(x)|.
    \]
    So $x\in V$. Similarly, we have $x\in W$.
\end{proof}


\begin{corollary}\label{cor-Laurentdomainrational}
    Let $A$ be a $k_H$-affinoid algebra and $V$ be a $k_H$-Laurent domain in $\Sp A$. Then $V$ is also a $k_H$-rational domain.
\end{corollary}
\begin{proof}
    By \cref{prop-intersecrationaldomain}, it suffices to show consider $k_H$-Laurent domains of the following form:
    \[
        \Sp A\{r^{-1}f\},\quad \Sp A\{sg^{-1}\}  
    \]   
    where $r,s\in \sqrt{|k^{\times}|\cdot H}$ and $f,g\in A$. Both domains are $k_H$-rational by definition.
\end{proof}

\begin{proposition}\label{prop-rationaldomaindecomp}
    Let $A$ be a $k_H$-affinoid algebra and $\Sp B$ be a $k_H$-rational domain in $\Sp A$. Then there is a $k_H$-Laurent domain $\Sp C$ in $\Sp A$ such that $\Sp B\subseteq \Sp C$ and $\Sp B$ is a $k_H$-Weierstrass domain in $\Sp C$.
\end{proposition}
\begin{proof}
    We write 
    \[
        B=A\left\{r^{-1}\frac{f}{g}\right\}  
    \]
    for some $n\in \mathbb{N}$, $r=(r_1,\ldots,r_n)\in \sqrt{|k^{\times}|\cdot H}^n$, $f=(f_1,\ldots,f_n)\in A^n$ and $g\in A$ such that $f_1,\ldots,f_n,g$ generate the unit ideal. Let $g''$ be the image of $g$ in $B$, which is a unit. Choose $c\in \sqrt{|k^{\times}|\cdot H}$ such that $\rho_B(g^{-1})<c^{-1}$. Set $C=A\{c g^{-1}\}$, then $\Sp B\subseteq \Sp C$. Moreover,
    \[
        \Sp B\cap \Sp C=\emptyset.  
    \]
    Let $f'_1,\ldots,f'_n,g'$ be the images of $f_1,\ldots,f_n,g$ in $C$. Write $f'=(f'_1,\ldots,f'_n)$. Then by \cref{Banach-cor-invertibleintermsofsp} in the chapter Banach Rings, $g'$ is a unit and 
    \[
        \Sp B=\Sp C\{r^{-1} g'^{-1}f'\}.  
    \]
\end{proof}

\begin{proposition}\label{prop-rationaldomaintransitive}
    Let $A$ be a $k_H$-affinoid algebra, $\Sp B$ be a $k_H$-Weierstrass domain (resp. $k_H$-rational domain) in $\Sp A$ and $\Sp C$ be a $k_H$-Weierstrass domain (resp. $k_H$-rational domain) in $\Sp B$. Then $\Sp C$ is a $k_H$-Weierstrass domain (resp. $k_H$-rational domain) in $\Sp A$.
\end{proposition}
\begin{proof}
    We first handle the Weierstrass case.
    Write 
    \[
        B=\Sp A\{r^{-1}f\},   C=\Sp B\{s^{-1}g\}
    \]
    for some $n,m\in \mathbb{N}$, $r\in \sqrt{|k^{\times}|\cdot H}^n$, $s\in \sqrt{|k^{\times}|\cdot H}^m$ and $f=(f_1,\ldots,f_n)\in A^n$, $g=(g_1,\ldots,g_m)\in B^m$. Observe that if we replace $g$ with a small perturbation, the domain $\Sp C$ in $\Sp B$ remains the same, so we may assume that $g_1,\ldots,g_m\in A$. Then
    \[
        \Sp C=\Sp A\{r^{-1}f\}\cap \Sp A\{s^{-1}g\}
    \]
    is a $k_H$-Weierstrass domain by \cref{prop-intersecrationaldomain}.

    Next we handle the rational case. Write
    \[
        B=A\left\{s^{-1}\frac{f}{g}\right\}
    \]
    for some $m\in \mathbb{N}$, $f=(f_1,\ldots,f_m)\in A^m$, $r=(r_1,\ldots,r_m)\in \sqrt{|k^{\times}|\cdot H}^m$ and $g\in A$ such that $f_1,\ldots,f_m,g$ generate the unit ideal.

    By \cref{prop-rationaldomaindecomp} and \cref{prop-intersecrationaldomain}, it suffices to handle the special cases $C=B\{r^{-1}h\}$ and $C=B\{rh^{-1}\}$ for some $r\in \sqrt{|k^{\times}|\cdot H}$ and $h\in B$. Observe that making a small perturbation on $h$ does not change the domain.
    As $A[g^{-1}]$ is dense in $B$, we may assume that there is $n\in \mathbb{Z}_{>0}$ such that $h'=g^nh\in A$. As $g$ is invertible on $\Sp B$, we can find $c\in \sqrt{|k^{\times}|\cdot H}$ so that
    \[
        |g(x)|^n>c^{-1}  
    \]
    for $x\in \Sp B$. 
    
    We need to treat the cases $C=B\{r^{-1}h\}$ and $C=B\{rh^{-1}\}$ separately. In the first case, we write
    \[
        \Sp C=\Sp B\cap \Sp A\left\{ (r,c)^{-1}\frac{(h',1)}{g^n}\right\}.  
    \]
    In the second case,
    \[
        \Sp C=\Sp B\cap \Sp A\left\{(r,c)^{-1}\frac{(g^n,1)}{h'} \right\}.  
    \]
\end{proof}

\begin{lemma}\label{lma-affinoiddomainrestrtorationaldomain}
    Let $A$ be a $k_H$-affinoid algebra and $\Sp B$ be a $k_H$-affinoid domain in $\Sp A$. Let $\Sp C$ be a rational domain in $\Sp A$, then $(\Sp C)\cap (\Sp B)$ is a $k_H$-affinoid domain in $\Sp A$ represented by $A\rightarrow B\hat{\otimes}_A C$.
\end{lemma}
\begin{proof}
    We first recall that $B\hat{\otimes}_A C$ is $k_H$-affinoid by \cref{prop-existfiberprod}.

    We may assume that 
    \[
        C=A\left\{s\frac{f}{g}\right\}
    \]
    for some $m\in \mathbb{N}$, $f=(f_1,\ldots,f_m)\in A^m$, $r=(r_1,\ldots,r_m)\in \sqrt{|k^{\times}|\cdot H}^m$ and $g\in A$ such that $f_1,\ldots,f_m,g$ generate the unit ideal.

    We observe that there is a natural isomorphism
    \[
        B\hat{\otimes}_A C  \cong B\left\{s^{-1}\frac{f}{g}\right\}.
    \]
    Hence,
    \[
        \Sp  B\hat{\otimes}_A C=\left\{x\in \Sp B: |f_i(x)|\leq s|g(x)|\text{ for }i=1,\ldots,m\right\}.
    \]
    On the other hand,
    \[
        \Sp C=  \left\{x\in \Sp A: |f_i(x)|\leq s|g(x)|\text{ for }i=1,\ldots,m\right\}.
    \]
    So $\Sp B\hat{\otimes}_A C=B\hat{\otimes}_A C$. 
    By \cref{prop-existfiberprod}, we have the Cartesian square in the diagram below:
    \[
        \begin{tikzcd}
            \Sp D \arrow[rrd] \arrow[rdd, dotted] \arrow[rd, dotted] &                                                                           &                 \\
                                                                     & \Sp B\hat{\otimes}_A C \arrow[r] \arrow[d] \arrow[rd, "\square", phantom] & \Sp C \arrow[d] \\
                                                                     & \Sp B \arrow[r]                                                           & \Sp A          
            \end{tikzcd}
    \]
    
    It remains to verify the universal property.  Let $\Sp D\rightarrow \Sp C$ be a morphism of $k_H$-affinoid spectra that factorizes through $(\Sp C)\cap (\Sp B)$. Then by the universal property of $\Sp B$ in $\Sp A$, we find the dotted morphism $\Sp D\rightarrow \Sp B$ making the diagram commutes. Then as the square is Cartesian, we get the desired morphism $\Sp D\rightarrow \Sp B\hat{\otimes}_A C$. This morphism is clearly unique.
\end{proof}



\section{Graded reduction}
Let $(k,|\bullet|)$ be a complete non-Archimedean valued field and $H$ be a subgroup of $\mathbb{R}_{>0}$ such that $|k^{\times}|\cdot H\neq \{1\}$.

\begin{definition}\label{def-gradedredu}
    Let $A$ be a Banach $k$-algebra, we define the \emph{graded reduction} of $A$ as
    \[
        \tilde{A}:=\bigoplus_{h\in \mathbb{R}_{>0}}  \left\{x\in A:\rho(x)\leq  h\right\}/\left\{x\in A:\rho(x)<  h\right\}.  
    \]
    For any $f\in A$ with $\rho(f)\neq 0$, we define $\tilde{f}$ as the image of $f$ in the $\rho(f)$-graded piece of $\tilde{A}$.
\end{definition}



\begin{definition}
    Let $A$ be a $k_H$-affinoid algebra. We define the \emph{$k_H$-graded reduction} of $A$ as the $\sqrt{|k^{\times}|\cdot H}$-graded ring
    \[
      \tilde{A}^H:=\bigoplus_{h\in \sqrt{|k^{\times}|\cdot H}}\left\{x\in A:\rho(x)\leq  h\right\}/\left\{x\in A:\rho(x)<  h\right\}.  
    \]

    For any $f\in A$ with $\rho(f)\neq 0$, we define $\tilde{f}$ as the image of $f$ in the $\rho(f)$-graded piece of $\tilde{A}^H$.

    For any morphism $f:A\rightarrow B$ of $k_H$-affinoid algebras, we define 
    \[
        \tilde{f}^H:  \tilde{A}^H\rightarrow \tilde{B}^H
    \]
    as the map induced by sending the class of $x\in A$ with $\rho(x)\leq h$ for any $h\in \sqrt{|k^{\times}|\cdot H}$ to the class of $f(x)\in B$.
\end{definition}
Recall that $\rho(A)=\sqrt{|k^{\times}|\cdot H}\cup\{0\}$ by \cref{thm-strictaffdfnequal}, so $\tilde{f}$ is well-defined. This definition is compatible with \cref{def-gradedredu} in the sense that if we regard a  $\sqrt{|k^{\times}|\cdot H}$-graded ring as a $\mathbb{R}_{>0}$-graded ring, the two definitions give the same object.

\begin{example}
    If $K$ is a $k_H$-affinoid algebra which is a field as well, then $\tilde{K}^H$ is a $\sqrt{|k^{\times}|\cdot H}$-graded field. This is immediate from the definition.
\end{example}



\begin{lemma}\label{lma-rhointatering}
    Let $(A,\|\bullet\|)$ be a $k$-affinoid algebra, $n\in \mathbb{N}$ and $r\in \mathbb{R}^n_{>0}$. Let $f\in k\{r^{-1}T\}$. Expand $f$ as
    \[
        f=\sum_{\alpha\in \mathbb{N}^n}a_{\alpha}T^{\alpha}.  
    \]
    Then 
    \[
        \rho(f)=\max_{\alpha\in \mathbb{N}^n} \rho(a_{\alpha})r^{\alpha}.
    \]
\end{lemma}
\begin{proof}
    By induction, we may assume that $n=1$ and write $r=r_1$. As $\rho$ is a bounded powerly bounded semi-norm, we have
    \[
        \rho(f)\leq \max_{j\in \mathbb{N}}\rho(a_{j}T^j) \leq \max_{j\in \mathbb{N}}\rho(a_{j})\rho(T^j)= \max_{j\in \mathbb{N}} \rho(a_j)r^j.  
    \]
    Observe that $\rho(a_j)$ is not ambiguous: when intepreted as in $A$ and in $A\{r^{-1}T\}$, it has the same value.

    Conversely, we need to show that for any $j\in \mathbb{N}$, 
    \[
        \rho(f)\geq \rho(a_j)r^j.  
    \]
    Equivalently, this means for any $k\in \mathbb{Z}_{>0}$ and any $j\in \mathbb{N}$, we need to show that
    \[
        \|f^k\|_r\geq \rho(a_j)^k r^{jk}.  
    \]
    Fix $j$ and $k$ as above.
    We compute the left-hand side:
    \[
        f^k=\sum_{\beta=(\beta_1,\ldots,\beta_k)\in \mathbb{N}^k} b_{\beta} T^{|\beta|},\quad b_{\beta}=\prod_{l=1}^k a_{\beta_l}.  
    \]
    It follows that
    \[
        \|f^k\|_r=\max_{\beta \in \mathbb{N}^k} \|b_{\beta}\|T^{|\beta|}.
    \]
    Take $\beta=(j,j,\ldots,j)$, we find
    \[
        \|f^k\|_r\geq \|a_j^k\| r^{jk}\geq \rho(a_j)^k r^{jk}.
    \]
\end{proof}

\begin{lemma}\label{prop-rhodiscrete}
    Assume that $k$ is non-trivially valued.
    Let $A$ be a strictly $k$-affinoid algebra. Then for any $a,f\in A$, the set of non-zero values $\rho(f^n a)$ for $n\in \mathbb{N}$ is a discrete subset of $\mathbb{R}_{>0}$.
\end{lemma}
\begin{proof}
    As $A$ is noetherian \cref{thm-affnoetherian}, it has only finitely many minimal prime ideals, say $\mathfrak{p}_1,\ldots,\mathfrak{p}_m$. It follows that 
    \[
        \Sp A=\bigcup_{i=1}^m \Sp A/\mathfrak{p}_i.
    \]
    Here we make the obvious identification by identifying $\Sp A/\mathfrak{p}_i$ with a subset of $\Sp A$.

    By \cref{Banach-cor-rhoequsup} in the chapter Banach Rings, it suffices to consider each of $\Sp A/\mathfrak{p}_i$ separately, so we may assume that $A$ is an integral domain. 
    
    By \cref{cor-noenormalization}, we can take $d\in \mathbb{N}$ and a finite injective homomorphism of $k$-algebras $\iota:k\{T_1,\ldots,T_d\}\rightarrow A$. According to \cref{Banach-prop-fsupspecexp} in the chapter Banach Rings, $\rho_A$ is the restriction of the norm $\|\bullet\|_{\Frac A}$ on $\Frac A$ induced by the finite extension $\Frac A/\Frac k\{T_1,\ldots,T_d\}$ from the Gauss valuation. But it is well-known that $\|\bullet\|_{\Frac A}$ is the maximum of finitely many valuations on $\Frac A$. \textcolor{red}{Reproduce BGR3.3.3.1 somewhere.} The assertion is by now obvious.
\end{proof}

\begin{lemma}\label{lma-rhoBandrhoA}
    Let $(A,\|\bullet\|)$ be a $k$-affinoid algebra, $f\in A$ with $r=\rho(f)>0$. Let $B=A\{r^{-1}f\}$. Then for any $a\in A$, we have
    \[
        \rho_B(a)=\lim_{n\to\infty}r^{-n}\rho_A(f^na).
    \]  
    If moreover, $\rho_B(a)>0$, then there is $n_0>0$ such that for $n\geq n_0$,
    \[
        \rho_B(a)=r^{-n}\rho_A(f^na),\quad   \rho_B(f^na)=r^{-n}\rho_A(a).
    \]
\end{lemma}
\begin{proof}
    We observe that for any $a\in A$, $n\in \mathbb{Z}_{>0}$, we have
    \[
        \rho_B(f^na)=r^n\rho_B(a).
    \]
    So the last two assertions are equivalent.

    Take a $k$-free polyray $s$ such that $A\hat{\otimes}_k k_s$ and $B\hat{\otimes}_k k_s$ are both strictly $k_s$-affinoid. By \cref{prop-Krfaithflat}, $A\hat{\otimes}_k k_s\{r^{-1}f\}\cn B\hat{\otimes}_k k_s$. Moreover, $\rho_A$ and $\rho_B$ are both preserved after base change to $k_s$. So we may assume that $k$ is non-trivially valued and $A$ and $B$ are strictly $k$-affinoid.

    Observe that  for $n\in \mathbb{Z}_{>0}$, 
    \[
        \rho_A(f^{n+1}a)\leq \rho_A(f)\rho_A(f^na)=r   \rho_A(f^na). 
    \]
    So $r^{-n}\rho_A(f^{n}a)$ is decreasing in $n$. Moreover, for any $x\in \Sp A\{r^{-1}f\}$, by \cref{ex-Laurentdomain}, we have
    \[
        |f(x)|\geq r. 
    \]
    By \cref{Banach-cor-rhoequsup} in the chapter Banach Rings, we have
    \[
        |f(x)|=r  
    \]
    for any $x\in \Sp A\{r^{-1}f\}$. It follows from \cref{Banach-cor-rhoequsup} in the chapter Banach Rings that for any $n\in \mathbb{Z}_{>0}$,
    \[
        \rho_A(f^na)=\sup_{x\in \Sp A}|f^na(x)|\geq  r^n\sup_{x\in \Sp A\{rf^{-1}\}}|a(x)|=r^n\rho_B(a). 
    \]
    By \cref{prop-rhodiscrete}, the decreasing sequence $\{r^{-n}\rho_A(f^na)\}_n$ either tends to $0$ or is eventually constant. It converges to $0$, there is nothing else to prove. So let us assume that there is $\alpha\in \mathbb{R}_{>0}$ and $n_0>0$ such that for $n\geq n_0$, we have
    \[
        r^{-n}\rho_A(f^na)=\alpha.  
    \]
    We have to show that $\alpha\leq \rho_B(a)$. Assume the contrary $\alpha>\rho_B(a)$. Then for all $x\in \Sp A$, we have
    \[
        |f^na(x)|\leq r^n|a(x)|.  
    \] 
    So $f^na$ must obtain its maximum on $U:=\{x\in \Sp A: |a(x)|\geq \alpha\}$. But $U$ is disjoint from $\Sp A\{r^{-1}f\}$ as
    \[
        \alpha>\rho_B(a).
    \]
    It follows from \cref{ex-Laurentdomain} that 
    \[
        \beta:=\sup_{x\in U}|f(x)|=\max_{x\in U}|f(x)|<r.  
    \]
    So
    \[
        \rho(f^na)=\sup_{x\in \Sp A}|f^na(x)|=\sup_{x\in U}|f^na(x)|\leq \beta^n \sup_{x\in U}|a(x)|.   
    \]
    This contradicts the fact that $\alpha>0$.
\end{proof}

\begin{proposition}\label{prop-gradedredtate}
    Let $A$ be a $k_H$-affinoid algebra and $r\in \mathbb{R}^n_{>0}$, then there is a functorial isomorphism
    \[
        \widetilde{A\{r^{-1}T\}}^H \cn \tilde{A}^H[r^{-1}T]
    \]
    of $\sqrt{|k^{\times}|\cdot H}$-graded rings.
\end{proposition}
Recall that $k_r$ is defined in \cref{ex-generalkr}.
\begin{proof}
    By \cref{lma-rhointatering}, we have a natural isomorphism
    \[
        \widetilde{A\{r^{-1}T\}}^H_s \cn \bigoplus_{\alpha\in \mathbb{N}^n} \tilde{A}^H_{s r^{-\alpha}}  
    \]
    for any $s\in \sqrt{|k^{\times}|\cdot H}$. This establishes the desired isomorphism.
\end{proof}

\begin{proposition}\label{prop:localatoneelementreduction}
    Let $A$ be a $k_H$-affinoid algebra and $f\in A$ with $r=\rho(f)>0$. Then there is a natural isomorphism
    \[
        \tilde{A}^H_{\tilde{f}}\cn \widetilde{A\{rf^{-1}\}}^H
    \]
    of $\sqrt{|k^{\times}|\cdot H}$-graded rings.
\end{proposition}
Recall that $A\{rf^{-1}\}$ is defined in \cref{ex-Laurentdomain}, by \cref{thm-strictaffdfnequal}, it is $k_H$-affinoid.
\begin{proof}

    Let $B=A\{rf^{-1}\}$ and denote by $\phi:\tilde{A}^H\rightarrow \tilde{A}_{\tilde{f}}^H$ the natural  $\sqrt{|k^{\times}|\cdot H}$-graded homomorphism. From the universal property \textcolor{red}{add details}, we can factor the natural map $\tilde{A}^H\rightarrow \tilde{B}^H$ as $\psi:\tilde{A}_{\tilde{f}}^H\rightarrow \tilde{B}^H$. We have a commutative diagram:
    \[
        \begin{tikzcd}
            \tilde{A}^H \arrow[r] \arrow[d, "\phi"']   & \tilde{B}^H \\
            \tilde{A}^H_{\tilde{f}} \arrow[ru, "\psi"] &          
        \end{tikzcd}
    \]
    We claim that $\psi$ is bijective.
    Let $\tilde{a}/\tilde{f}^m$ be an element in $\ker \psi$, where $\tilde{a}\in \tilde{A}^H$ is homogeneous. Lift $\tilde{a}$ to $a\in A$. Then $\rho_B(a)<\rho_A(a)$. By \cref{lma-rhoBandrhoA}, $\rho_A(f^na)<r^n\rho_A(a)$ when $n$ is large enough, so 
    \[
        \tilde{f}^n\tilde{a}=0  
    \]
    in $\tilde{A}$. Therefore, $\tilde{a}/f^m=0$ in $\tilde{A}^H_{\tilde{f}}$. We have shown that $\psi$ is injective.

    It remains to show that $\psi$ is surjective. Let $\tilde{b}\in \tilde{B}^H$ be a non-zero homogeneous element. Lift $\tilde{b}$ to $b\in B$ of the form $f^{-n}a$ for some $a\in A$. By \cref{lma-rhoBandrhoA} again, up to enlarging $n$, we can assume that $\rho_B(a)=\rho_A(a)$. Then $\tilde{a}=\tilde{f}^n\tilde{b}$ has a preimage in $\tilde{A}$. 

\end{proof}

\begin{corollary}\label{cor-baseextgradedextkr}
    Let $A$ be a $k_H$-affinoid algebra and $r\in \mathbb{R}^n_{>0}$, then there is a functorial isomorphism
    \[
        \tilde{A}^H\otimes_{\tilde{k}^H} \tilde{k_r}^H\cong \widetilde{A\hat{\otimes}_k k_r}^H
    \]
    of $\sqrt{|k^{\times}|\cdot H}$-graded rings.
\end{corollary}
\begin{proof}
    We can write
    \[
        A\hat{\otimes}_k k_r=\varinjlim_{g\in k\{r^{-1}T\},g\neq 0} A\{r^{-1}T\}\{\rho(g)g^{-1}\}.
    \]
    Taking graded reduction, we find
    \[
        \begin{aligned}
        \widetilde{A\hat{\otimes}_k k_r}^H=&\varinjlim_{g\in k\{r^{-1}T\},g\neq 0} \widetilde{A\{r^{-1}T\}\{\rho(g)g^{-1}\}}^H\\
        =&\varinjlim_{g\in k\{r^{-1}T\},g\neq 0} \widetilde{A\{r^{-1}T\}}^H_{\tilde{g}}\\
        =&\varinjlim_{g\in k\{r^{-1}T\},g\neq 0} \tilde{A}^H[r^{-1}T]_{\tilde{g}}\\
        =&\tilde{A}^H\otimes_{\tilde{k}^H} \tilde{k_r}^H.
        \end{aligned}
    \]
    Here we have applied \cref{prop:localatoneelementreduction} in the second equality and \cref{prop-gradedredtate} in the third equality. The first equality follows from the simple observation that graded reduction commutes with filtered colimits.
\end{proof}



\begin{thm}\label{thm-reductionfinite}
    Let $\phi:A\rightarrow B$ be a morphism of $k_H$-affinoid algebras. Then the following are equivalent:
    \begin{enumerate}
        \item $\phi$ is finite and admissible.
        \item $\tilde{\phi}:\tilde{A}^H\rightarrow \tilde{B}^H$ is finite.
    \end{enumerate}
\end{thm}
\begin{proof}
    Take $n\in \mathbb{N}$ and $r\in \mathbb{R}^n_{>0}$ so that 
    \[
        \rho(A\hat{\otimes}_k k_r)=\rho(B\hat{\otimes}_k k_r)=|k_r|
    \]
    and $k_r$ is non-trivially valued. \textcolor{red}{Proof that this is possible.}

    By \cref{Commutative-cor-finitegradeddescent} in the chapter Commutative Algebra and \cref{prop-finiteadmissibledesc},  we may assume that $k$ is non-trivially valued and $\rho(A)=\rho(B)=|k|$. By \cref{Commutative-lma-rhoconditionimplygraded} in  the chapter Commutative Algebra, we have $\tilde{A}=\tilde{A}_1\otimes_{\tilde{k}_1} \tilde{k}$. 
    By \cref{cor-finitehomoadmi}, $\phi$ is automatically admissible if it is finite. 
    
    So it suffices to argue that $\phi$ is finite if and only if $\tilde{\phi}:\tilde{A}\rightarrow \tilde{B}$ is finite. 
    
    Assume that $\varphi$ is finite. We show that $\tilde{\varphi}$ is finite. 

    First consider the case where $A$ is an integral domain. 
    
    We claim that there is $d\in \mathbb{N}$ and a $k$-algebra homomorphism $\psi:k\{T_1,\ldots,T_d\}\rightarrow A$ such that $\phi\circ \psi$ is finite and injective.  In fact, choosing an epimorphism $\alpha:k\{T_1,\ldots,T_d\}\rightarrow A$, we can apply \cref{thm-Noetheriannorm} to find $\phi\circ \alpha$ to conclude.

    It suffices to show that $\widetilde{\phi\circ\psi}$ is finite in order to conclude that $\tilde{\phi}$ is finite. So we are reduced to the case $A=k\{T_1,\ldots,T_d\}$ and $\ker \phi=0$.

    We will show that the conditions of \cref{Banach-lma-finitemodulejapanese} in the chapter Banach Rings is satisfied with $\rho_B$ as the norm $B$. We have shown that $\rho_B$ is a faithful $k\{T_1,\ldots,T_d\}$-algebra nrom in \cref{cor-rhofaithful}. As $B$ is of finite over $k\{T_1,\ldots,T_d\}$, the rank condition is clearly satisfied. It remains to establish that $\mathring{\phi}$ is integral.

    By \cref{prop-integralstrictafffsup}, for $f\in B$, there is an integral equation 
    \[
        f^n+\phi(a_1)f^{n-1}+\cdots+\phi(a_n)=0
    \]
    over $A$ such that $\rho_B(f)=\max_{i=1,\ldots,n}|b_i|_{\sup}^{1/i}$. If $f\in \mathring{B}$, then $|b_i|_{\sup}\leq 1$, hence $b_i\in \mathring{B}$. \textcolor{red}{Add a ref}

    Conversely, assume that $\tilde{\phi}$ is finite. It suffices to apply \cref{lma-reductionfiniteimplyfinite} to conclude that $\phi$ is finite.
\end{proof}

\begin{corollary}\label{cor-reductionfinitelygenerated}
    Let $A$ be a $k_H$-affinoid algebra, then $\tilde{A}^H$ is finitely generated over $\tilde{k}^H$.
\end{corollary}
\begin{proof}
    Take $n\in \mathbb{N}$, $r\in \mathbb{R}^n_{>0}$ and an admissible epimorphism 
    \[
        \pi:k\{r^{-1}T\}\rightarrow A.    
    \]
    Applying \cref{thm-reductionfinite}, we find that it suffices to prove that $\widetilde{k\{r^{-1}T\}}^H$ is finitely generated over $\tilde{k}^H$. But this follows from \cref{prop-gradedredtate}.
\end{proof}

\begin{definition}
    Let $A$ be a $k_H$-affinoid algebra, we define the \emph{reduction map}
    \[
        \tilde{\Sp A}^H:=\Spec^{\sqrt{|k^{\times}|\cdot H}}\tilde{A}^H.  
    \]
    We have a natural map $\pi^H:\Sp A\rightarrow \tilde{\Sp A}^H$: given $x\in \Sp A$, it defines a character $\chi_x:A\rightarrow \mathscr{H}(x)$, which in turn induces $\widetilde{\chi_x}:\tilde{A}^H\rightarrow \widetilde{\mathscr{H}(x)}$. We define $\pi^H(x)=\ker \widetilde{\chi_x}$.
\end{definition}
\begin{proposition}
    Let $A$ be a $k_H$-affinoid algebra, then $\pi^H:\Sp A\rightarrow \tilde{\Sp A}^H$ is anti-continuous.
\end{proposition}
\begin{proof}
    Let $f\in A$ be an element with $\rho(f)>0$. We need to show that the inverse image of the Zariski closed subset of $\tilde{\Sp A}^H$ defined by $\tilde{f}=0$ is open. Now $x\in \pi^{H,-1}(V(\tilde{f}))$ if and only if $\widetilde{\chi_x}(\tilde{f})=0$. This happens if and only if $\rho(\chi_x(f))<\rho(f)$. Equivalently, the latter condition means $|f(x)|<\rho(f)$, which obviously defines an open subset of $\Sp A$.
\end{proof}

\begin{lemma}
    Assume that $k$ is non-trivially valued and $A$ is a strictly $k$-affinoid algebra. Then the reduction map 
    \[
        \pi:\Sp A\rightarrow \Spec \tilde{A}  
    \]
    is surjective.
\end{lemma}
The reduction map is defined as follows: a point $x\in \Sp A$ defines a character $\chi_x:A\rightarrow \mathscr{H}(x)$. By reduction, we get $\tilde{\chi_x}:\tilde{A}\rightarrow \widetilde{\mathscr{H}(x)}$. The kernel is the image of $x$.
\begin{proof}
    \textbf{Step~1}. We assume that $A=k\{T_1,\ldots,T_n\}$ for some $n\in \mathbb{N}$. 

    Let $y\in \Spec \tilde{A}$ corresponding to a prime ideal $\mathfrak{p}_y$ in $\tilde{A}$. In this case, $\tilde{A}=\tilde{k}[T_1,\ldots,T_n]$ by \cref{prop-reductionTn}. We can identify $y$ with the character
    \[
        \chi_y :\tilde{A}=\tilde{k}[T_1,\ldots,T_n]\rightarrow  \tilde{A}/\mathfrak{p}_y,
    \]
    
    \textcolor{red}{To be finished!!!}
\end{proof}

\begin{thm}
    Let $A$ be a $k_H$-affinoid algebra. Then the reduction $\pi^H:\Sp A\rightarrow \tilde{\Sp A}^H$ is surjective.
\end{thm}
\begin{proof}
    \textbf{Step~1}. We reduce to the case where $\rho(A)=|k|$.

    Take $n\in \mathbb{Z}_{>0}$ and $r=(r_1,\ldots,r_n)\in \mathbb{R}^n_{>0}$ such that $\rho(A\hat{\otimes}_k k_r)=|k_r|$ such that $r_1$ is $k$-free. Let $B=A\hat{\otimes}_k k_r$. Then we have a commutative diagram
    \[
        \begin{tikzcd}
            \Sp B \arrow[d, "\pi^H"] \arrow[r] & \Sp A \arrow[d, "\pi^H"] \\
            \widetilde{\Sp B}^H \arrow[r]      & \widetilde{\Sp A}^H     
        \end{tikzcd}.  
    \]
    It suffices to show that the left vertical map is surjective and the bottom map is surjective.

    We begin with the bottom map.
    By \cref{cor-baseextgradedextkr}, we can identify 
    \[
        \widetilde{\Sp B}^H \cn \widetilde{\Sp A}^H \otimes_{\tilde{k}^H}\tilde{k_r}^H.
    \]
    It suffices to show that 
    \[
        \widetilde{\Sp A}^H \otimes_{\tilde{k}^H}\tilde{k_r}^H\rightarrow  \widetilde{\Sp A}^H  
    \]
    is surjective, which is trivial.

    \textbf{Step~2}. We may assume that $k$ is non-trivially valued,  $A$ is strictly $k$-affinoid and  $\rho(A)=|k|$.
    By \cref{Commutative-lma-rhoAequalrhok} in the chapter Commutative Algebra, it suffices to show that the usual reduction $\pi:A\rightarrow \Spec \tilde{A}$ is surjective.
\end{proof}

\section{Gerritzen--Grauert theorem}
Let $(k,|\bullet|)$ be a complete non-Archimedean valued field and $H$ be a subgroup of $\mathbb{R}_{>0}$ such that $|k^{\times}|\cdot H\neq \{1\}$.

\begin{definition}\label{def-closedimmersion}
    Let $A$ be a $k_H$-affinoid algebra. A morphism $\varphi:\Sp B\rightarrow \Sp A$ in $k_H\text{-}\AffCat$ is a \emph{closed immersion} if the corresponding morphism $A\rightarrow B$ in $k_H\text{-}\AffAlgCat$ is an admissible epimorphism.
\end{definition}

\begin{example}\label{ex-diagonalclosedimm}
    Let $A$ be a $k_H$-affinoid algbera. Consider the diagonal morphism $\Delta:\Sp A\rightarrow  \Sp A \times \Sp A$, defined by the codiagonal $A\hat{\otimes}_k A\rightarrow A$. We claim that $\Delta$ is a closed immersion.

    We first observe that we have a factorization
    \[
        A\otimes_k A\rightarrow A\hat{\otimes}_k  A\rightarrow A
    \]
    of the usual codiagonal, but $A\otimes_k A\rightarrow A$ is clearly surjective. Hence, so is $A\hat{\otimes}_k  A\rightarrow A$.

    In order to see that the codiagonal is admissible, we first observe that it is bounded by definition. Take a $k$-free polyray $r$ with at least one component, then by \cref{prop-Krfaithflat}, we may reduce to the case where $k$ is non-trivially valued. Then it suffices to apply the open mapping theorem \cref{Banach-thm-openmapping} in the chapter Banach Rings.
\end{example}

\begin{proposition}\label{prop-closedimmbasechange}
    Let $A,C$ be a $k_H$-affinoid algebra. Let $\Sp B\rightarrow \Sp A$ be a closed immersion. Consider the Cartesian diagram:
    \[
        \begin{tikzcd}
            \Sp B\hat{\otimes}_A C \arrow[r] \arrow[d] \arrow[rd, "\square", phantom] & \Sp B \arrow[d] \\
            \Sp C \arrow[r]                                                           & \Sp A          
        \end{tikzcd}  
    \]
    Then $\Sp B\hat{\otimes}_A C\rightarrow \Sp C$ is also a closed immersion.
\end{proposition}
\begin{proof}
    This follows from the right-exactness of completed tensor products.
\end{proof}


\begin{definition}
    Let $\varphi:\Sp B\rightarrow \Sp A$ be a morphism in $k_H\text{-}\AffCat$. We call $\varphi$ a \emph{$k_H$-Runge immersion} if there is a factorization in $k_H\text{-}\AffCat$ of $\varphi$:
    \[
        \Sp B \rightarrow \Sp C\rightarrow \Sp A,
    \]
    such that $\Sp B\rightarrow \Sp C$ is a closd immersion and $\Sp C\rightarrow \Sp A$ is a $k_H$-Weierstrass domain.
\end{definition}

\textcolor{red}{Add a prop rational domains form basis}


\begin{lemma}\label{lma-reductionfinitegraded}
    Let $A$ be a $k_H$-affinoid algebra and $V$ be a $k_H$-Laurent domain in $\Sp A$ represented by $A\rightarrow B=A\{r^{-1}f,sg\}$ for some $n,m\in \mathbb{N}$, $f=(f_1,\ldots,f_n)\in A^n$ and $g=(g_1,\ldots,g_m)\in A^m$, $r=(r_1,\ldots,r_n)\in \sqrt{|k^{\times}|\cdot H}^n$ and $s=(s_1,\ldots,s_m)\in \sqrt{|k^{\times}|\cdot H}^m$. Then
    \begin{enumerate}
        \item $\tilde{B}^H$ is finite over the subalgebra generated by $\tilde{A}^H$ and $\tilde{f}_1,\ldots,\tilde{f}_n,\tilde{g}_1^{-1},\ldots,\tilde{g}_m^{-1}$;
        \item if $V$ is a neighbourhood of a point $x\in \Sp A$, then $\tilde{\chi_x}(\tilde{B}^H)$ is finite over $\tilde{\chi_x}(\tilde{A}^H)$.
    \end{enumerate}
\end{lemma}
\begin{proof}
    (1) Consider the admissible epimomorphism 
    \[ 
        A\{r^{-1}T,s S\}\rightarrow B.
    \]
    By \cref{thm-reductionfinite}, it induces a finite homomorphism
    \[
        \widetilde{A\{r^{-1}T,s S\}}^H\rightarrow \tilde{B}^H.
    \]
    The former is computed in \cref{prop-gradedredtate} and our assertion follows.

    (2) This is a special case of (1).
\end{proof}

\begin{thm}[Gerritzen--Grauert, Temkin]\label{thm-GG}
    Let $\varphi:\Sp A\rightarrow \Sp B$ be a monomorphism in $k_H\text{-}\AffCat$. Then there is a finite cover of $X$ by $k_H$-rational domains $W_1,\ldots,W_k$ such that the restrictions $\varphi_i:\varphi^{-1}(W_i)\rightarrow W_i$ are $k_H$-Runge immersions for $i=1,\ldots,k$.
\end{thm}
\begin{proof}
    \textbf{Step~1}. We reduce to the following claim: for each $x\in \Sp A$, there is a $k_H$-rational domain $U$ in $\Sp B$ containing $y=\varphi(x)$ such that $V=\varphi^{-1}U$ is a neighbourhood of $x$ in $\Sp A$ and the induced map $V\rightarrow U$ is a closed immersion.

    Assume this holds. Write $U=\Sp B\left\{r\frac{f}{g}\right\}$ for some $n\in \mathbb{N}$, $f=(f_1,\ldots,f_n)\in B^n$ and $g\in B$ such that $f_1,\ldots,f_n,g$ generates the unit ideal and $r\in \sqrt{|k^{\times}|\cdot H}^n$. As $g$ is invertible on $U$, we can find a small $k_H$-rational domain $W$ in $\Sp B$ containing $y$ such that
    \begin{enumerate}
        \item $g$ is invertible on $W$;
        \item $\varphi^{-1}W \subseteq \varphi^{-1}U$.
    \end{enumerate}
    Then $U\cap W$ is a $k_H$-Weierstrass domain in $W$ and $\varphi^{-1}W\rightarrow W$ is therefore a $k_H$-Runge immersion. From the compactness of $\Sp A$, this implies that we can find $k_H$-rational domains $W_1,\ldots,W_m$ of $\Sp B$ such that $\varphi^{-1}(W_i)\rightarrow W_i$ is a $k_H$-Runge immersion for $i=1,\ldots,m$ and $X_1\cup\cdots\cup X_m$ contains an open neighbourhood $U$ of $\varphi(\Sp A)$. As $\Sp B$ is compact, we can find finitely many $k_H$-rational domains $W_{m+1},\ldots,W_{k}$ which do not intersection $\varphi(\Sp A)$ that covers $\Sp B\setminus U$. Then the covering $W_1,\ldots,W_k$ satisfies all the requirements.
    
    We have reduced the problem to a local one on $\Sp B$.


    \textbf{Step~2}. We show that we may assume that $\widetilde{\chi_x}(\tilde{A}^H)$ is finite over $\widetilde{\chi_y}(\tilde{B}^H)$. Here the notation $\chi_y$ is defined in \cref{Banach-def-residuefield} in the chapter Banach Rings.

    By \cref{cor-reductionfinitelygenerated}, $\widetilde{\chi_x}(\tilde{A}^H)$ is finitely generated over $\widetilde{\chi_y}(\tilde{B}^H)$. Take  generators $h_1,\ldots,h_l\in A$. By \cref{prop-monoaffinj}, $\mathscr{H}(x)\cn \mathscr{H}(y)$, so we can find $f_1,\ldots,f_l,g\in B$ with $|g(y)|=1$ such that 
    \[
        \left| \left(\frac{f_i}{g}-h_i\right)(x) \right|<\rho(h_i)  
    \]
    for all $i=1,\ldots,l$. 
    
    In fact, we can take $g=1$. This can be seen as follows.
    Let $B'=B\{ag^{-1}\}$ for some $a\in \sqrt{|k^{\times}|\cdot H}$ with $a<1$. Then by \cref{lma-reductionfinitegraded}, $\tilde{\chi}_y(\tilde{B'}^H)$ is finite over $\tilde{\chi}_y(\tilde{B}^H)$. So up to replacing $B$ by the $B'$ and $\Sp A$ by the inverse image of $\Sp B'$, we may assume that $g$ is invertible. Replacing $f_i$ by $f_i/g$, we could then assume  that $g=1$. 
    
    Up to replacing $\Sp B$ by $\Sp B\{\rho(h_1)^{-1}f_1,\ldots,\rho(h_l)^{-1}f_l\}$, we can guarantee that $\tilde{f}_i=\tilde{h}_i$ for $i=1,\ldots,l$. So our assertion follows.

    \textbf{Step~3}. We may assume that $\widetilde{\chi_{x'}}(\tilde{A}^H)$ is finite over $\widetilde{\chi_{y'}}(\tilde{B}^H)$ for any $x'\in \Sp A$ and $y'=\varphi(x')$.
    
    Let $\pi:\Sp A\rightarrow \widetilde{\Sp A}^H$ be the reduction map. Let $\mathcal{X}$ denote the Zariski closure of $\pi(x)$. Then for any $x'\in \Sp A$ with $\pi(x')\in \mathcal{X}$, we have 
    \[
        \ker \widetilde{\chi_x}\subseteq \ker \widetilde{\chi_{x'}}. 
    \]
    It follows that $\widetilde{\chi_{x'}}(\tilde{A}^H)$ is finite over $\widetilde{\chi_{y'}}(\tilde{B}^H)$. 

    Since $\pi^{-1}\mathcal{X}$ is open in $\Sp A$ \textcolor{red}{Include the proof}, we can find a $k_H$-Laurent neighbourhood $\Sp B\{rf,sg^{-1} \}$ for soem suitable tuples $r,f,s,g$ of $y$ such that $\varphi^{-1}\Sp B\{rf,sg^{-1} \}\subseteq \pi^{-1}\mathcal{X}$. Observe that for each $x'\in \Sp A$, $\widetilde{\chi_{x'}}(\tilde{A}^H)$ is finite over  $\widetilde{\chi_{y'}}(\tilde{B}^H)$. This follows simply from \cref{lma-reductionfinitegraded}. So up to replacing $B$ with $B\{rf,sg^{-1} \}$, we conclude.

    \textbf{Step~4}. We claim that after all of these reductions, $\varphi$ becomes a closed immersion. By our assumptions, for any minimal homogeneous prime ideal $\mathfrak{p}$ of $\tilde{A}^H$, there is a point $x\in \Sp A$ with $\ker \widetilde{\chi_y}=\mathfrak{p}$ and $\tilde{A}^H/\mathfrak{p}$ is finite over $\tilde{A}^H$.

    Let $\mathfrak{p}_1,\ldots,\mathfrak{p}_k$ be the list of minimal homogeneous prime ideals of $\tilde{A}^H$ \textcolor{red}{prove finiteness}, then
    \[
        \tilde{A}^H\rightarrow \bigoplus_{i=1}^k \tilde{A}^H/\mathfrak{p}_i  
    \]
    is injective. Since $\tilde{B}^H$ is graded noetherian \textcolor{red}{Introduce this notion}, we find that $\tilde{A}^H$ is finite over $\tilde{B}^H$. So $B\rightarrow A$ is finite by \cref{thm-reductionfinite}. It follows that the natural map $A\otimes_B A\rightarrow A\hat{\otimes}_B A$ is an isomorphism by \cref{prop-finiteBanachtensor}. As $\varphi$ is a monomorphism, from general abstract nonsense, the codiagonal $A\hat{\otimes}_B A\cn A$ is an isomorphism. In particular, the codiagonal $A\otimes_B A\rightarrow A$ is an isomorphism. This implies that $A\rightarrow B$ is surjective.
\end{proof}

\begin{lemma}\label{lma-closedimmaffisWeier}
    Let $A$ be a $k_H$-affinoid domain and $V$ be a $k_H$-affinoid domain in $A$ represented by $A\rightarrow A_V$. Assume that $\Sp A_V\rightarrow \Sp A$ is a closed immersion, then $V$ is a $k_H$-Weierstrass domain. 
\end{lemma}
\begin{proof}
    As $\Sp A_V\rightarrow \Sp A$ is a closed immersion, we can find an ideal $I\subseteq  A$ and assume that $A_V=A/I$. Consider the morphism of $k_H$-affinoid spectra $\psi:\Sp A/I^2\rightarrow \Sp A$ induced by the natural map $A/I^2$. By the universal property of $V$, we have a commutative diagram:
    \[
        \begin{tikzcd}
            \Sp A/I^2 \arrow[rd] \arrow[d] &       \\
            \Sp A/I \arrow[r]              & \Sp A
        \end{tikzcd}  
    \]
    On the other hand, the natural map $A/I^2\rightarrow A/I$ induces a morphism of $k_H$-affinoid spectra $\varphi:\Sp A/I\rightarrow \Sp A/I^2$. From the universal property again, the composition $\psi\circ \varphi$ is the identity. In particular, $A/I^2\rightarrow A/I$ is injective and hence $I=I^2$. It follows that $I$ is the principal ideal generated by an idempotent element $e$. We may assume that $e\neq 0$, $e\neq 1$. Take $c\in \sqrt{|k^{\times}|\cdot H}$ such that $0<c<1$, then $V=(\Sp A)\{c^{-1}e\}$.
\end{proof}


\begin{corollary}\label{cor-GG}
    Let $A$ be a $k_H$-affinoid algebra and $V$ be a $k_H$-affinoid domain in $\Sp A$. Then there are finitely many $k_H$-affinoid domains $W_1,\ldots,W_n$ in $\Sp A$ such that
    \[
        V=\bigcup_{i=1}^n W_i.  
    \]
\end{corollary}
\begin{proof}
    By \cref{thm-GG}, we can find finitely many $k_H$-rational domains $U_1,\ldots,U_m$ in $\Sp A$ such that $V\cap U_i\rightarrow U_i$ is a $k_H$-Runge immersion for each $i=1,\ldots,m$. By \cref{prop-rationaldomaintransitive},
    it suffices to prove that $V\cap U_i$ is a $k_H$-rational domain in $U_i$. Observe that $V\cap U_i$ is a $k_H$-affinoid domain in $U_i$ by \cref{lma-affinoiddomainrestrtorationaldomain}. So we are reduced to the case where $V\rightarrow \Sp A$ is also a Runge immersion.

    By \cref{lma-affinoiddomainrestrtorationaldomain} and \cref{prop-rationaldomaintransitive} again, we may assume that $V\rightarrow \Sp A$ is a Runge immersion. 
    
    In this case, the result follows from \cref{lma-closedimmaffisWeier}. 
\end{proof}


\section{Tate acyclicity theorem}
Let $(k,|\bullet|)$ be a complete non-Archimedean valued field and $H$ be a subgroup of $\mathbb{R}_{>0}$ such that $|k^{\times}|\cdot H\neq \{1\}$.


\begin{definition}
    Let $A$ be a $k_H$-affinoid algebra. Let $\mathcal{V}=\{V_i\}_{i\in 1,\ldots,n}$ be a finite covering of $\Sp A$ by $k_H$-affinoid domains. Let $M$ be an $A$-module. We define the \emph{augmented \v{C}ech complex} $\check{C}(\mathcal{V},M)$ as the following cochain complex with $M$ placed at the place $0$:
    \[
        \check{C}(\mathcal{V},M)=0\rightarrow M\rightarrow  \prod_{i=1}^n M\otimes_{A} A_{V_i}\rightarrow \prod_{1\leq i<j\leq n} M\otimes_{A} A_{V_i}\hat{\otimes}_A A_{V_j}\rightarrow \cdots.
    \]
\end{definition}

\begin{definition}
    Let $A$ be a $k_H$-affinoid algebra. A \emph{finite $k_H$-affinoid covering} of $\Sp A$ is a finite covering of $A$ by $k_H$-affinoid domains.

    A finite $k_H$-affinoid covering $\mathcal{U}$ is a 
    \begin{enumerate}
        \item \emph{$k_H$-Laurent covering} if there are $n\in \mathbb{N}$, $f_1,\ldots,f_n\in A$ and $r_1,\ldots,r_n\in \sqrt{|k^{\times}|\cdot H}$ such that $\mathcal{U}$ consists of 
        \[  
            \Sp A\left\{ r_1^{-\epsilon_1}f_1^{\epsilon_1},\ldots,r_1^{-\epsilon_n}f_1^{\epsilon_n}\right\}
        \]
        for all $\epsilon_i=\pm 1$, $i=1,\ldots,n$. In this case, we say that $\mathcal{U}$ is the $k_H$-Laurent covering \emph{generated by} $r_1^{-1}f_1,\ldots,r_{n}^{-1}f_n$. 
        \item \emph{$k_H$-rational covering} if there are $n\in \mathbb{N}$, $f_1,\ldots,f_n\in A$ generating the unit ideal, $r=(r_1,\ldots,r_n)\in \sqrt{|k^{\times}|\cdot H}^n$ such that $\mathcal{U}$ consists of
        \[
            \Sp A\left\{ (r/r_j)^{-1} \frac{f}{f_j} \right\}    
        \]
        for $j=1,\ldots,n$. In this case, we say that $\mathcal{U}$ is the $k_H$-rational covering \emph{generated by} $r_1^{-1}f_1,\ldots,r_{n}^{-1}f_n$. 
    \end{enumerate}
    In both cases, if $f_1,\ldots,f_n$ are all units in $A$, we say the covering is \emph{generated by units in $A$}. 
\end{definition}

\begin{lemma}\label{lma-prooftatelma1}
    Let $A$ be a $k_H$-affinoid algebra and $\mathcal{V}=\{V_i\}_{i\in 1,\ldots,m}$ be a finite $k_H$-affinoid covering of $\Sp A$. Then there is a $k_H$-rational covering refining $\mathcal{V}$.
\end{lemma}
\begin{proof}
    By \cref{cor-GG}, we may assume that all $V_i$'s are $k_H$-rational domains in $\Sp A$. Take $n_i\in \mathbb{N}$, $g^{(i)}_1,\ldots,g^{(i)}_{n_i}\in A$ generating the unit ideal, $r^{(i)}=(r^{(i)}_1,\ldots,r^{(i)}_{n_i-1},r^{(i)}_{n_i})\in \sqrt{|k^{\times}|\cdot H}^{n_i}$ for each $i=1,\ldots,m$
    such that if we write $g^{(i)}=(g^{(i)}_1,\ldots,g^{(i)}_{n_i})$, then
    \[
        V_i=\Sp A\left\{ \left(r^{(i)}/r^{(i)}_{n_i}\right)^{-1} \frac{g^{(i)}}{g^{(i)}_{n_i}} \right\}  
    \]
    for $i=1,\ldots,m$. Let $\mathcal{B}^i$ be the $k_H$-rational covering generated by 
    \[
        (r^{(i)})^{-1}f^{(i)}_1,\ldots,(r^{(i)})^{-1}f^{(i)}_{n_i}
    \]    
    for $i=1,\ldots,m$. 
    We denote the elements in $\mathcal{B}^i$ by $V^i_j$, $j=1,\ldots,n_i$:
    \[
        V^i_j:=\Sp A\left\{ \left(r^{(i)}/r^{(i)}_{j}\right)^{-1} \frac{g^{(i)}}{g^{(i)}_{j}}\right\}.  
    \]

    Let 
    \[
        I:=\left\{\alpha=(\alpha_1,\ldots,\alpha_m)\in \mathbb{N}^m: 1\leq \alpha_i\leq n_i\text{ for }i=1,\ldots,m \right\}  
    \]
    and 
    \[
        I':=\left\{\alpha=(\alpha_1,\ldots,\alpha_m)\in I: \alpha_i=n_i\text{ for some }i=1,\ldots,n\right\}.  
    \]
    Next for $\beta=(\beta_1,\ldots,\beta_m)\in I$, we let 
    \[
        g_{\beta}=g^{(1)}_{\beta_1}\cdots g^{(m)}_{\beta_m},\quad r_{\beta}=r^{(1)}_{\beta_1}\cdots r^{(m)}_{\beta_m}
    \]
    and we have
    \[
        V_{\beta}:=V^1_{\beta_1}\cap\cdots\cap V^m_{\beta_m}=\Sp A\left\{ \left((r_{\alpha})_{\alpha\in I}/r_{\beta} \right)^{-1} \frac{(g_{\alpha})_{\alpha\in I}}{g_{\beta}}\right\}  
    \]
    as in the proof of \cref{prop-intersecrationaldomain}.

    When $\beta\in I'$, we claim that
    \[
        V_{\beta}=\Sp A\left\{ \left((r_{\alpha})_{\alpha\in I'}/r_{\beta} \right)^{-1} \frac{(g_{\alpha})_{\alpha\in I'}}{g_{\beta}}\right\}.
    \]
    It is clear that the left-hand side is contained in the right-hand side. Conversely, $x$ in the right-hand side. By rearranging $U_1,\ldots,U_m$, we may assume that $x\in U_1$. Let $\gamma=(\gamma_1,\ldots,\gamma_m)\in I\setminus I'$. Then
    \[
        r_{\gamma}^{-1}\left|g_{\gamma}(x)\right|\leq (r^{(1)}_{n_1})^{-1}(r^{(2)}_{\gamma_2})^{-1}\cdots (r^{(m)}_{\gamma_m})^{-1}\left|g^{(1)}_{n_1}g^{(2)}_{\gamma_2}\cdots g^{(m)}_{\gamma_m}\right|\leq r_{\beta}^{-1}|g_{\beta}(x)|.  
    \]
    The claim follows. Now $\{V_{\beta}\}_{\beta\in I'}$ is the $k_H$-rational covering generated by $r_{\beta}^{-1}g_{\beta}$ for $\beta\in I'$. It is clear that this covering refines $\mathcal{V}$.
\end{proof}

\begin{lemma}\label{lma-prooftatelma2}
    Let $A$ be a $k_H$-affinoid algebra and $\mathcal{U}$ be a $k_H$-rational covering of $\Sp A$. Then there is a $k_H$-Laurent covering $\mathcal{V}$ of $\Sp A$ such that for each $\Sp C\in \mathcal{V}$, the restriction $\mathcal{U}|_{\Sp C}$ is a $k_H$-rational covering of $\Sp C$ generated by units in $C$.
\end{lemma}
\begin{proof}
    We take $n\in \mathbb{N}$, $f_1,\ldots,f_n\in A$ generating the unit ideal and $r_1,\ldots,r_n\in \sqrt{|k^{\times}|\cdot H}$ such that $\mathcal{U}$ is generated by $r_1^{-1}f_1,\ldots,r_n^{-1}f_n$. Choose $c\in \sqrt{|k^{\times}|\cdot H}$ such that
    \[
        c<\inf_{x\in \Sp A} \max_{i=1,\ldots,n}r_i^{-1}|f_i(x)|.  
    \]
    Let $\mathcal{V}$ be the $k_H$-Laurent covering of $\Sp A$ generated by $(cr_1)^{-1}f_1,\ldots,(cr_n)^{-1}f_n$. We claim that $\mathcal{V}$ satisfies our requirements.

    Take 
    \[
        V=\Sp A\left\{(cr_1)^{-\epsilon_1}f_1^{\epsilon_1},\ldots,(cr_n)^{-\epsilon_n}f_n^{\epsilon_n}\right\}  
    \]
    be an element in $\mathcal{V}$, $\epsilon_i=\pm 1$ for $i=1,\ldots,n$. We may assume that there is $s\in [0,n]$ such that $\epsilon_1=\cdots=\epsilon_s=1$ and $\epsilon_{s+1}=\cdots=\epsilon_n=-1$.  We claim that $\mathcal{U}|_V$ is teh $k_H$-rational covering generated by the images of $r_{s+1}^{-1}f_{s+1},\ldots,r_n^{-1}f_n$ in
    \[
        A\left\{ (cr_1)^{-1}f_1,\ldots,(cr_s)^{-1}f_s,(cr_{s+1})f_{s+1}^{-1},\ldots,(cr_n)f_n^{-1}\right\}
    \]
    and these elements are units.

    In fact, by our assumption, for $x\in V$,
    \[
         \begin{aligned}
                |f_i(x)|\leq & cr_i,\quad \text{for }i=1,\ldots,s;\\
                |f_i(x)|\geq & cr_i,\quad \text{for }i=s+1,\ldots,n.
         \end{aligned} 
    \]
    In particular,
    \[
         \max_{i=1,\ldots,s}r_i^{-1}|f_i(x)|\leq c< \max_{i=1,\ldots,n} r_i^{-1}|f_i(x)|.
    \]
    Hence, 
    \[
        \max_{i=1,\ldots,s}r_i^{-1}|f_i(x)|=\max_{i=s+1,\ldots,n}r_i^{-1}|f_i(x)|.
    \]
    Our claim follows.
\end{proof}

\begin{lemma}\label{lma-prooftatelma3}
    Let $A$ be a $k_H$-affinoid algebra and $\mathcal{U}$ be a $k_H$-rational covering of $\Sp A$ generated by units in $A$. Then there is a $k_H$-Laurent convering $\mathcal{V}$ of $\Sp A$ refining $\mathcal{U}$.
\end{lemma}
\begin{proof}
    We take $n\in \mathbb{N}$, units $f_1,\ldots,f_n\in A$ and $r_1,\ldots,r_n\in \sqrt{|k^{\times}|\cdot H}$ such that $\mathcal{U}$ is generated by $r_1^{-1}f_1,\ldots,r_n^{-1}f_n$.

    We take $\mathcal{V}$ as the Laurent covering generated by $(r_i r_j^{-1})^{-1} f_if_j^{-1}$ for $1\leq i<j\leq n$. We claim that $\mathcal{V}$ refines $\mathcal{U}$. 
    Write $I=\{(i,j)\in \mathbb{N}^2:1\leq i<j\leq n\}$.
    To see this, consider $V\in \mathcal{V}$, say
    \[
        V=\bigcap_{(i,j)\in I_1} \Sp A\{ (r_i r_j^{-1})^{-1} f_if_j^{-1}\}\cap \bigcap_{(i,j)\in I_2} \Sp A\{ (r_i r_j^{-1})^{+1} f_i^{-1}f_j\},   
    \]
    where $I_1$, $I_2$ is a partition of $I$. For $i,j\in \{1,\ldots,n\}$, we write $i\preceq j$ if $(i,j)\in I_1$ and $j\preceq i$ if $(i,j)\in I_2$. Consider a maximal chain
    \[
        i_1\preceq i_2\preceq\cdots\preceq i_s
    \]
    on the set $\{1,\ldots,n\}$. Then $i\preceq i_s$ for each $i=1,\ldots,n$. 
    In other words, for $x\in X$, we have
    \[
        |f_if_{i_s}^{-1}(x)|\leq r_i r_{i_s}^{-1}.
    \]
    The right-hand side defines an element in $\mathcal{U}$.
\end{proof}



We first prove Tate acyclicity theorem in a special case.
\begin{lemma}\label{lma-tateacyc1}
    Let $A$ be a $k_H$-affinoid algebra. Let $\mathcal{V}=\{V_i\}_{i\in 1,\ldots,n}$ be a finite $k_H$-affinoid covering of $\Sp A$. Assume that each $V_i$ is a $k_H$-rational domain. Then $\check{C}(\mathcal{V},A)$ is exact and admissible.
\end{lemma}
\begin{proof}
    \textbf{Step~1}. We reduce to the case where
    \[
        \mathcal{V}=\left\{\{\Sp A\{r^{-1}f\}\},\{\Sp A\{rf^{-1}\}\}\right\}
    \]
    for some $r\in \sqrt{|k^{\times}|\cdot H}$ and $f\in A$.


    Take a $k$-free polyray $s$ with at least one component. By \cref{prop-Krfaithflat}, we can make the base change to $k_s$ and assume that $k$ is non-trivially valued. In this case, by open mapping theorem \cref{Banach-thm-openmapping} in the chapter Banach Rings, the admissibility is automatic. It suffices to prove the exactness.

    In this case, we can define a presheaf $\mathcal{O}_X$ on $X$ on the family of $k_H$-rational domains in $\Sp A$:  $\mathcal{O}_X(\Sp C)=C$. From the general comparison theorem of \v{C}ech cohomology \textcolor{red}{BGR P327 reproduce in the topology part} and \cref{lma-prooftatelma1}, we may assume that the covering $\mathcal{V}$ is  $k_H$-rational covering. But then we need to show that for each $k_H$-rational domain $W$ in $\Sp A$, $\check{C}(\mathcal{V}|_W,A)$ is exact. Similarly, by \cref{lma-prooftatelma2}, we may assume that the $k_H$-rational covering is generated by units. Again, by \cref{lma-prooftatelma3}, we can reduce to the case where $\mathcal{V}$ is a $k_H$-Laurent covering.

    We need to show that for each $k_H$-affinoid domain $\Sp C$ in $\Sp A$, $\check{C}(\mathcal{V}|_W,A)$ is exact. But $\mathcal{V}|_W$ is also a $k_H$-Laurent covering. In particular, it suffices to show that $\check{C}(\mathcal{V},A)$ is exact. By induction on the number of generators of $\mathcal{V}$, we can reduce the case stated in the beginning.
    
    \textbf{Step~2}. After the reduction, we need to show that the following sequence is exact:
    \[
        0\rightarrow A\xrightarrow{i} A\{r^{-1}f\}\times A\{rf^{-1}\}\xrightarrow{d^0} A\{r^{-1}f,rf^{-1}\}\rightarrow 0,
    \]
    where $i(a)=(a,a)$ and $d^0(f,g)=f-g$. We extend the sequence to the following commutative diagram in $k_H\text{-}\AffAlgCat$:
    \[
        \begin{tikzcd}
            &                                                     & 0 \arrow[d]                                                                          &  & 0 \arrow[d]                                                 &   \\
            &                                                     & (\zeta-f)A\{r^{-1}\zeta\}\times (1-f\eta)A\{r\eta\} \arrow[rr, "\lambda'"] \arrow[d] &  & {(\zeta-f)A\{r^{-1}\zeta,r\zeta^{-1}\}} \arrow[r] \arrow[d] & 0 \\
0 \arrow[r] & A \arrow[r, "\iota"] \arrow[d, no head, Rightarrow] & A\{r^{-1}\zeta\}\times A\{r\eta\} \arrow[rr, "\lambda"] \arrow[d]                    &  & {A\{r^{-1}\zeta,r\eta\}/(\zeta\eta-1)} \arrow[r] \arrow[d]  & 0 \\
0 \arrow[r] & A \arrow[r, "\epsilon"]                             & A\{r^{-1}f\}\times A\{rf^{-1}\} \arrow[rr, "d^0"] \arrow[d]                          &  & {A\{r^{-1}f,rf^{-1}\}} \arrow[r] \arrow[d]                  & 0 \\
            &                                                     & 0                                                                                    &  & 0                                                           &  
\end{tikzcd},
    \]
where $\iota(a)=(a,a)$ and $\lambda$ sends $\zeta$ to $\zeta$ and $\eta$ to $\eta$. The two colomns are clearly exact. It is straightforward to see that everywhere the first non-zero row is exact. The second non-zero row is also exact. The non-trivial part is to show that if $\sum_{i=0}^{\infty}a_i \zeta^i\in A\{r^{-1}\zeta\}\in A\{r^{-1}\zeta\}$ and $\sum_{i=0}^{\infty}b_i \zeta^i\in A\{r^{-1}\eta\}\in A\{r\eta\}$ are such that their pair lies in the kernel of $\lambda$, then
\[
    0=\sum_{i=0}^{\infty}a_i\zeta^i-\sum_{i=0}^{\infty}b_i\zeta^{-i}.
\]
It follows that $a_i=0=b_i$ for $i>0$ and $a_i=b_i$. So we find that the second row is also exact. By diagram chasing, the third row is also exact.
\end{proof}


\begin{corollary}\label{cor-univpropertytemkinandberkovichequivalent}
    Let $A$ be a $k_H$-affinoid algebra and $\Sp B$ be a $k$-affinoid domain in $\Sp A$. Then for any complete non-Archimedean field extension $K/k$, any $K$-affinoid algebra $C$ and any bounded ring homomorphism $A\rightarrow C$ such that $\Sp C\rightarrow \Sp A$ factorizes through $\Sp B$, there is a unique bounded ring homomorphism $B\rightarrow C$ making the following diagram commutes:
    \[
    \begin{tikzcd}
        \Sp C \arrow[rd] \arrow[d, dotted] &       \\
        \Sp B \arrow[r]                    & \Sp A
    \end{tikzcd}
    \]
\end{corollary}
\begin{proof}
    The proof is the same as in \cref{ex-rationaldomains} when $\Sp B$ is an affinoid domain in $\Sp A$. 

    In general, by \cref{cor-GG}, we can cover $\Sp B$ by finitely many affinoid domains $\Sp B_1,\ldots,\Sp B_n$ in $\Sp A$. Let $\Sp C_i$ be the rational domain in $\Sp C$ defined by the preimage of $\Sp B_i$ for $i=1,\ldots,n$. In other words, we have Cartesian diagrams for $i=1,\ldots,n$:
    \[
        \begin{tikzcd}
            \Sp C_i \arrow[r] \arrow[d] \arrow[rd, "\square", phantom] & \Sp C \arrow[d] \\
            \Sp B_i \arrow[r]                                          & \Sp A          
        \end{tikzcd}  
    \]
    It follows from \cref{lma-tateacyc1} that we have an admissible exact sequence
    \[
        0\rightarrow C\rightarrow \prod_{i=1}^n C_i\rightarrow \prod_{1\leq i<j\leq n}^n C_{i}\hat{\otimes}_C C_j.    
    \] 
    From general abstract nonsense, to construct bounded $A$-homomorphisms $\varphi:B\rightarrow C$ is the same as to construct bounded homomorphisms $\varphi_i:B\rightarrow C_i$ over $A$ such that the induced maps $B\rightarrow C_{i}\hat{\otimes}_C C_j$ are compatible. On the other hand, by our definition of $B_i$, in order to construct the morphisms $\varphi_i$, it suffices to construct $\psi_i:B_i\rightarrow C_i$ over $A$. This reduces to the known case. 
\end{proof}


\begin{corollary}
    Let $A$ be a $k_H$-affinoid algebra and $H'\supseteq H$ is a subgroup of $\mathbb{R}_{>0}$. Let $V=\Sp B$ be a $k_H$-affinoid domain in $\Sp A$, then $\Sp B$ is a $k_{H'}$-affinoid domain in $\Sp A$.
\end{corollary}
\begin{proof}
    This follows immediately from \cref{cor-univpropertytemkinandberkovichequivalent}.
\end{proof}

\textcolor{red}{Introduce the Shilov point}

\begin{proposition}\label{prop-univpropertytemkinandberkovichequivalent}
    Let $A$ be a $k$-affinoid algebra and $V\subseteq X$ is a closed subset. Let $f:A\rightarrow B$ be a morphism of $k$-affinoid algebras.
    Assume that for any complete non-Archimedean field extension $K/k$, any $K$-affinoid algebra $C$ and any bounded ring homomorphism $A\rightarrow C$ such that $\Sp C\rightarrow \Sp A$ factorizes through $V$, there is a unique bounded ring homomorphism $B\rightarrow C$ making the following diagram commutes:
    \[
    \begin{tikzcd}
        \Sp C \arrow[rd] \arrow[d, dotted] &       \\
        \Sp B \arrow[r]                    & \Sp A
    \end{tikzcd}.
    \]
    Then $V$ is an affinoid domain represented by the given $A\rightarrow B$.
\end{proposition}
\begin{proof}
    The only non-trival thing is to show that the image of $\Sp B\rightarrow \Sp A$ is $V$.

    \textbf{Step~1}. We reduce to the case where $k$ is non-trivially valued and $A$, $B$ are both strictly $k$-affinoid. 
    
    Let $r$ be a $k$-free polyray with at least one component such that $A\hat{\otimes}_k k_r$ and $B\hat{\otimes}_k k_r$ are both strictly $k_r$-affinoid. Let $V'$ be the inverse image of $V$ in $\Sp A\hat{\otimes}_k k_r$. Then clearly, $V'$ has the same universal property. Assume that we have already shown that the image of 
    \[
        \Sp   B\hat{\otimes}_k k_r\rightarrow A\hat{\otimes}_k k_r
    \]
    is exactly $V'$. We have a commutative diagram:
    \[
    \begin{tikzcd}
        \Sp B\hat{\otimes}_k k_r \arrow[r] \arrow[d] & \Sp A\hat{\otimes}_k k_r \arrow[d] \\
        \Sp B \arrow[r]                              & \Sp A                             
    \end{tikzcd}
    \]
    From the existence of the Shilov points, both vertical sections are surjective. Hence, the image of $\Sp B$ in $\Sp A$ is exactly $V$.

    \textbf{Step~2}. After the reduction, it suffices to argue that each point in $V\cap \Spm A$ lies in the image. Let $y$ be such a point corresponding to a maximal ideal $\mathfrak{m}_y$ of $A$. Consider the commutative diagram
    \[
        \begin{tikzcd}
            A \arrow[r, "f"] \arrow[d, "\pi"]    & B \arrow[d, "\pi'"] \arrow[ld, "\alpha"', dotted] \\
            A/\mathfrak{m}_y \arrow[r, "\sigma"] & B/\mathfrak{m}_yB                                
        \end{tikzcd}.  
    \]
    The two vertical maps are the natural projections and $\sigma$ is the map induced by $f$.
    The existence of $\alpha$ and the commutativity of the diagram follow from the universal property. Observe  that $\sigma$ is surjective as $\pi'$ is. Similarly, $\alpha$ is surjective as $\pi$ is. Moreover, $\mathfrak{m}_yB=\ker \pi'\subseteq \ker \alpha$. In particular, $\sigma$ is bijection. So $\mathfrak{m}_yB$ is a maximal ideal in $B$ and the corresponding point $x\in \Spm B$ sends $x$ to $y$.
\end{proof}

\begin{remark}\label{rmk-affdomainresidue}
    In fact, the proof proves the following result: assume that the valuation on $k$ is non-trivial and $A$ is a strictly $k$-affinoid algebra. Let $\Sp B$ be a strictly $k$-affinoid domain. Then for each $x\in \Spm B$ corresponding to a maximal ideal $\mathfrak{m}_x$ in $B$ and any $n\in \mathbb{Z}_{>0}$, we have a natural isomorphism
    \[
        A/\mathfrak{m}_y^n  \cn B/\mathfrak{m}_x^n,
    \]
    where $y$ is the image of $x$ in $\Sp A$ and $\mathfrak{m}_y$ is the corresponding maximal ideal in $A$. Moreover, $\mathfrak{m}_x=\mathfrak{m}_y B$. 
    
    In particular, the natural map $\hat{A}_{\mathfrak{m}_y}\rightarrow \hat{B}_{\mathfrak{m}_x}$ is an isomorphism.
\end{remark}

\begin{corollary}\label{cor-affdomainfieldext}
    Let $A$ be a $k$-affinoid algebra and $\Sp B$ be a $k$-affinoid domain in $\Sp A$. Assume that $K/k$ is an extension of complete valued field. Then $\Sp B\hat{\otimes}_k K$ is a $K$-affinoid domain in $\Sp A\hat{\otimes}_k K$. Moreover, the image of  $\Sp B\hat{\otimes}_k K$ in $\Sp A\hat{\otimes}_k K$ is the inverse image of the image of $\Sp B$ in $\Sp A$.
\end{corollary}
\begin{proof}
    This is an immediate consequence of \cref{prop-univpropertytemkinandberkovichequivalent} and \cref{cor-univpropertytemkinandberkovichequivalent}.
\end{proof}

\begin{corollary}\label{cor-fiberproductaffdomain}
    Let $\varphi:\Sp B\rightarrow \Sp A$ be a morphism of $k_H$-affinoid spectra. Let $V\subseteq \Sp A$ be a $k_H$-affinoid domain in $\Sp A$, then $\varphi^{-1}(V)$ is a $k_H$-affinoid domain in $\Sp B$.

    In fact, suppose that $V$ is represented by $A\rightarrow A_V$, then $B\rightarrow B\hat{\otimes}_A A_V$ represents $\varphi^{-1}V$.
\end{corollary}
\begin{proof}
    It is an immediate consequence of \cref{prop-univpropertytemkinandberkovichequivalent} and \cref{cor-univpropertytemkinandberkovichequivalent} that $\varphi^{-1}(V)$ is a $k$-affinoid domain. As $B\hat{\otimes}_A A_V$ is $k_H$-affioid, we find that it is also a $k_H$-affinoid domain.
    \iffalse
    Recall that $\Sp B\hat{\otimes}_A A_V$ is the fiber product of $\Sp B$ and $\Sp A_V$ over $\Sp A$:
    \[
        \begin{tikzcd}
            \Sp B\hat{\otimes}_A A_V \arrow[r] \arrow[d] \arrow[rd, "\square", phantom] & \Sp B \arrow[d, "\varphi"] \\
            \Sp A_V \arrow[r]                                                           & \Sp A                     
        \end{tikzcd}.
    \]
    \fi
\end{proof}

\begin{corollary}\label{cor-intersecaffdomain}
    Let $A$ be a $k_H$-affinoid algbera and $\Sp B$, $\Sp C$ be $k_H$-affinoid domains in $\Sp A$. Then $\Sp B\cap \Sp C$ is a $k_H$-affinoid domain represented by the natural morphism $A\rightarrow B\hat{\otimes}_A C$.
\end{corollary}
\begin{proof}
    This is an immediate consequence of \cref{cor-fiberproductaffdomain}.
\end{proof}

\begin{corollary}\label{cor-spcatclosedimm}
    Let $A$ be a $k_H$-affinoid algbera and $\Sp B$, $\Sp C$ be $k_H$-affinoid domains in $\Sp A$. Then the natural morphism
    \[
        \Sp B\cap \Sp C\rightarrow \Sp B\times \Sp C  
    \]
    is a closed immersion.
\end{corollary}
\begin{proof}
    By \cref{cor-intersecaffdomain}, we need to show that the natural map
    \[
        B\hat{\otimes}_k C\rightarrow   B\hat{\otimes}_A C
    \]
    is an admissible epimorphism. From general abstract nonsense and \cref{prop-closedimmbasechange}, it suffices to show that the codiagonal 
    \[
        A\hat{\otimes}_k A\rightarrow A  
    \]is 
    an admissible epimorphism. This follows from \cref{ex-diagonalclosedimm}.
\end{proof}

\begin{corollary}\label{cor-affdomainquotient}
    Let $A$ be a $k_H$-affinoid algebra. Let $V,W$ be $k_H$-affinoid domains in $\Sp A$ represented by $A\rightarrow A_V$ and $A\rightarrow A_W$ respectively. Then $V\cap W$ is a $k_H$-affinoid domain represented by $A\rightarrow A_V\hat{\otimes}_A A_W$.
\end{corollary}
\begin{proof}
    This is an immediate consequence of \cref{cor-fiberproductaffdomain}.
    \iffalse
    Observe that $A_V\hat{\otimes}_A A_W$ is $k_H$-affinoid by \cref{prop-existfiberprod}.
    We verify the universal property: let $\Sp B\rightarrow \Sp A$ be a morphism that factors through $V\cap W$, then from the universal properties of $V$ and $W$, we find morphisms $A_V\rightarrow B$ and $A_W\rightarrow B$, both being $A$-linear. So we obtain an induced morphism $A_V\hat{\otimes}_A A_W\rightarrow B$. The morphism is clearly unique.
\fi
\end{proof}

\begin{definition}\label{def-presheafOX}
   Let $X=\Sp A$ be a $k$-affinoid spectra, we define a presheaf $\mathcal{O}_X$ of Banach rings on the family of $k$-affinoid domains in $X$ as follows: for any $k$-affinoid domain $\Sp B$, we set
   \[
        \mathcal{O}_X(\Sp B)=B.
   \]
   Given an inclusion of affinoid domains, $\Sp C\rightarrow \Sp B$, we define the corresponding restriction map as the given morphism $B\rightarrow C$.
\end{definition}

\begin{thm}\label{thm-affdomainflat}
    Let $A$ be a $k$-affinoid algebra and $V'=\Sp B$ be a $k$-affinoid domain in $\Sp A$. Then $B$ is a flat $A$-algebra.
\end{thm}
\begin{proof}
    

    \textbf{Step~1}. We reduce to the case where $k$ is non-trivially valued and $A$ is strictly $k$-affinoid.

    Let $r$ be a $k$-free polyray with at least one component. Let $\varphi:M\rightarrow N$ be an injective $A$-module homomorphism.  We endow $M$ and $N$ with the structures of finite Banach $A$-modules by \cref{prop-finteBanachAmoduleequivfinitemodule} and then $\varphi$ is admissible by \cref{prop-finitemodulemapadmi}. By \cref{prop-Krfaithflat}, the induced homomorphism
    \[
        M\hat{\otimes}_k k_r\rightarrow  N\hat{\otimes}_k k_r 
    \]
    is injective and admissible. Let $V'$ be the inverse image of $V$ in $\Sp A\hat{\otimes}_k k_r$. By \cref{cor-affdomainfieldext}, $V'$ is a $k_r$-affinoid domain represented by $A\hat{\otimes}_k k_r\rightarrow B\hat{\otimes}_k k_r$.

    If we have shown the result in the special case, we know that 
    \[
        (M\hat{\otimes}_k k_r)\otimes_{A\hat{\otimes}_k k_r}(B\hat{\otimes}_k k_r)\rightarrow  (N\hat{\otimes}_k k_r) \otimes_{A\hat{\otimes}_k k_r}(B\hat{\otimes}_k k_r)
    \]
    is injective. By \cref{prop-finitemodulebasechange}, this map can be identified with 
    \[
        (M\hat{\otimes}_k k_r)\hat{\otimes}_{A\hat{\otimes}_k k_r}(B\hat{\otimes}_k k_r)\rightarrow  (N\hat{\otimes}_k k_r) \hat{\otimes}_{A\hat{\otimes}_k k_r}(B\hat{\otimes}_k k_r).
    \]
    The latter map is easily identified with
    \[
        M\hat{\otimes}_A B\rightarrow    N\hat{\otimes}_A B.
    \]
    By \cref{prop-finitemodulebasechange} again, the latter map is identified with 
    \[
        M\otimes_A B\rightarrow    N\otimes_A B.
    \]  
    We conclude that $A\rightarrow B$ is flat.

    \textbf{Step~2}. After the reduction, we take a maximal ideal $\mathfrak{m}_x$ in $B$ corresponding to a point $x\in \Sp B$. Let $y$ be the image of $y$ in $\Sp A$ and $\mathfrak{m}_y$ denotes the corresponding maximal ideal. Then by \cref{rmk-affdomainresidue}, $\hat{A}_{\mathfrak{m}_y}\rightarrow \hat{B}_{\mathfrak{m}_y}$ is an isomorphism. By  \cite[\href{https://stacks.math.columbia.edu/tag/0C4G}{Tag 0C4G}]{stacks-project} and \cite[\href{https://stacks.math.columbia.edu/tag/0399}{Tag 0399}]{stacks-project}, we conclude that $A\rightarrow B$ is flat.
\end{proof}

\begin{thm}[Tate acyclicity theorem]\label{thm-Tateacyc}
    Let $A$ be a $k$-affinoid algebra. Let $\mathcal{V}=\{V_i\}_{i\in 1,\ldots,n}$ be a finite $k$-affinoid covering of $\Sp A$. Let $M$ be an $A$-module.
    Then the complex $\check{C}(\mathcal{V},A)$ is exact. It is exact and admissible if $M$ is finite as $A$-module.
\end{thm}
\begin{proof}
    We first observe that teh admissibility follows from the same argument as in \cref{lma-tateacyc1}. We will only concentrate on the exactness. 

    \textbf{Step~1}. We first reduce to the case $M=A$. 


    As the covering $\mathcal{V}$ is finite, we can find $N\in \mathbb{N}$ such that $\check{H}^j(\mathcal{V},M'')=0$ for all $j\geq N$ and all $A$-module $M''$. We take the minimum of such $N$. Assume that $N> 0$.

    Assume we have proved the theorem in this case, then the case where $M$ is free is immediate. In general, choose an exact sequence of $A$-modules:
    \[
        0\rightarrow M'\rightarrow F\rightarrow M\rightarrow 0  
    \]
    with $F$ free. In this case, we have a short exact sequence
    \[
        0\rightarrow  \check{C}(\mathcal{V},M')\rightarrow \check{C}(\mathcal{V},F)\rightarrow \check{C}(\mathcal{V},M)\rightarrow 0. 
    \]
    The exactness follows from \cref{thm-affdomainflat}. 

    From the long exact sequence, we find that
    \[
        H^{q-1}(\mathcal{V},M)\cong   H^{q}(\mathcal{V},M').
    \]
    for all $q\in \mathbb{Z}$. It follows that $H^q(\mathcal{V},M)=0$ for all $q\geq N-1$. This argument works for any $A$-module $M$ and we get a contradiction with our choice of $N$.

    \textbf{Step~2}. After the reduction in Step~1 and the successful defition of $\mathcal{O}_X$ in \cref{def-presheafOX}, the remaining of the argument is exactly the same as \cref{lma-tateacyc1}.
\end{proof}

\begin{corollary}\label{cor-coveringkhimplykh}
    Let $A$ be a $k$-affinoid algebra and $\{\Sp B_i\}$ be a finite $k_H$-affinoid covering of $\Sp A$. Then $A$ is $k_H$-affinoid.
\end{corollary}
\begin{proof}
    By \cref{thm-Tateacyc}, we have an admissible injective morphism
    \[
        A\rightarrow   \prod_{i\in I}B_i
    \]
    of Banach $k$-algebras. Then for any $a\in A$, 
    \[
        \rho_A(a)=\max_{i\in I}\rho_{B_i}(a).
    \]
    We conclude using \cref{thm-strictaffdfnequal}.
\end{proof}

\iffalse
\begin{corollary}
    Let $A,B$ be $k_H$-affinoid algebras and $\varphi:\Sp B\rightarrow \Sp A$ a morphism of $k_H$-affinoid spectra. Let $\{\Sp A_i\}_{i\in I}$ be a finite $k_H$-affinoid covering of $\Sp A$. Consider the Cartesian squares 
    \[
        \begin{tikzcd}
            \Sp A_i\hat{\otimes}_A B \arrow[d] \arrow[r] \arrow[rd, "\square", phantom] & \Sp B \arrow[d, "\varphi"] \\
            \Sp A_i \arrow[r]                                                           & \Sp A                     
        \end{tikzcd}  
    \]
    for $i\in I$. Suppose that $\Sp A_i\hat{\otimes}_A B\rightarrow \Sp A_i$ is a closed immersion for each $i\in I$, then $\varphi$ is also a closed immersion.
\end{corollary}
\begin{proof}
    This follows from \cref{thm-Tateacyc}.
\end{proof}
\fi

\section{Kiehl's theorem}
Let $(k,|\bullet|)$ be a complete non-Archimedean valued field.
\begin{thm}\label{thm-Kiehl}
    Let $A$ be a $k$-affinoid algebra and $\mathcal{U}=\{\Sp B_i\}_{i\in I}$ a finite $k$-affinoid covering of $\Sp A$. Suppose that we are given 
    \begin{enumerate}
        \item for each $i\in I$ a finite $B_i$-module $M_i$;
        \item for each $i,j\in I$, an isomorphism 
        \[
            \alpha_{ij}:M_i\otimes_{B_i} B_{ij}\rightarrow M_j\otimes_{B_j} B_{ji}
        \]
        of $B_{ij}$-modules, where $B_{ij}=B_i\hat{\otimes}_A B_j$ such that 
        \begin{enumerate}
            \item $\alpha_{ii}$ is identity for all $i\in I$;
            \item $\alpha_{ik}=\alpha_{jk}\circ \alpha_{ij}$ on $\Sp B_i\cap \Sp B_j\cap \Sp B_k$ for $i,j,k\in I$.
        \end{enumerate}
        Then there is a finite $A$-module $M$ and isomorphisms 
        \[
            \beta_i: M\otimes_{A} B_i\rightarrow M_i  
        \]
        of $B_i$-modules for each $i\in I$ and such that the following diagram is commutative:    
        \[
            \begin{tikzcd}
                M\otimes_A B_i\otimes_{B_i}B_{ij} \arrow[rr, "\beta_i\otimes_{B_i}B_{ij}"] \arrow[d, no head, Rightarrow] &  & M_i\otimes_{B_i}B_{ij} \arrow[d, "\alpha_{ij}"] \\
                M\otimes_A B_j\otimes_{B_j}B_{ji} \arrow[rr, "\beta_i\otimes_{B_j}B_{ji}"]                                &  & M_i\otimes_{B_j}B_{ji}                         
            \end{tikzcd}.  
        \]
\end{enumerate}

    If moreover each $M_i$ is an $A_i$-algebra for $i\in I$ and the maps $\alpha_{ij}$ are $B_{ij}$-algebra homomorphisms for $i,j\in I$, then we can endow $M$ with the structure of an $A$-algebra and $\beta_i$ is a $B_i$-algebra homomorphism for $i\in I$. 
\end{thm}
\begin{proof}
    By the same reduction as in our proof of \cref{lma-tateacyc1}, it suffices to handle the case where $\mathcal{U}$ is a Laurent covering generated by a single element:
    \[
        \mathcal{U}=\left\{ \Sp A\{r^{-1}f\}, \Sp A\{rf^{-1}\} \right\}  
    \]
    for some $r>0$ and $f\in A$. We write $B_1= A\{r^{-1}f\}$ and $B_2=A\{rf^{-1}\}$. Then $B_{12}=A\{r^{-1}f,rf^{-1}\}$. Let $M_{12}=M_1\otimes_{B_1} B_{12}$.
    We endow $M_1$ (resp. $M_2$, resp. $M_{12}$) with the structure of finite Banach $B_1$-(resp. $B_2$-, resp. $B_{12}$-)module by \cref{prop-finteBanachAmoduleequivfinitemodule}. We will denote the Banach norms on these modules by $\|\bullet\|$ without specifying the index. Let $\|\bullet\|_A$, $\|\bullet\|_1$, $\|\bullet\|_2$, $\|\bullet\|_{12}$ denote the norms on $A$, $B_1$, $B_2$, $B_{12}$ respectively.

    \textbf{Step~1}. We show that 
    \[
        d^0:M_1\times M_2\rightarrow M_{12}
    \]
    is surjective, where $d^0(m_1,m_2)=m_1-m_2$. We have omitted the obvious map $M_1\rightarrow M_{12}$ and $M_2\rightarrow M_{12}$. 


    We will prove the following claim: let $\epsilon>0$ be a constant. Then there is a constant $\alpha>0$ such that for  each $u\in M_{12}$, there exist $u^+\in M_1$ and $u^-\in M_2$ with
    \[
        \|u^{\pm}\| \leq \alpha \|u\|, \quad \|u-u^+-u^-\|\leq \epsilon\|u\|.
    \]
    This implies that $d^0$ is surjective.

    Let $v_1,\ldots,v_n$ be generators of the $B_1$-module $M_1$ and $w_1,\ldots,w_m$ be generators of the $B_2$-module $M_2$. 
    We write the images of $v_1,\ldots,v_n$ in $M_{12}$ as $v_1',\ldots,v_{n}'$ and the images of $w_1,\ldots,w_m$ in $M_{12}$ as $w_1',\ldots,w_m'$. 
    We could assume that the norms $\|\bullet\|$ on $M_1$, $M_2$, $M_{12}$ are the residue norms induced from $B_1^n$, $B_2^m$, $B_{12}^n$ by the basis $\{v_i\}$, $\{w_j\}$, $\{v_i'\}$ respectively. 
    Then we can find an $n\times m$-matrix $C=(c_{ij})$ with value in $B_{12}$ and an $m\times n$-matrix $D=(D_{ji})$ with value in $B_{12}$ such that
    \[
        \begin{aligned}
            v_i'=&\sum_{j=1}^m c_{ij}w_j',\quad i=1,\ldots,n;   \\
            w_j'=&\sum_{i=1}^n d_{ji}v_i',\quad i=1,\ldots,n.
        \end{aligned}
    \]
    Fix $\beta>1$.
    As $B_2$ is dense in $B_{12}$, we can find $c'_{ij}\in B_2$ 
    for $i=1,\ldots,n$, $j=1,\ldots,m$ such that
    \[
        \max_{i,l=1,\ldots,n} \max_{j=1,\ldots,m} \|c_{ij}-c_{ij}'\|_2\cdot \|d_{jl}\|_2\leq \beta^{-2}\epsilon.
    \]
    We write 
    \[
        u=\sum_{i=1}^n a_i\|v_i'\|  
    \]
    with $a_1,\ldots,a_n\in B_{12}$ with $\|a_i\|_{12}\leq \beta \|u\|$. For each $a_i$ with $i=1,\ldots,n$, we can expand lift them into series
    \[
        a_i=\sum_{j,k=0}^{\infty}c^i_{jk}T^jS^k\in A\{r^{-1}T,rS\}  
    \]
    with 
    \[
        \|c^i_{jk}\|_A r^{j-k}\leq \beta\|a_i\|_{12}.  
    \]
    In particular, we can find $a_i^+\in B_1$ and $a_i^-\in B_2$ with 
    \[
        \|a_i^+\|_1\leq \beta\|a_i\|_{12},\quad   \|a_i^-\|_2\leq \beta\|a_i\|_{12}.
    \]
    Take 
    \[
        u^+=\sum_{i=1^n}a_i^+v_i\in M_1,\quad   u^-=\sum_{i=1^n}\sum_{j=1}^m a_i^-c_{ij}' w_j\in M_2.
    \]
    Then $u^{\pm}$ satisfies all the requirements.

    \textbf{Step~2}. We define $M=\ker d^0$. We will see that $M$ satisfies the desired requirement. 
    To prove this assertion, it suffices to know that $M$ generates $M_i$ as $A_i$-modules for $i=1,2$. 
    
    In fact, assuming that this holds, we can choose $f_1,\ldots,f_s\in M$ so that they generate $M_i$ as $A_i$-module for $i=1,2$. In this way we get a surjective homomorphism $A^s\rightarrow M$. Similarly, we apply the same construction to the kernel of this map, we get a presentation 
    \[
        A^r\rightarrow A^s\rightarrow M\rightarrow 0,
    \]
    which can be embedded in the large commutative diagram
    \[
        \begin{tikzcd}
            0 \arrow[r] & A^r \arrow[r] \arrow[d] & A_1^r\times A_2^r \arrow[r] \arrow[d] & A_{12}^r \arrow[r] \arrow[d] & 0 \\
            0 \arrow[r] & A^s \arrow[r] \arrow[d] & A_1^s\times A_2^s \arrow[r] \arrow[d] & A_{12}^s \arrow[r] \arrow[d] & 0 \\
            0 \arrow[r] & M \arrow[r] \arrow[d]   & M_1\times M_2 \arrow[r,"d^0"] \arrow[d]     & M_{12} \arrow[r] \arrow[d]   & 0 \\
                        & 0                       & 0                                     & 0                            &  
        \end{tikzcd}  
    \]
    All colomns are exact by our assumptions. All rows are exact: the third row is Step~1 and our construction of $M$; the first two rows are trivial. The desired result follows from the right-exactness of tensor products.

    In order to prove that $M$ generates $M_i$ as $A_i$-module for $i=1,2$ is the same as verifying 
    \[
        M\otimes_A A_i\rightarrow M_i   
    \]
    is surjective for $i=1,2$. Endow $M$ and $M_i$ with the structure of finite Banach $A$-module and finite Banach $A_i$-module respectively by \cref{prop-finteBanachAmoduleequivfinitemodule}. By \cref{prop-finitemodulebasechange}, we can identify $M\otimes_A A_i$ with $M\hat{\otimes}_A A_i$. Now take a $k$-free polyray $r$ with at least one component  such that $A\hat{\otimes}_k k_r$, $A_1\hat{\otimes}_k k_r$, $A_2\hat{\otimes}_k k_r$ and $A_{12}\hat{\otimes}_k k_r$ are all strictly $k_r$-affinoid. By \cref{prop-Krfaithflat}, we can then reduce to the strictly affinoid case.

    \textbf{Step~3}. After the reductions, we can assume that $k$ is non-trivially valued and $A$, $A_1$, $A_2$, $A_{12}$ are all strictly $k$-affinoid. We need to show that $M$ generates $M_1$ and $M_2$ as $A_1$-module and $A_2$-module respectively.


    For each $x\in \Spm A$ with kernel $\mathfrak{m}$, we claim that teh natural map $M\rightarrow M/\mathfrak{m}M_i$ is surjective for $i=1,2$.

    Assuming this claim, by Nakayama's lemma, we see that $M$ generates $M_i$ as $A$-module for $i=1,2$. 

    It remains to prove the claim. We have a short exact sequences
    \[
        0\rightarrow \mathfrak{m}M\rightarrow M\rightarrow M/\mathfrak{m}M\rightarrow 0.  
    \]
    By \cite[\href{https://stacks.math.columbia.edu/tag/03OM}{Tag 03OM}]{stacks-project}, we have a short exact sequence of \v{C}ech complexes
    \[
        \begin{tikzcd}
            & 0 \arrow[d]                                                       & 0 \arrow[d]                       & 0 \arrow[d]                                                                &   \\
0 \arrow[r] & \ker \eta \arrow[r] \arrow[d]                                     & M \arrow[r] \arrow[d]             & \ker \iota \arrow[r] \arrow[d]                                             & 0 \\
0 \arrow[r] & \mathfrak{m}M_1\times \mathfrak{m}M_2 \arrow[r] \arrow[d, "\eta"] & M_1\times M_2 \arrow[r] \arrow[d] & M_1/\mathfrak{m}M_1\times M_2/\mathfrak{m}M_2 \arrow[r] \arrow[d, "\iota"] & 0 \\
0 \arrow[r] & \mathfrak{m}M_{12} \arrow[r] \arrow[d]                            & M_{12} \arrow[r] \arrow[d]        & M_{12}/\mathfrak{m}M_{12} \arrow[r] \arrow[d]                              & 0 \\
            & 0                                                                 & 0                                 & 0                                                                          &  
\end{tikzcd}
    \]
    The rows are exact and the colomns are complexes. It follows from Step~1 and the snake lemma that we have an exact sequence
    \[
        0\rightarrow \ker \eta\rightarrow M\rightarrow \ker \iota\rightarrow 0.  
    \]
    In particular, the map $M\rightarrow \ker \iota$ is surjective. 
    
    
    Next assume that $x\in \Sp B_1$, we will prove that $\ker \iota\rightarrow M_1/\mathfrak{m} M_1$ is bijective. A dual arguement applies in the case $x\in \Sp B_2$.  Note that this assertion readily implies our claim.

    By \cref{rmk-affdomainresidue}, we have the natural map is a bijection
    \[
        B_2/\mathfrak{m}B_2\rightarrow B_{12}/\mathfrak{m}B_{12}. 
    \]
    It follows that the following natural map is a bijection
    \[
        M_2/\mathfrak{m}M_2\rightarrow M_{12}/\mathfrak{m}M_{12}.  
    \]
    In particular, we find that $\ker \iota=M_1/\mathfrak{m}M_1$. This proves our assertion.

    Finally, the last assertion is clear as $M$ is constructed as an equalizer.
\end{proof}


\printbibliography
\end{document}